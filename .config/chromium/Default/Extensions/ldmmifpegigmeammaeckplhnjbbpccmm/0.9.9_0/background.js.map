{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/shared_code/appConfig.ts","webpack:///./src/shared_code/utils.ts","webpack:///./src/shared_code/notionlib/notion.ts","webpack:///./src/shared_code/notionapi/log.ts","webpack:///./src/shared_code/appUtils.ts","webpack:///./src/shared_code/lib/storage.ts","webpack:///./node_modules/uuid/v4.js","webpack:///./src/background/background.ts","webpack:///./src/shared_code/notionapi/index.ts","webpack:///./src/shared_code/notionapi/agent.ts","webpack:///./src/shared_code/notionapi/httputil.ts","webpack:///./node_modules/@dnpr/logger/lib/index.js","webpack:///./src/shared_code/notionapi/error/RequestError.ts","webpack:///./src/shared_code/notionapi/strings.ts","webpack:///./src/shared_code/notionapi/error/APIError.ts","webpack:///./src/shared_code/notionlib/util.ts","webpack:///./src/shared_code/notionapiV2/fetchFullContentPage.ts","webpack:///./src/shared_code/notionapiV2/notion.ts","webpack:///./node_modules/uuid/lib/rng-browser.js","webpack:///./node_modules/uuid/lib/bytesToUuid.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","APP_NAME","APP_VERSION","APP_VERSION_FULL","WHATS_NEW_LINK","FORM_LIST_KEY","FORM_KEY_PREFIX","COOKIE_KEY","NOTION_CLIENT_DATA_KEY","notionColors","default","gray","brown","yellow","green","orange","blue","purple","pink","red","randomNotionColor","keys","Math","floor","random","length","__awaiter","this","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","g","_","label","sent","trys","ops","verb","iterator","v","op","TypeError","pop","push","appConfig_1","promisify","fn","options","accept","cancel","cb","makeid","characters","charactersLength","charAt","print","args","_i","arguments","sleep","ms","_a","setTimeout","throttle","waitMs","last","prevFn","prevTimer","now","Date","undefined","clearTimeout","x","max","getTime","getChipColor","option","color","arrayMove","array","from","to","startIndex","item","splice","arrayMoveMutate","slice","__assign","assign","__spreadArrays","il","Array","k","a","j","jl","notionapi_1","util_1","appUtils_1","uuid","NotionV3Client","token","_this","defaultHeaders","origin","referer","custom","createWebClippedPage","parentId","title","url","_b","addWebClipperURLs","blockId","items","type","createdBlockIds","_axios","route","method","data","headers","fetch","startsWith","toUpperCase","cookie","JSON","stringify","json","post","put","delete","uncastRowProperty","strippedName","String","parseFloat","join","domainsIncludeFrontImageMap","Collection","id","viewId","notionClient","fetched","schema","rows","client","initLocally","_extractSchema","uid","createRow","saveWebClip","lowOp","recordId","clientV2","operations","skipFrontImage","u","authToken","console","log","createRecordOperations","_table","URL","hostname","substring","updateRow","where","findRow","countTotal","row","countSame","field","transacs","lowOperations","_c","_d","path","_e","__template","getTransacOperationsFromTemplate","blocksMap","concat","pageFrontImage","pageId","imgUrl","width","height","opts","newBlockId","newDividerBlockId","maxSizes","large","normal","small","maxWidth","size","maxHeight","w","h","fullWidth","blockPageWidth","table","command","version","parent_id","parent_table","alive","source","display_source","block_height","block_width","block_full_width","block_page_width","addDivider","properties","after","getFrontPageImageOperations","updateDataRecord","getDepVal","defaultValue","getParents","parents","block","icon","format","page_icon","reverse","emptyUser","spaces","givenName","DummyNotionClient","notionAuthToken","agent","createAgent","debug","user","addValueToPropertyCollection","col","propertyId","valueId","newSchema","newVal","_submitTransaction","setUserInfos","fetchUserInfos","res","userKeys","userData","spaceId","space","loadUserContent","recordMap","notion_user","given_name","parent","extra","created_by","created_time","last_edited_time","_buildOperation","createRecord","dataPaths","lowLevelOperations","map","getCollectionLocally","collectionId","param","searchCollectionPages","query","ret","pages","obj","page","search","limit","filters","isDeletedOnly","excludeTemplates","isNavigableOnly","requireEditPermissions","ancestors","createdBy","editedBy","lastEditedTime","createdTime","sort","results","searchCollections","collections","collection","submitTransaction","requestId","transactions","appendBulletPointToPage","text","rawId","replace","substr","parsePageId","Logger","__importDefault","mod","notion_1","appConfig_2","storage_1","utils_1","fetchFullContentPage_1","saveCurrentPopupState","state","set","createdAt","lastUpdatedAt","resetCurrentPopupState","sanitizeFormData","daps","filter","getFormData","getCurrentPopupState","currentUrl","pos","deleteFormData","forms","form","saveFormData","status","formInfo","id_1","some","favorite","templateId","currentId","copyBlockOperation","role","blockVal","copied_from","forEach","content","childResults","newContent","flatMap","getTransacOperationsFromWebClipping","getUpToDateTemplateBlocksMap","refreshTemplate","fetchFullContentPage","extraProperty","applyRefreshCollection","oldDaps","needToResetCollection","_loop_1","mField","fieldsToModify","find","nproperty","action","oldDaps_1","getTemplateInfo","resp","loadPageChunk","cursor","stack","index","chunkNumber","verticalColumns","encrypt","window","btoa","decrypt","atob","fetchNotionClient","errorMsg","applyRefreshCollectionOnData","oldData","template","needToRemoveTemplate","needToRefreshTemplate","refreshCollection","config","newTemplate","ncol","_loop_2","daps_1","dap","getTemplatesInfo","template_pages","all","templatesInfo","checkTemplateUpToDate","nproperty_1","includes","defaultSelectId","opt","defaultSelectIds","every","getClient","onStatusChange","cookieWrap","storedCookie","clientData","chrome","cookies","parse","cachedCollectionsMap","cachedCollectionsTimeout","getCachedCollectionPages","count","order","upsertCachedCollectionPage","oldId","shift","newMap","b","toLowerCase","getCacheKey","QUOTA_BYTES_PER_ITEM","storage","sync","MAX_ITEMS","err","local","found","xget","callback","segment","cacheKey","cache","remove","xset","rng","bytesToUuid","buf","offset","rnds","ii","getHighlightData","getPageHighlightData","success","addHighlightToNotion","notionPageId","highlights","hightlightOrNote","selectionText","pageUrl","displaySnackBar","msg","timeout","executeScript","highlight","executeAsyncScript","request","modalAddNote","tutorial","currentTab","tabs","currentWindow","active","tabArray","filename","tab","code","file","asyncId","toString","listener","sender","sendResponse","end","runtime","onMessage","removeListener","message","addListener","_resolve","getMetaData","metaData","favIconUrl","getCustomCss","customs","getPrefilledValue","pages_1","d_1","ids_1","img","fieldOptions","image","formatData","kind","submitToNotion","port","e_1","e_2","postMessage","errorInfo","disconnect","savePageContent","split","createPageHighlightData","commands","onCommand","contextMenus","contexts","onClicked","info","rq","onConnect","params","agent_1","httputil_1","log_1","strings_1","APIError_1","createAPI","req","error","setHeader","Default","server","userAgent","sendAsJson","APIError","setLogLevel","getActivityLog","getAssetsJson","getRecordValues","getSnapshotsList","getUserSharedPages","queryCollection","RequestError_1","myURL","protocol","RequestError","agentOptions","authority","pathname","payload","response","RET_SUCCESS","RET_FAIL","LOG_LEVEL","verbose","warn","LOG_LEVEL_DEFAULT","STYLE","fgBlack","fgRed","fgGreen","fgYellow","fgBlue","fgPink","fgCyan","fgWhite","reset","bold","appName","useColor","logLevel","unshift","_makeHeader","str","logLevelLabel","style","getTimezoneOffset","timeStamp","toISOString","extendStatics","__extends","setPrototypeOf","__proto__","__","constructor","_super","Error","jdump","notionToken","baseBlocks","allBlocks","allBlockKeys","pendingBlocks","newBlocks","fetchPageById","fetchBlocks","collection_view","loadPageChunkBody","fetchNotionData","resource","NOTION_API","queryCollectionBody","aggregations","aggregator","loader","searchQuery","userTimeZone","userLocale","loadContentCover","fetchTableData","collectionViewId","fetchNotionUsers","userIds","users","requests","firstName","lastLame","family_name","fullName","profilePhoto","profile_photo","blockList","recordVersionMap","reduce","fetchNotionSearch","ancestorId","getRandomValues","crypto","msCrypto","rnds8","Uint8Array","byteToHex","bth"],"mappings":"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","file":"background.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 7);\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.APP_NAME = \"Save to Notion\";\r\nexports.APP_VERSION = \"0.9.9\";\r\nexports.APP_VERSION_FULL = \"0.9.9\";\r\nexports.WHATS_NEW_LINK = \"https://www.notion.so/What-s-new-Save-To-Notion-b85cff00e8c24b10a893a6aa18a887fa\";\r\nexports.FORM_LIST_KEY = \"STORAGE_KEY_FORM_LIST\";\r\nexports.FORM_KEY_PREFIX = \"form-\";\r\nexports.COOKIE_KEY = \"cookie\";\r\nexports.NOTION_CLIENT_DATA_KEY = \"notion-client-data\";\r\nexports.notionColors = {\r\n    default: \"rgba(206, 205, 202, 0.5)\",\r\n    gray: \"rgba(155, 154, 151, 0.4)\",\r\n    brown: \"rgba(140, 46, 0, 0.2)\",\r\n    yellow: \"rgba(233, 168, 0, 0.2)\",\r\n    green: \"rgba(0, 135, 107, 0.2)\",\r\n    orange: \"rgba(245, 93, 0, 0.2)\",\r\n    blue: \"rgba(0, 120, 223, 0.2)\",\r\n    purple: \"rgba(103, 36, 222, 0.2)\",\r\n    pink: \"rgba(221, 0, 129, 0.2)\",\r\n    red: \"rgba(255, 0, 26, 0.2)\",\r\n};\r\nfunction randomNotionColor() {\r\n    return Object.keys(exports.notionColors)[Math.floor(Math.random() * Object.keys(exports.notionColors).length)];\r\n}\r\nexports.randomNotionColor = randomNotionColor;\r\n","\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar appConfig_1 = require(\"./appConfig\");\r\nfunction promisify(fn, options) {\r\n    return new Promise(function (accept, cancel) {\r\n        fn(options, accept);\r\n    });\r\n}\r\nexports.promisify = promisify;\r\nfunction call(cb) {\r\n    new Promise(function (resolve, cancel) {\r\n        resolve(cb());\r\n    });\r\n}\r\nexports.call = call;\r\nfunction makeid(length) {\r\n    var result = \"\";\r\n    var characters = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\r\n    var charactersLength = characters.length;\r\n    for (var i = 0; i < length; i++) {\r\n        result += characters.charAt(Math.floor(Math.random() * charactersLength));\r\n    }\r\n    return result;\r\n}\r\nexports.makeid = makeid;\r\nexports.print = process.env.NODE_ENV === \"production\" ? function () {\r\n    var args = [];\r\n    for (var _i = 0; _i < arguments.length; _i++) {\r\n        args[_i] = arguments[_i];\r\n    }\r\n} : console.log;\r\nexports.sleep = function (ms) { return __awaiter(void 0, void 0, void 0, function () { return __generator(this, function (_a) {\r\n    return [2 /*return*/, new Promise(function (resolve) { return setTimeout(resolve, ms); })\r\n        //dead simple implementation. more robust here: https://stackoverflow.com/questions/27078285/simple-throttle-in-js\r\n    ];\r\n}); }); };\r\n//dead simple implementation. more robust here: https://stackoverflow.com/questions/27078285/simple-throttle-in-js\r\nfunction throttle(fn, waitMs) {\r\n    var last;\r\n    var prevFn;\r\n    var prevTimer;\r\n    return function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        var now = new Date();\r\n        if (prevFn) {\r\n            prevFn(undefined);\r\n            clearTimeout(prevTimer);\r\n            prevFn = null;\r\n        }\r\n        return new Promise(function (resolve) {\r\n            var x = last\r\n                ? Math.max(0, waitMs - (now.getTime() - last.getTime()))\r\n                : 0;\r\n            prevFn = resolve;\r\n            prevTimer = setTimeout(function () {\r\n                last = now;\r\n                prevFn = null;\r\n                resolve(fn.apply(null, args));\r\n            }, x);\r\n        });\r\n    };\r\n}\r\nexports.throttle = throttle;\r\nfunction getChipColor(option) {\r\n    return option.color in appConfig_1.notionColors\r\n        ? appConfig_1.notionColors[option.color]\r\n        : appConfig_1.notionColors.default;\r\n}\r\nexports.getChipColor = getChipColor;\r\nvar arrayMoveMutate = function (array, from, to) {\r\n    var startIndex = to < 0 ? array.length + to : to;\r\n    var item = array.splice(from, 1)[0];\r\n    array.splice(startIndex, 0, item);\r\n};\r\nexports.arrayMove = function (array, from, to) {\r\n    array = array.slice();\r\n    arrayMoveMutate(array, from, to);\r\n    return array;\r\n};\r\n","\"use strict\";\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar notionapi_1 = require(\"../notionapi\");\r\nvar util_1 = require(\"./util\");\r\nvar appUtils_1 = require(\"../appUtils\");\r\nvar uuid = require(\"uuid/v4\");\r\nvar NotionV3Client = /** @class */ (function () {\r\n    function NotionV3Client(token) {\r\n        var _this = this;\r\n        this.defaultHeaders = {\r\n            accept: \"*/*\",\r\n            \"accept-language\": \"en-US,en;q=0.9\",\r\n            \"accept-encoding\": \"gzip, deflate, br\",\r\n            origin: \"https://www.notion.so\",\r\n            referer: \"https://www.notion.so\",\r\n        };\r\n        this.custom = {\r\n            createWebClippedPage: function (parentId, _a) {\r\n                var title = _a.title, url = _a.url;\r\n                return __awaiter(_this, void 0, void 0, function () {\r\n                    var x;\r\n                    return __generator(this, function (_b) {\r\n                        switch (_b.label) {\r\n                            case 0: return [4 /*yield*/, this.addWebClipperURLs({\r\n                                    blockId: parentId,\r\n                                    items: [{ title: title, url: url }],\r\n                                    from: \"chrome\",\r\n                                    type: \"block\",\r\n                                })];\r\n                            case 1:\r\n                                x = _b.sent();\r\n                                return [2 /*return*/, x.createdBlockIds[0]];\r\n                        }\r\n                    });\r\n                });\r\n            },\r\n        };\r\n        this.token = token;\r\n    }\r\n    NotionV3Client.prototype._axios = function (route, method, data, headers) {\r\n        if (method === void 0) { method = \"get\"; }\r\n        if (data === void 0) { data = {}; }\r\n        if (headers === void 0) { headers = {}; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var res;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, fetch(\"https://www.notion.so/api/v3/\" + ((route.startsWith(\"/\") && route.slice(1)) || route), {\r\n                            method: method.toUpperCase(),\r\n                            headers: __assign(__assign(__assign({ \"content-type\": \"application/json\" }, this.defaultHeaders), (this.token && { cookie: \"token_v2=\" + this.token })), headers),\r\n                            body: JSON.stringify(data),\r\n                        })];\r\n                    case 1:\r\n                        res = _a.sent();\r\n                        return [2 /*return*/, res.json()];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    NotionV3Client.prototype.post = function (route, data, headers) {\r\n        if (data === void 0) { data = {}; }\r\n        if (headers === void 0) { headers = {}; }\r\n        return this._axios(route, \"post\", data, headers);\r\n    };\r\n    NotionV3Client.prototype.put = function (route, data, headers) {\r\n        if (data === void 0) { data = {}; }\r\n        if (headers === void 0) { headers = {}; }\r\n        return this._axios(route, \"put\", data, headers);\r\n    };\r\n    NotionV3Client.prototype.delete = function (route) {\r\n        return this._axios(route, \"delete\");\r\n    };\r\n    NotionV3Client.prototype.get = function (route) {\r\n        return this._axios(route, \"get\", null);\r\n    };\r\n    NotionV3Client.prototype.addWebClipperURLs = function (d) {\r\n        return this.post(\"/addWebClipperURLs\", d);\r\n    };\r\n    return NotionV3Client;\r\n}());\r\nexports.NotionV3Client = NotionV3Client;\r\nvar idToUuid = function (path) {\r\n    return path.substr(0, 8) + \"-\" + path.substr(8, 4) + \"-\" + path.substr(12, 4) + \"-\" + path.substr(16, 4) + \"-\" + path.substr(20);\r\n};\r\nvar parsePageId = function (id) {\r\n    if (id) {\r\n        var rawId = id.replace(/\\-/g, \"\").slice(-32);\r\n        return idToUuid(rawId);\r\n    }\r\n};\r\nvar castRowProperty = function (d, property) {\r\n    //for now cast simple data\r\n    switch (property.type) {\r\n        case \"checkbox\":\r\n            return d[0][0] == \"Yes\";\r\n        case \"select\":\r\n        case \"text\":\r\n        case \"title\":\r\n        case \"url\":\r\n            return d[0][0];\r\n        case \"number\":\r\n            return Number(d[0][0]);\r\n        default:\r\n            util_1.print(\"WARNING \" + property.type + \" not casted\");\r\n            return d;\r\n    }\r\n};\r\n//todo: find better name for those two functions\r\nvar uncastRowProperty = function (v, property) {\r\n    switch (property.type) {\r\n        case \"checkbox\":\r\n            if (typeof v != \"boolean\")\r\n                throw \"value passed to property \" + property.strippedName + \" must be bool\";\r\n            return [[v ? \"Yes\" : \"No\"]];\r\n        case \"select\":\r\n        //todo detect if v does not belong to one of the select possibilities\r\n        case \"text\":\r\n        case \"title\":\r\n            if (typeof v != \"string\") {\r\n                throw \"value passed to property \" + property.strippedName + \" must be string, but got \" + v;\r\n            }\r\n            return [[v]];\r\n        case \"number\":\r\n            return [[String(parseFloat(v))]];\r\n        /*if (typeof v != \"number\")\r\n            throw `value passed to property ${property.strippedName} must be number`\r\n          return [[String(v)]]*/\r\n        case \"multi_select\":\r\n            return [[v.join(\",\")]];\r\n        case \"relation\":\r\n            return v;\r\n        default:\r\n            util_1.print(\"WARNING: \" + property.type + \" not uncasted\");\r\n            return [[v]];\r\n    }\r\n};\r\nfunction getFrontPageImageOperations(pageId, _a) {\r\n    var imgUrl = _a.imgUrl, width = _a.width, height = _a.height, opts = _a.opts;\r\n    util_1.print(\"here\", \"ok\", \"ok\");\r\n    //reset content\r\n    var newBlockId = uuid();\r\n    var newDividerBlockId = uuid();\r\n    var maxSizes = {\r\n        large: {\r\n            width: 672,\r\n            height: 380,\r\n        },\r\n        normal: {\r\n            width: 672,\r\n            height: 250,\r\n        },\r\n        small: {\r\n            width: 336,\r\n            height: 175,\r\n        },\r\n    };\r\n    var maxWidth = maxSizes[opts.size].width;\r\n    var maxHeight = maxSizes[opts.size].height;\r\n    var w = null;\r\n    var h = null;\r\n    var fullWidth = false;\r\n    var blockPageWidth = false;\r\n    switch (opts.type) {\r\n        case \"coverLike\":\r\n            if (opts.size == \"large\")\r\n                blockPageWidth = true;\r\n            w = width;\r\n            h = height;\r\n            //scale image to maxHeight\r\n            if (w != maxWidth) {\r\n                h = Math.floor(h * (maxWidth / w));\r\n                w = maxWidth;\r\n            }\r\n            if (h > maxHeight) {\r\n                w = Math.floor(w * (maxHeight / h));\r\n                h = maxHeight;\r\n            }\r\n            if (w < maxWidth) {\r\n                blockPageWidth = false;\r\n            }\r\n            util_1.print(\"heve\", h, w);\r\n            h = null;\r\n            break;\r\n        case \"fullWidthCover\":\r\n            fullWidth = true;\r\n            h = maxHeight;\r\n        case \"original\":\r\n        default:\r\n            break;\r\n    }\r\n    /*const sizes = {\r\n        'big':500,\r\n        'small':180,\r\n        original:null,\r\n    }*/\r\n    return __spreadArrays([\r\n        {\r\n            id: newBlockId,\r\n            table: \"block\",\r\n            path: [],\r\n            command: \"set\",\r\n            args: {\r\n                type: \"text\",\r\n                id: newBlockId,\r\n                version: 1,\r\n            },\r\n        },\r\n        {\r\n            id: newBlockId,\r\n            table: \"block\",\r\n            path: [],\r\n            command: \"update\",\r\n            args: {\r\n                parent_id: pageId,\r\n                parent_table: \"block\",\r\n                alive: true,\r\n            },\r\n        },\r\n        {\r\n            table: \"block\",\r\n            id: pageId,\r\n            path: [\"content\"],\r\n            command: \"listBefore\",\r\n            args: { id: newBlockId },\r\n        },\r\n        //set image\r\n        {\r\n            id: newBlockId,\r\n            table: \"block\",\r\n            path: [],\r\n            command: \"update\",\r\n            args: { type: \"image\" },\r\n        },\r\n        {\r\n            id: newBlockId,\r\n            table: \"block\",\r\n            path: [\"properties\"],\r\n            command: \"update\",\r\n            args: {\r\n                source: [[imgUrl]],\r\n            },\r\n        },\r\n        {\r\n            id: newBlockId,\r\n            table: \"block\",\r\n            path: [\"format\"],\r\n            command: \"update\",\r\n            args: {\r\n                display_source: imgUrl,\r\n            },\r\n        },\r\n        {\r\n            id: newBlockId,\r\n            table: \"block\",\r\n            path: [\"format\"],\r\n            command: \"update\",\r\n            args: {\r\n                block_height: h,\r\n                block_width: w,\r\n                block_full_width: fullWidth,\r\n                block_page_width: blockPageWidth,\r\n            },\r\n        }\r\n    ], (((opts.addDivider == true || opts.addDivider === undefined) && [\r\n        {\r\n            id: newDividerBlockId,\r\n            table: \"block\",\r\n            path: [],\r\n            command: \"set\",\r\n            args: {\r\n                type: \"divider\",\r\n                id: newDividerBlockId,\r\n                properties: {},\r\n            },\r\n        },\r\n        {\r\n            id: newDividerBlockId,\r\n            table: \"block\",\r\n            path: [],\r\n            command: \"update\",\r\n            args: {\r\n                parent_id: pageId,\r\n                parent_table: \"block\",\r\n                alive: true,\r\n            },\r\n        },\r\n        {\r\n            table: \"block\",\r\n            id: pageId,\r\n            path: [\"content\"],\r\n            command: \"listAfter\",\r\n            args: {\r\n                after: newBlockId,\r\n                id: newDividerBlockId,\r\n            },\r\n        },\r\n    ]) ||\r\n        []));\r\n}\r\nfunction getTransacOperationsFromWebClipping(pageId, userId, d) {\r\n    var newBlockId = uuid();\r\n    var args = {\r\n        id: newBlockId,\r\n        version: 1,\r\n        alive: true,\r\n        created_by: userId,\r\n        created_time: Date.now(),\r\n        parent_id: pageId,\r\n        parent_table: \"block\",\r\n        type: \"page\",\r\n    };\r\n    return [\r\n        buildOperation({ id: newBlockId, command: \"set\", args: args, table: \"block\" }),\r\n        {\r\n            table: \"block\",\r\n            id: pageId,\r\n            path: [\"content\"],\r\n            command: \"listAfter\",\r\n            args: {\r\n                id: newBlockId,\r\n            },\r\n        },\r\n    ];\r\n}\r\nfunction buildOperation(param) {\r\n    param = __assign({ table: \"block\", path: [], args: {}, command: \"set\" }, param);\r\n    //if (type(path) == \"string\") path = path.split(\".\");\r\n    return {\r\n        id: param.id,\r\n        path: param.path,\r\n        args: param.args,\r\n        command: param.command,\r\n        table: param.table,\r\n    };\r\n}\r\nvar domainsIncludeFrontImageMap = {\r\n    \"youtube.com\": true,\r\n};\r\nvar Collection = /** @class */ (function () {\r\n    function Collection(id, viewId, parentId, notionClient) {\r\n        this.id = id;\r\n        this.parentId = parentId;\r\n        this.fetched = false;\r\n        this.schema = {};\r\n        this.viewId = viewId;\r\n        this.rows = {};\r\n        this.client = notionClient;\r\n    }\r\n    Collection.prototype.initLocally = function (schema) {\r\n        this._extractSchema(schema);\r\n        this.fetched = true;\r\n    };\r\n    Collection.prototype._extractSchema = function (schema) {\r\n        this.schema = {};\r\n        for (var _i = 0, _a = Object.keys(schema); _i < _a.length; _i++) {\r\n            var uid = _a[_i];\r\n            var property = schema[uid];\r\n            this.schema[uid] = __assign(__assign({}, property), { id: uid, strippedName: \"\" });\r\n        }\r\n        //print('loaded schema\\n', ydump(this.schema));\r\n        util_1.print(\"keys are \", Object.keys(this.schema));\r\n    };\r\n    Collection.prototype.createRow = function (data, saveWebClip) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var lowOp, recordId, clientV2, _a, id, operations, skipFrontImage, u, n;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        lowOp = [];\r\n                        recordId = null;\r\n                        if (!saveWebClip) return [3 /*break*/, 2];\r\n                        clientV2 = new NotionV3Client(this.client.authToken);\r\n                        console.log(\"got\", data);\r\n                        return [4 /*yield*/, clientV2.custom.createWebClippedPage(this.parentId, {\r\n                                title: data.title,\r\n                                url: saveWebClip.url,\r\n                            })];\r\n                    case 1:\r\n                        recordId = _b.sent();\r\n                        console.log(\"got\", recordId);\r\n                        return [3 /*break*/, 3];\r\n                    case 2:\r\n                        _a = this.client.createRecordOperations(\"block\", { id: this.id, _table: \"collection\" }, { type: \"page\" }), id = _a.id, operations = _a.operations;\r\n                        recordId = id;\r\n                        lowOp = operations;\r\n                        _b.label = 3;\r\n                    case 3:\r\n                        this.rows[recordId] = { id: recordId };\r\n                        skipFrontImage = false;\r\n                        if (saveWebClip != null) {\r\n                            skipFrontImage = true;\r\n                            try {\r\n                                u = new URL(saveWebClip.url);\r\n                                console.log(\"got\", u.hostname);\r\n                                n = (u.hostname.startsWith(\"www.\") && u.hostname.substring(4)) ||\r\n                                    u.hostname;\r\n                                console.log(\">>>>\", n);\r\n                                if (n in domainsIncludeFrontImageMap)\r\n                                    skipFrontImage = false;\r\n                            }\r\n                            catch (e) {\r\n                                //ignore\r\n                            }\r\n                        }\r\n                        return [2 /*return*/, this.updateRow({\r\n                                where: { id: recordId },\r\n                                data: data,\r\n                                operations: lowOp,\r\n                                skipFrontImage: skipFrontImage,\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Collection.prototype.findRow = function (_a) {\r\n        var where = _a.where;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var countTotal, id, row, countSame, field;\r\n            return __generator(this, function (_b) {\r\n                //await this.ready();\r\n                if (where.id && where.id in this.rows) {\r\n                    return [2 /*return*/, this.rows[where.id]];\r\n                }\r\n                countTotal = Object.keys(where).length;\r\n                for (id in this.rows) {\r\n                    row = this.rows[id];\r\n                    countSame = 0;\r\n                    for (field in where) {\r\n                        if (row[field] == where[field]) {\r\n                            countSame++;\r\n                        }\r\n                        else {\r\n                            break;\r\n                        }\r\n                    }\r\n                    if (countSame == countTotal)\r\n                        return [2 /*return*/, row];\r\n                }\r\n                return [2 /*return*/, null];\r\n            });\r\n        });\r\n    };\r\n    Collection.prototype.updateRow = function (_a) {\r\n        var where = _a.where, data = _a.data, operations = _a.operations, skipFrontImage = _a.skipFrontImage;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var transacs, lowOperations, x, recordId, _b, _c, _d, uid, property, path, value, row, k;\r\n            return __generator(this, function (_e) {\r\n                switch (_e.label) {\r\n                    case 0:\r\n                        transacs = [];\r\n                        lowOperations = operations;\r\n                        return [4 /*yield*/, this.findRow({ where: where })];\r\n                    case 1:\r\n                        x = _e.sent();\r\n                        if (!x)\r\n                            throw \"can't update because row not found\";\r\n                        recordId = x.id;\r\n                        if (!data.__template) return [3 /*break*/, 3];\r\n                        _c = (_b = lowOperations.push).apply;\r\n                        _d = [lowOperations];\r\n                        return [4 /*yield*/, appUtils_1.getTransacOperationsFromTemplate(data.__template.blocksMap, data.__template.id, x.id)];\r\n                    case 2:\r\n                        _c.apply(_b, _d.concat([(_e.sent())]));\r\n                        util_1.print(lowOperations, \"\\x1b[43m -- lowOperations \\x1b[0m\");\r\n                        _e.label = 3;\r\n                    case 3:\r\n                        if (data.pageFrontImage && skipFrontImage == false) {\r\n                            lowOperations.push.apply(lowOperations, getFrontPageImageOperations(x.id, data.pageFrontImage));\r\n                        }\r\n                        for (uid in data) {\r\n                            if (uid == \"__template\" || uid == \"pageFrontImage\")\r\n                                continue;\r\n                            if (uid == \"pageCover\") {\r\n                                transacs.push({\r\n                                    path: [\"format\", \"page_cover\"],\r\n                                    value: data[uid].imgUrl,\r\n                                });\r\n                                continue;\r\n                            }\r\n                            if (uid == \"pageIcon\") {\r\n                                transacs.push({\r\n                                    path: [\"format\", \"page_icon\"],\r\n                                    value: data[uid].imgUrl,\r\n                                });\r\n                                continue;\r\n                            }\r\n                            property = this.schema[uid];\r\n                            path = [\"properties\", property.id];\r\n                            value = uncastRowProperty(data[uid], property);\r\n                            transacs.push({ path: path, value: value });\r\n                        }\r\n                        //transacs.push({ path: [\"last_edited_time\"], value: Date.now() })\r\n                        return [4 /*yield*/, this.client.updateDataRecord(recordId, transacs, lowOperations)];\r\n                    case 4:\r\n                        //transacs.push({ path: [\"last_edited_time\"], value: Date.now() })\r\n                        _e.sent();\r\n                        row = this.rows[recordId];\r\n                        for (k in data) {\r\n                            row[k] = data[k];\r\n                        }\r\n                        //let path = [\"properties\", prop[\"id\"]], val\r\n                        return [2 /*return*/, { id: row.id }];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return Collection;\r\n}());\r\nexports.Collection = Collection;\r\n//todo: stop having a global agent, and migrate agent inside NotionClient\r\nexports.client = null;\r\nfunction getDepVal(properties, key, defaultValue) {\r\n    return ((properties != null &&\r\n        properties[key] != null &&\r\n        properties[key].length &&\r\n        properties[key][0].length &&\r\n        properties[key][0][0]) ||\r\n        defaultValue);\r\n}\r\nfunction getParents(blocksMap, id) {\r\n    var _a, _b;\r\n    var parents = [];\r\n    var block = blocksMap[id];\r\n    while (block != null) {\r\n        if (!block.value)\r\n            break;\r\n        if (block.value.type == \"page\") {\r\n            parents.push({\r\n                name: getDepVal(block.value.properties, \"title\", \"Untitled\"),\r\n                icon: ((_a = block.value.format) === null || _a === void 0 ? void 0 : _a.page_icon) || null,\r\n            });\r\n        }\r\n        block = blocksMap[((_b = block.value) === null || _b === void 0 ? void 0 : _b.parent_id) || null];\r\n    }\r\n    parents.reverse();\r\n    return parents;\r\n}\r\nvar emptyUser = { id: null, spaces: [], givenName: null };\r\nvar DummyNotionClient = /** @class */ (function () {\r\n    /** Todo : need to improve the simple App */\r\n    function DummyNotionClient(notionAuthToken) {\r\n        this.agent = notionapi_1.createAgent({ token: notionAuthToken, debug: false });\r\n        this.authToken = notionAuthToken;\r\n        this.user = emptyUser;\r\n    }\r\n    DummyNotionClient.prototype.addValueToPropertyCollection = function (col, propertyId, value, valueId, color) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var newSchema, newVal;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        newSchema = __assign({}, col.schema);\r\n                        newVal = {\r\n                            id: valueId,\r\n                            value: value,\r\n                            color: color,\r\n                        };\r\n                        newSchema[propertyId] = __assign(__assign({}, newSchema[propertyId]), { options: __spreadArrays((newSchema[propertyId].options || []), [newVal]) });\r\n                        return [4 /*yield*/, this._submitTransaction([\r\n                                {\r\n                                    id: col.id,\r\n                                    table: \"collection\",\r\n                                    path: [],\r\n                                    command: \"update\",\r\n                                    args: {\r\n                                        schema: newSchema,\r\n                                    },\r\n                                },\r\n                            ])];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2 /*return*/, newVal];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    DummyNotionClient.prototype.setUserInfos = function (user) {\r\n        this.user = user;\r\n    };\r\n    DummyNotionClient.prototype.fetchUserInfos = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var res, userKeys, userData, spaceId, space;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.agent.loadUserContent({})\r\n                        //Todo: ensure security here before publishing app? -- create another account and see if data different\r\n                    ];\r\n                    case 1:\r\n                        res = _a.sent();\r\n                        userKeys = Object.keys(res.recordMap.notion_user);\r\n                        this.user.id = userKeys[0];\r\n                        userData = res.recordMap.notion_user[this.user.id];\r\n                        this.user.givenName = userData.value.given_name;\r\n                        for (spaceId in res.recordMap.space) {\r\n                            space = res.recordMap.space[spaceId];\r\n                            this.user.spaces.push({ id: spaceId, name: space.value.name });\r\n                        }\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    DummyNotionClient.prototype.createRecordOperations = function (table, parent, extra) {\r\n        if (extra === void 0) { extra = {}; }\r\n        var recordId = uuid();\r\n        var args = __assign({ id: recordId, version: 1, alive: true, created_by: this.user.id, created_time: Date.now(), last_edited_time: Date.now(), parent_id: parent.id, parent_table: parent._table }, extra);\r\n        return {\r\n            id: recordId,\r\n            operations: [\r\n                this._buildOperation({ id: recordId, command: \"set\", args: args, table: table }),\r\n            ],\r\n        };\r\n    };\r\n    DummyNotionClient.prototype.createRecord = function (table, parent, extra) {\r\n        if (extra === void 0) { extra = {}; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var recordId, args;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        recordId = extra[\"id\"] || uuid();\r\n                        args = __assign({ id: recordId, version: 1, alive: true, created_by: this.user.id, created_time: Date.now(), last_edited_time: Date.now(), parent_id: parent.id, parent_table: parent._table }, extra);\r\n                        return [4 /*yield*/, this._submitTransaction([\r\n                                this._buildOperation({ id: recordId, command: \"set\", args: args, table: table }),\r\n                            ])];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2 /*return*/, recordId];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    DummyNotionClient.prototype.updateDataRecord = function (recordId, dataPaths, lowLevelOperations) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this._submitTransaction(__spreadArrays((lowLevelOperations || []), dataPaths.map(function (data) {\r\n                            return _this._buildOperation({\r\n                                id: recordId,\r\n                                command: \"set\",\r\n                                table: \"block\",\r\n                                path: data.path,\r\n                                args: data.value,\r\n                            });\r\n                        })))];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2 /*return*/, recordId];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    DummyNotionClient.prototype.getCollectionLocally = function (collectionId, parentId, schema) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var col;\r\n            return __generator(this, function (_a) {\r\n                col = new Collection(collectionId, \"\", parentId, this);\r\n                col.initLocally(schema);\r\n                return [2 /*return*/, col];\r\n            });\r\n        });\r\n    };\r\n    DummyNotionClient.prototype._buildOperation = function (param) {\r\n        param = __assign({ table: \"block\", path: [], args: {}, command: \"set\" }, param);\r\n        //if (type(path) == \"string\") path = path.split(\".\");\r\n        return {\r\n            id: param.id,\r\n            path: param.path,\r\n            args: param.args,\r\n            command: param.command,\r\n            table: param.table,\r\n        };\r\n    };\r\n    DummyNotionClient.prototype.searchCollectionPages = function (query, collectionId, spaceId) {\r\n        var _a;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var ret, pages, _i, _b, obj, k, page;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0: return [4 /*yield*/, this.agent.search({\r\n                            type: \"BlocksInParent\",\r\n                            query: query,\r\n                            spaceId: spaceId,\r\n                            parentId: collectionId,\r\n                            limit: 20,\r\n                            filters: {\r\n                                isDeletedOnly: false,\r\n                                excludeTemplates: true,\r\n                                isNavigableOnly: true,\r\n                                requireEditPermissions: false,\r\n                                ancestors: [],\r\n                                createdBy: [],\r\n                                editedBy: [],\r\n                                lastEditedTime: {},\r\n                                createdTime: {},\r\n                            },\r\n                            sort: \"Relevance\",\r\n                            source: \"relation_menu\",\r\n                        })];\r\n                    case 1:\r\n                        ret = _c.sent();\r\n                        pages = [];\r\n                        for (_i = 0, _b = ret.results; _i < _b.length; _i++) {\r\n                            obj = _b[_i];\r\n                            k = obj.id;\r\n                            if (!(k in ret.recordMap.block))\r\n                                continue;\r\n                            page = ret.recordMap.block[k].value;\r\n                            //todo: return also permission\r\n                            pages.push({\r\n                                id: page.id,\r\n                                name: getDepVal(page.properties, \"title\", \"Untitled\"),\r\n                                icon: ((_a = page.format) === null || _a === void 0 ? void 0 : _a.page_icon) || null,\r\n                            });\r\n                        }\r\n                        return [2 /*return*/, pages];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    DummyNotionClient.prototype.searchCollections = function (query, spaceId) {\r\n        if (query === void 0) { query = \"\"; }\r\n        if (spaceId === void 0) { spaceId = this.user.spaces[0].id; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var ret, collections, k, col;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.agent.search({\r\n                            query: query,\r\n                            type: \"CollectionsInSpace\",\r\n                            spaceId: spaceId,\r\n                            limit: 20,\r\n                            sort: \"Relevance\",\r\n                            source: \"link_to_collection_block\",\r\n                            filters: {\r\n                                /*ancestors: []\r\n                                createdBy: []\r\n                                createdTime: {}\r\n                                editedBy: []\r\n                                excludeTemplates: true\r\n                                isDeletedOnly: false\r\n                                isNavigableOnly: false\r\n                                lastEditedTime: {}\r\n                                requireEditPermissions: true*/\r\n                                isDeletedOnly: false,\r\n                                excludeTemplates: true,\r\n                                isNavigableOnly: false,\r\n                                requireEditPermissions: true,\r\n                                ancestors: [],\r\n                                createdBy: [],\r\n                                editedBy: [],\r\n                                lastEditedTime: {},\r\n                                createdTime: {},\r\n                            },\r\n                        })];\r\n                    case 1:\r\n                        ret = _a.sent();\r\n                        collections = [];\r\n                        for (k in ret.recordMap.collection) {\r\n                            col = ret.recordMap.collection[k].value;\r\n                            col.parents = getParents(ret.recordMap.block, col.parent_id);\r\n                            collections.push(col);\r\n                        }\r\n                        return [2 /*return*/, collections];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    DummyNotionClient.prototype._submitTransaction = function (operations) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2 /*return*/, this.agent.submitTransaction({\r\n                        requestId: uuid(),\r\n                        transactions: [\r\n                            {\r\n                                id: uuid(),\r\n                                operations: operations,\r\n                            },\r\n                        ],\r\n                    })];\r\n            });\r\n        });\r\n    };\r\n    DummyNotionClient.prototype.appendBulletPointToPage = function (pageId, text) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var newBlockId, operations;\r\n            return __generator(this, function (_a) {\r\n                newBlockId = uuid();\r\n                pageId = parsePageId(pageId);\r\n                util_1.print(\"got\", pageId);\r\n                operations = [\r\n                    {\r\n                        id: newBlockId,\r\n                        table: \"block\",\r\n                        path: [],\r\n                        command: \"update\",\r\n                        args: {\r\n                            type: \"bulleted_list\",\r\n                            id: newBlockId,\r\n                            parent_id: pageId,\r\n                            parent_table: \"block\",\r\n                            alive: true,\r\n                            version: 1,\r\n                            created_time: Date.now(),\r\n                            last_edited_time: Date.now(),\r\n                            properties: { title: [[text]] },\r\n                        },\r\n                    },\r\n                    {\r\n                        table: \"block\",\r\n                        id: pageId,\r\n                        path: [\"content\"],\r\n                        command: \"listAfter\",\r\n                        args: {\r\n                            id: newBlockId,\r\n                        },\r\n                    },\r\n                ];\r\n                return [2 /*return*/, this._submitTransaction(operations)];\r\n            });\r\n        });\r\n    };\r\n    return DummyNotionClient;\r\n}());\r\nexports.DummyNotionClient = DummyNotionClient;\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/** Import libraries. */\r\nvar logger_1 = require(\"@dnpr/logger\");\r\n/**\r\n * @category Library Internal\r\n */\r\nvar log = new logger_1.Logger(\"notionapi-agent\");\r\nexports.log = log;\r\n","\"use strict\";\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar notion_1 = require(\"./notionlib/notion\");\r\nvar appConfig_1 = require(\"./appConfig\");\r\nvar appConfig_2 = require(\"./appConfig\");\r\nvar storage_1 = __importDefault(require(\"./lib/storage\"));\r\nvar utils_1 = require(\"./utils\");\r\nvar fetchFullContentPage_1 = require(\"./notionapiV2/fetchFullContentPage\");\r\nvar uuid = require(\"uuid/v4\");\r\nfunction getFormData(id) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, storage_1.default.get(appConfig_1.FORM_KEY_PREFIX + id, null)];\r\n                case 1: return [2 /*return*/, _a.sent()];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.getFormData = getFormData;\r\nfunction saveCurrentPopupState(state) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            return [2 /*return*/, storage_1.default.set(\"popup-state\", __assign(__assign({}, state), { createdAt: Date.now(), lastUpdatedAt: Date.now() }))];\r\n        });\r\n    });\r\n}\r\nexports.saveCurrentPopupState = saveCurrentPopupState;\r\nfunction getCurrentPopupState(currentUrl) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var state, now;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, storage_1.default.get(\"popup-state\", null)];\r\n                case 1:\r\n                    state = _a.sent();\r\n                    if (!state)\r\n                        return [2 /*return*/, state];\r\n                    resetCurrentPopupState();\r\n                    now = Date.now();\r\n                    switch (state.pos) {\r\n                        /*case \"fillFormSettings\":\r\n                          //above 1 minute\r\n                          if (now - state.last > 1000 * 60) {\r\n                            return null\r\n                          }*/\r\n                        case \"fillForm\":\r\n                            if (state.url != currentUrl)\r\n                                return [2 /*return*/, null\r\n                                    //above 1 minute\r\n                                ];\r\n                            //above 1 minute\r\n                            if (now - state.lastUpdatedAt > 1000 * 60) {\r\n                                return [2 /*return*/, null];\r\n                            }\r\n                            return [2 /*return*/, state];\r\n                        case \"settings\":\r\n                            //above 1 minute\r\n                            if (now - state.lastUpdatedAt > 1000 * 60) {\r\n                                return [2 /*return*/, null];\r\n                            }\r\n                            return [2 /*return*/, state];\r\n                    }\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.getCurrentPopupState = getCurrentPopupState;\r\nfunction resetCurrentPopupState() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            return [2 /*return*/, saveCurrentPopupState(null)];\r\n        });\r\n    });\r\n}\r\nexports.resetCurrentPopupState = resetCurrentPopupState;\r\nfunction deleteFormData(id) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var forms;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, storage_1.default.get(appConfig_1.FORM_LIST_KEY, [])];\r\n                case 1:\r\n                    forms = _a.sent();\r\n                    storage_1.default.set(appConfig_1.FORM_LIST_KEY, forms.filter(function (form) { return form.id != id; }));\r\n                    storage_1.default.set(appConfig_1.FORM_KEY_PREFIX + id, null);\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.deleteFormData = deleteFormData;\r\nfunction saveFormData(data, status, id) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var forms, formInfo, id_1;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, storage_1.default.get(appConfig_1.FORM_LIST_KEY, [])];\r\n                case 1:\r\n                    forms = _a.sent();\r\n                    if (!(status == \"new\")) return [3 /*break*/, 4];\r\n                    id_1 = utils_1.makeid(4);\r\n                    while (forms.some(function (e) { return e.id == id_1; }))\r\n                        id_1 = utils_1.makeid(4);\r\n                    data.id = id_1;\r\n                    forms.push({ name: data.name, id: id_1 });\r\n                    return [4 /*yield*/, storage_1.default.set(appConfig_1.FORM_LIST_KEY, forms)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, storage_1.default.set(appConfig_1.FORM_KEY_PREFIX + id_1, sanitizeFormData(data))];\r\n                case 3:\r\n                    _a.sent();\r\n                    formInfo = { id: id_1, name: data.name };\r\n                    return [3 /*break*/, 7];\r\n                case 4:\r\n                    forms = forms.map(function (e) {\r\n                        return e.id != id\r\n                            ? e\r\n                            : { name: data.name, id: id, favorite: e.favorite === true ? true : false };\r\n                    });\r\n                    formInfo = { id: id, name: data.name };\r\n                    return [4 /*yield*/, storage_1.default.set(appConfig_1.FORM_LIST_KEY, forms)];\r\n                case 5:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, storage_1.default.set(appConfig_1.FORM_KEY_PREFIX + id, sanitizeFormData(data))];\r\n                case 6:\r\n                    _a.sent();\r\n                    _a.label = 7;\r\n                case 7:\r\n                    utils_1.print(\"storage size: \", JSON.stringify(data).length);\r\n                    return [2 /*return*/, formInfo];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.saveFormData = saveFormData;\r\nfunction sanitizeFormData(data) {\r\n    console.log(\"colection !!!\", data.collection);\r\n    return __assign(__assign({}, data), { collection: __assign({}, data.collection), name: (data.name.length && data.name) || \"Untitled\", daps: data.daps.filter(function (field) {\r\n            return field.property != null;\r\n        }) });\r\n}\r\nfunction copyBlockOperation(block, parentId, blocksMap, currentId) {\r\n    var newBlockId = currentId || uuid();\r\n    var op = {\r\n        id: newBlockId,\r\n        table: \"block\",\r\n        path: [],\r\n        command: \"update\",\r\n        args: {},\r\n    };\r\n    var ops = [op];\r\n    if (block.role == \"none\") {\r\n        return {\r\n            id: newBlockId,\r\n            ops: [__assign(__assign({}, op), { args: { type: \"text\", parent_id: parentId } })],\r\n        };\r\n    }\r\n    var blockVal = block.value;\r\n    op.args = __assign(__assign({}, blockVal), { id: newBlockId, parent_id: parentId, copied_from: blockVal.id });\r\n    [\"is_template\", \"created_time\", \"last_edited_time\"].forEach(function (key) {\r\n        delete op.args[key];\r\n    });\r\n    if (blockVal.content) {\r\n        var childResults = blockVal.content.map(function (id) {\r\n            return copyBlockOperation(blocksMap[id], newBlockId, blocksMap);\r\n        });\r\n        var newContent = childResults.map(function (op) { return op.id; });\r\n        op.args.content = newContent;\r\n        ops.push.apply(ops, childResults.flatMap(function (res) { return res.ops; }));\r\n    }\r\n    return {\r\n        id: newBlockId,\r\n        ops: ops,\r\n    };\r\n}\r\nfunction getTransacOperationsFromTemplate(blocksMap, templateId, currentId) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var res;\r\n        return __generator(this, function (_a) {\r\n            res = copyBlockOperation(blocksMap[templateId], undefined, blocksMap, currentId);\r\n            return [2 /*return*/, res.ops];\r\n        });\r\n    });\r\n}\r\nexports.getTransacOperationsFromTemplate = getTransacOperationsFromTemplate;\r\nfunction getTransacOperationsFromWebClipping() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            return [2 /*return*/, []];\r\n        });\r\n    });\r\n}\r\nexports.getTransacOperationsFromWebClipping = getTransacOperationsFromWebClipping;\r\nfunction getUpToDateTemplateBlocksMap(client, templateId, refreshTemplate) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var content;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (!refreshTemplate) return [3 /*break*/, 3];\r\n                    utils_1.print(\"refreshing the template...\");\r\n                    return [4 /*yield*/, fetchFullContentPage_1.fetchFullContentPage(templateId, client.authToken)];\r\n                case 1:\r\n                    content = _a.sent();\r\n                    return [4 /*yield*/, storage_1.default.set(\"TEMPLATE-\" + templateId, content)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [3 /*break*/, 7];\r\n                case 3: return [4 /*yield*/, storage_1.default.get(\"TEMPLATE-\" + templateId, null)];\r\n                case 4:\r\n                    content = _a.sent();\r\n                    if (!(content == null)) return [3 /*break*/, 6];\r\n                    return [4 /*yield*/, getUpToDateTemplateBlocksMap(client, templateId, true)];\r\n                case 5:\r\n                    content = _a.sent();\r\n                    return [3 /*break*/, 7];\r\n                case 6:\r\n                    utils_1.print(\"got template from cache!\");\r\n                    _a.label = 7;\r\n                case 7:\r\n                    utils_1.print(content, \"\\x1b[43m -- content template \\x1b[0m\");\r\n                    return [2 /*return*/, content];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.getUpToDateTemplateBlocksMap = getUpToDateTemplateBlocksMap;\r\nfunction throttle(fn, waitMs) {\r\n    var last;\r\n    var prevFn;\r\n    var prevTimer;\r\n    return function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        var now = new Date();\r\n        if (prevFn) {\r\n            prevFn(undefined);\r\n            clearTimeout(prevTimer);\r\n            prevFn = null;\r\n        }\r\n        return new Promise(function (resolve) {\r\n            var x = last\r\n                ? Math.max(0, waitMs - (now.getTime() - last.getTime()))\r\n                : 0;\r\n            prevFn = resolve;\r\n            prevTimer = setTimeout(function () {\r\n                last = now;\r\n                prevFn = null;\r\n                resolve(fn.apply(null, args));\r\n            }, x);\r\n        });\r\n    };\r\n}\r\nexports.throttle = throttle;\r\nvar extraProperty = [\"pageCover\", \"pageFrontImage\", \"pageIcon\"];\r\nfunction applyRefreshCollection(result, oldDaps) {\r\n    if (result.needToResetCollection) {\r\n        return { daps: oldDaps, collection: undefined };\r\n    }\r\n    var daps = [];\r\n    var _loop_1 = function (d) {\r\n        var mField = result.fieldsToModify.find(function (f) { return f.key == d.key; });\r\n        //print(\"old dap\", d)\r\n        var nproperty = void 0;\r\n        if (d.property) {\r\n            if (extraProperty.some(function (e) { return e == d.property.id; })) {\r\n                utils_1.print(\"reaplie\", d.property);\r\n                nproperty = d.property;\r\n            }\r\n            else {\r\n                nproperty = __assign(__assign({}, result.collection.schema[d.property.id]), { id: d.property.id });\r\n            }\r\n        }\r\n        if (!mField) {\r\n            daps.push(__assign(__assign({}, d), { property: nproperty }));\r\n            return \"continue\";\r\n        }\r\n        switch (mField.action) {\r\n            case \"remove\": return \"continue\";\r\n            case \"removeDefaultValue\":\r\n                daps.push(__assign(__assign({}, d), { property: nproperty, options: {} }));\r\n                break;\r\n        }\r\n    };\r\n    for (var _i = 0, oldDaps_1 = oldDaps; _i < oldDaps_1.length; _i++) {\r\n        var d = oldDaps_1[_i];\r\n        _loop_1(d);\r\n    }\r\n    return { collection: result.collection, daps: daps };\r\n}\r\nexports.applyRefreshCollection = applyRefreshCollection;\r\nfunction applyRefreshCollectionOnData(result, oldData) {\r\n    var _a = applyRefreshCollection(result, oldData.daps), collection = _a.collection, daps = _a.daps;\r\n    return __assign(__assign({}, oldData), { collection: collection,\r\n        daps: daps, template: (!result.needToRemoveTemplate && oldData.template) || undefined, needToRefreshTemplate: result.needToRefreshTemplate });\r\n}\r\nexports.applyRefreshCollectionOnData = applyRefreshCollectionOnData;\r\nfunction getTemplateInfo(client, pageId) {\r\n    var _a, _b, _c;\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var resp, page;\r\n        return __generator(this, function (_d) {\r\n            switch (_d.label) {\r\n                case 0: return [4 /*yield*/, client.agent.loadPageChunk({\r\n                        pageId: pageId,\r\n                        limit: 1,\r\n                        cursor: {\r\n                            stack: [[{ id: pageId, table: \"block\", index: 0 }]],\r\n                        },\r\n                        chunkNumber: 0,\r\n                        verticalColumns: false,\r\n                    })];\r\n                case 1:\r\n                    resp = _d.sent();\r\n                    page = resp.recordMap.block[pageId];\r\n                    if (!page)\r\n                        return [2 /*return*/, null];\r\n                    utils_1.print(page, \"\\x1b[43m -- page \\x1b[0m\");\r\n                    return [2 /*return*/, {\r\n                            name: ((_a = page.value) === null || _a === void 0 ? void 0 : _a.properties.title[0][0]) || \"undefined\",\r\n                            id: pageId,\r\n                            lastEditedTime: page.value.last_edited_time || Date.now(),\r\n                            icon: ((_c = (_b = page.value) === null || _b === void 0 ? void 0 : _b.format) === null || _c === void 0 ? void 0 : _c.page_icon) || null,\r\n                        }];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Refresh the properties of the database  */\r\nfunction refreshCollection(client, collection, daps, config) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var result, resp, col, _a, stillExist, newTemplate, schema, ncol, _loop_2, _i, daps_1, dap;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    result = {\r\n                        needToResetCollection: false,\r\n                        fieldsToModify: [],\r\n                    };\r\n                    return [4 /*yield*/, client.agent.loadPageChunk({\r\n                            pageId: collection.parent_id,\r\n                            limit: 1,\r\n                            cursor: {\r\n                                stack: [[{ id: collection.parent_id, table: \"block\", index: 0 }]],\r\n                            },\r\n                            chunkNumber: 0,\r\n                            verticalColumns: false,\r\n                        })];\r\n                case 1:\r\n                    resp = _b.sent();\r\n                    if (!(collection.id in resp.recordMap.collection)) {\r\n                        result.needToResetCollection = true;\r\n                        return [2 /*return*/, result];\r\n                    }\r\n                    result.collection = resp.recordMap.collection[collection.id].value;\r\n                    col = result.collection;\r\n                    if (!(config.getTemplatesInfo && col.template_pages)) return [3 /*break*/, 3];\r\n                    _a = col;\r\n                    return [4 /*yield*/, Promise.all(col.template_pages.map(function (id) { return getTemplateInfo(client, id); }))];\r\n                case 2:\r\n                    _a.templatesInfo = _b.sent();\r\n                    _b.label = 3;\r\n                case 3:\r\n                    if (!config.checkTemplateUpToDate) return [3 /*break*/, 6];\r\n                    stillExist = (col.template_pages || []).some(function (id) { return config.checkTemplateUpToDate.id; });\r\n                    if (!!stillExist) return [3 /*break*/, 4];\r\n                    result.needToRemoveTemplate = true;\r\n                    return [3 /*break*/, 6];\r\n                case 4: return [4 /*yield*/, getTemplateInfo(client, config.checkTemplateUpToDate.id)];\r\n                case 5:\r\n                    newTemplate = _b.sent();\r\n                    utils_1.print(newTemplate.lastEditedTime >\r\n                        config.checkTemplateUpToDate.lastEditedTime, \"checking template is up to date\", config.checkTemplateUpToDate, newTemplate);\r\n                    if (newTemplate.lastEditedTime > config.checkTemplateUpToDate.lastEditedTime) {\r\n                        result.needToRefreshTemplate = true;\r\n                    }\r\n                    ;\r\n                    result.collection.template = newTemplate;\r\n                    _b.label = 6;\r\n                case 6:\r\n                    schema = result.collection.schema;\r\n                    return [4 /*yield*/, client.getCollectionLocally(collection.id, collection.parent_id, schema)\r\n                        //Verification of the fields\r\n                    ];\r\n                case 7:\r\n                    ncol = _b.sent();\r\n                    _loop_2 = function (dap) {\r\n                        if (dap.property) {\r\n                            if (extraProperty.some(function (e) { return e == dap.property.id; })) {\r\n                                return \"continue\";\r\n                            }\r\n                            if (!(dap.property.id in ncol.schema)) {\r\n                                result.fieldsToModify.push({ key: dap.key, action: \"remove\" });\r\n                            }\r\n                            else {\r\n                                //check same type\r\n                                var nproperty_1 = ncol.schema[dap.property.id];\r\n                                if (dap.property.type != nproperty_1.type) {\r\n                                    //need to reset\r\n                                    result.fieldsToModify.push({\r\n                                        key: dap.key,\r\n                                        action: \"removeDefaultValue\",\r\n                                    });\r\n                                }\r\n                                else {\r\n                                    if ([\"select\", \"multi_select\"].includes(dap.property.type)) {\r\n                                        //check if options need to be changed\r\n                                        switch (dap.property.type) {\r\n                                            case \"select\":\r\n                                                if (dap.options.defaultSelectId &&\r\n                                                    (!nproperty_1.options ||\r\n                                                        !nproperty_1.options.some(function (opt) { return opt.id == dap.options.defaultSelectId; }))) {\r\n                                                    result.fieldsToModify.push({\r\n                                                        key: dap.key,\r\n                                                        action: \"removeDefaultValue\",\r\n                                                    });\r\n                                                }\r\n                                                break;\r\n                                            case \"multi_select\":\r\n                                                if (dap.options.defaultSelectIds &&\r\n                                                    (!nproperty_1.options ||\r\n                                                        !dap.options.defaultSelectIds.every(function (id) {\r\n                                                            return nproperty_1.options.some(function (opt) { return opt.id == id; });\r\n                                                        }))) {\r\n                                                    result.fieldsToModify.push({\r\n                                                        key: dap.key,\r\n                                                        action: \"removeDefaultValue\",\r\n                                                    });\r\n                                                }\r\n                                                break;\r\n                                        }\r\n                                    }\r\n                                    //check default value\r\n                                }\r\n                            }\r\n                        }\r\n                    };\r\n                    //Verification of the fields\r\n                    for (_i = 0, daps_1 = daps; _i < daps_1.length; _i++) {\r\n                        dap = daps_1[_i];\r\n                        _loop_2(dap);\r\n                    }\r\n                    return [2 /*return*/, result];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.refreshCollection = refreshCollection;\r\nfunction encrypt(s) {\r\n    try {\r\n        return window.btoa(s);\r\n    }\r\n    catch (_a) {\r\n        return s;\r\n    }\r\n}\r\nfunction decrypt(s) {\r\n    try {\r\n        return window.atob(s);\r\n    }\r\n    catch (_a) {\r\n        return s;\r\n    }\r\n}\r\nfunction fetchNotionClient(client, cookie) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var err_1;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 2, , 3]);\r\n                    utils_1.print(\"fetch\", client.user);\r\n                    return [4 /*yield*/, client.fetchUserInfos()];\r\n                case 1:\r\n                    _a.sent();\r\n                    utils_1.print(\"fetchdone\", client.user);\r\n                    return [3 /*break*/, 3];\r\n                case 2:\r\n                    err_1 = _a.sent();\r\n                    return [2 /*return*/, { status: \"error\", errorMsg: \"cookie_expired\" }];\r\n                case 3: return [4 /*yield*/, storage_1.default.set(appConfig_2.NOTION_CLIENT_DATA_KEY, encrypt(JSON.stringify(client.user)))];\r\n                case 4:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, storage_1.default.set(appConfig_2.COOKIE_KEY, encrypt(cookie))];\r\n                case 5:\r\n                    _a.sent();\r\n                    return [2 /*return*/, { status: \"ok\", client: client }];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** get the client and update/refresh the cookie */\r\nfunction getClient(onStatusChange) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var client, cookieWrap, cookie, storedCookie, clientData;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, utils_1.promisify(chrome.cookies.get, {\r\n                        url: \"https://www.notion.so\",\r\n                        name: \"token_v2\",\r\n                    })];\r\n                case 1:\r\n                    cookieWrap = _a.sent();\r\n                    if (!cookieWrap) {\r\n                        return [2 /*return*/, { status: \"error\", errorMsg: \"need_to_login_to_notion\" }];\r\n                    }\r\n                    cookie = cookieWrap.value;\r\n                    return [4 /*yield*/, storage_1.default.get(appConfig_2.COOKIE_KEY, null)];\r\n                case 2:\r\n                    storedCookie = _a.sent();\r\n                    if (storedCookie) {\r\n                        storedCookie = decrypt(storedCookie);\r\n                    }\r\n                    return [4 /*yield*/, storage_1.default.get(appConfig_2.NOTION_CLIENT_DATA_KEY, null)];\r\n                case 3:\r\n                    clientData = _a.sent();\r\n                    if (clientData) {\r\n                        clientData = JSON.parse(decrypt(clientData));\r\n                    }\r\n                    client = new notion_1.DummyNotionClient(cookie);\r\n                    if (!(!storedCookie || storedCookie != cookie || !clientData)) return [3 /*break*/, 5];\r\n                    onStatusChange && onStatusChange(\"fetching_client\");\r\n                    return [4 /*yield*/, fetchNotionClient(client, cookie)];\r\n                case 4: return [2 /*return*/, _a.sent()];\r\n                case 5:\r\n                    client.setUserInfos(clientData);\r\n                    _a.label = 6;\r\n                case 6: return [2 /*return*/, { status: \"ok\", client: client }];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.getClient = getClient;\r\nvar cachedCollectionsMap = {};\r\nvar cachedCollectionsTimeout = {};\r\nfunction getCachedCollectionPages(collectionId) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var p;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (collectionId in cachedCollectionsMap)\r\n                        return [2 /*return*/, cachedCollectionsMap[collectionId].map];\r\n                    return [4 /*yield*/, storage_1.default.get(\"collection-pages-\" + collectionId, {\r\n                            count: 0,\r\n                            map: {},\r\n                            order: [],\r\n                        })];\r\n                case 1:\r\n                    p = _a.sent();\r\n                    cachedCollectionsMap[collectionId] = p;\r\n                    return [2 /*return*/, p.map];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.getCachedCollectionPages = getCachedCollectionPages;\r\nfunction upsertCachedCollectionPage(page, collectionId) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var p, oldId;\r\n        var _this = this;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, getCachedCollectionPages(collectionId)];\r\n                case 1:\r\n                    p = _a.sent();\r\n                    if (!(page.id in p)) {\r\n                        if (cachedCollectionsMap[collectionId].count > 300) {\r\n                            oldId = cachedCollectionsMap[collectionId].order.shift();\r\n                            delete p[oldId];\r\n                            cachedCollectionsMap[collectionId].count--;\r\n                        }\r\n                        cachedCollectionsMap[collectionId].count++;\r\n                        cachedCollectionsMap[collectionId].order.push(page.id);\r\n                    }\r\n                    p[page.id] = page;\r\n                    if (!cachedCollectionsTimeout[collectionId]) {\r\n                        cachedCollectionsTimeout[collectionId] = setTimeout(function () { return __awaiter(_this, void 0, void 0, function () {\r\n                            var m, keys, newMap;\r\n                            return __generator(this, function (_a) {\r\n                                switch (_a.label) {\r\n                                    case 0:\r\n                                        m = cachedCollectionsMap[collectionId].map;\r\n                                        keys = Object.keys(m).sort(function (a, b) {\r\n                                            return m[a].name.toLowerCase() < m[b].name.toLowerCase() ? -1 : 1;\r\n                                        });\r\n                                        newMap = {};\r\n                                        keys.forEach(function (k) { return (newMap[k] = cachedCollectionsMap[collectionId].map[k]); });\r\n                                        return [4 /*yield*/, storage_1.default.set(\"collection-pages-\" + collectionId, __assign(__assign({}, cachedCollectionsMap[collectionId]), { map: newMap }))];\r\n                                    case 1:\r\n                                        _a.sent();\r\n                                        cachedCollectionsTimeout[collectionId] = null;\r\n                                        return [2 /*return*/];\r\n                                }\r\n                            });\r\n                        }); }, 200);\r\n                    }\r\n                    return [2 /*return*/, p];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.upsertCachedCollectionPage = upsertCachedCollectionPage;\r\n","\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nvar _a, _b;\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar utils_1 = require(\"../utils\");\r\nfunction getCacheKey(key, i) {\r\n    return i === 0 ? key : key + \"_\" + i;\r\n}\r\nvar QUOTA_BYTES_PER_ITEM = ((_a = chrome.storage.sync) === null || _a === void 0 ? void 0 : _a.QUOTA_BYTES_PER_ITEM) || 8192;\r\nvar MAX_ITEMS = ((_b = chrome.storage.sync) === null || _b === void 0 ? void 0 : _b.MAX_ITEMS) || 512;\r\n/**\r\n * Allows to save strings longer than QUOTA_BYTES_PER_ITEM in chrome.storage.sync by splitting them into smaller parts.\r\n * Please note that you still can't save more than QUOTA_BYTES.\r\n *\r\n * @param {string} key\r\n * @param {string} value\r\n * @param {function(): void=} callback\r\n */\r\nfunction xset(key, obj, callback) {\r\n    var i = 0, cache = {}, segment, cacheKey;\r\n    // split value into chunks and store them in an object indexed by `key_i`\r\n    var value = JSON.stringify(obj);\r\n    var x = [];\r\n    while (value.length > 0) {\r\n        cacheKey = getCacheKey(key, i);\r\n        //if you are wondering about -2 at the end see: https://code.google.com/p/chromium/issues/detail?id=261572\r\n        segment = value.substr(0, QUOTA_BYTES_PER_ITEM - cacheKey.length - 2);\r\n        x.push(segment.length);\r\n        cache[cacheKey] = segment;\r\n        value = value.substr(QUOTA_BYTES_PER_ITEM - cacheKey.length - 2);\r\n        i++;\r\n    }\r\n    //console.log(chrome.storage.sync.QUOTA_BYTES_PER_ITEM, Object.keys(cache), x);\r\n    // store all the chunks\r\n    chrome.storage.local.set(cache, callback);\r\n    //we need to make sure that after the last chunk we have an empty chunk. Why this is so important?\r\n    // Saving v1 of our object. Chrome sync status: [chunk1v1] [chunk2v1] [chunk3v1]\r\n    // Saving v2 of our object (a bit smaller). Chrome sync status: [chunk1v2] [chunk2v2] [chunk3v1]\r\n    // When reading this configuration back we will end up with chunk3v1 being appended to the chunk1v2+chunk2v2\r\n    chrome.storage.local.remove(getCacheKey(key, i));\r\n}\r\n/**\r\n * Retrieves chunks of value stored in chrome.storage.sync and combines them.\r\n *\r\n * @param {string} key\r\n * @param {function(string):void=} callback\r\n * @param {function(string):void=} error callback\r\n */\r\nfunction xget(key, cb, err) {\r\n    //get everything from storage\r\n    chrome.storage.local.get(null, function (items) {\r\n        var i, value = \"\";\r\n        var found = false;\r\n        for (i = 0; i < MAX_ITEMS; i++) {\r\n            if (items[getCacheKey(key, i)] === undefined) {\r\n                break;\r\n            }\r\n            found = true;\r\n            value += items[getCacheKey(key, i)];\r\n        }\r\n        //console.log(\"value\",value);\r\n        if (found)\r\n            cb(JSON.parse(value));\r\n        else\r\n            err();\r\n    });\r\n}\r\n//let v = {}\r\nfunction get(key, defaultValue) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var _this = this;\r\n        return __generator(this, function (_a) {\r\n            //remove\r\n            /*return new Promise((accept) => {\r\n              print(\"set\", key, defaultValue)\r\n              if (v[key]) accept(v[key])\r\n              else accept(defaultValue)\r\n            })*/\r\n            //old\r\n            return [2 /*return*/, new Promise(function (accept) {\r\n                    xget(key, function (value) {\r\n                        accept(value);\r\n                    }, function () { return __awaiter(_this, void 0, void 0, function () {\r\n                        return __generator(this, function (_a) {\r\n                            switch (_a.label) {\r\n                                case 0:\r\n                                    utils_1.print(\"no value found, saving default\");\r\n                                    return [4 /*yield*/, set(key, defaultValue)];\r\n                                case 1:\r\n                                    _a.sent();\r\n                                    accept(defaultValue);\r\n                                    return [2 /*return*/];\r\n                            }\r\n                        });\r\n                    }); });\r\n                })];\r\n        });\r\n    });\r\n}\r\nexports.get = get;\r\nfunction set(key, obj) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            /*print(\r\n              \"storing\",\r\n              key,\r\n              obj,\r\n              chrome.storage.sync.QUOTA_BYTES_PER_ITEM,\r\n              chrome.storage.sync.MAX_ITEMS\r\n            )*/\r\n            new Promise(function (accept) {\r\n                xset(key, obj, function () {\r\n                    accept();\r\n                });\r\n            });\r\n            return [2 /*return*/];\r\n        });\r\n    });\r\n}\r\nexports.set = set;\r\nexports.default = {\r\n    set: set,\r\n    get: get,\r\n};\r\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","\"use strict\";\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar notion_1 = require(\"../shared_code/notionlib/notion\");\r\nvar utils_1 = require(\"../shared_code/utils\");\r\nvar appUtils_1 = require(\"../shared_code/appUtils\");\r\nvar storage_1 = __importDefault(require(\"../shared_code/lib/storage\"));\r\n/*export type ReturnMap = {\r\n  \"getNotionAuthCookie\":string|null;\r\n}\r\nexport type ActionRequestType = keyof ReturnMap;\r\n\r\nexport type ParamsMap = {\r\n  \"getNotionAuthCookie\":{};\r\n}*/\r\nutils_1.print(\"hello world\");\r\nfunction getHighlightData(url) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var d;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, getPageHighlightData(url)];\r\n                case 1:\r\n                    d = _a.sent();\r\n                    console.log(\">>\", d);\r\n                    if (d == null)\r\n                        return [2 /*return*/, { success: false, errorMsg: \"page not saved\" }];\r\n                    return [2 /*return*/, { success: true, res: d }];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction highlight(pageUrl, selectionText) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var res;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    displaySnackBar({ action: \"loading\", msg: \"Saving Highlight to Notion...\" });\r\n                    return [4 /*yield*/, addHighlightToNotion(pageUrl, selectionText)];\r\n                case 1:\r\n                    res = _a.sent();\r\n                    if (!(res == false)) return [3 /*break*/, 2];\r\n                    utils_1.print(\"failed to highlight\");\r\n                    displaySnackBar({\r\n                        action: \"fail\",\r\n                        msg: \"Didn't saved to Notion... Ensure you are connected on notion.so\",\r\n                        timeout: 3000,\r\n                    });\r\n                    //remove highlight text\r\n                    return [2 /*return*/];\r\n                case 2: return [4 /*yield*/, executeScript(\"highlightSelection.js\")];\r\n                case 3:\r\n                    _a.sent();\r\n                    displaySnackBar({\r\n                        action: \"success\",\r\n                        msg: \"Highlight saved!\",\r\n                        timeout: 1500,\r\n                    });\r\n                    _a.label = 4;\r\n                case 4: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nchrome.commands.onCommand.addListener(function (command) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var p;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    //assume command here is highlight\r\n                    console.log(\"command\", command);\r\n                    return [4 /*yield*/, executeScript(\"getselectedText.js\")];\r\n                case 1:\r\n                    p = (_a.sent());\r\n                    hightlightOrNote(p.pageUrl, (p.selectionText.length > 0 && p.selectionText) || null);\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n});\r\nfunction addHighlightToNotion(url, text) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var d, resp, client;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    utils_1.print(\"get page data from cache\");\r\n                    return [4 /*yield*/, getPageHighlightData(url)];\r\n                case 1:\r\n                    d = _a.sent();\r\n                    if (d == null)\r\n                        return [2 /*return*/, false];\r\n                    utils_1.print(\"get client\");\r\n                    return [4 /*yield*/, appUtils_1.getClient()];\r\n                case 2:\r\n                    resp = _a.sent();\r\n                    if (resp.status == \"error\")\r\n                        return [2 /*return*/, false];\r\n                    client = resp.client;\r\n                    utils_1.print(\"saving to notion\");\r\n                    return [4 /*yield*/, client.appendBulletPointToPage(d.notionPageId, text)];\r\n                case 3:\r\n                    _a.sent();\r\n                    d.highlights.push({ text: text });\r\n                    utils_1.print(\"storing in cache\");\r\n                    return [4 /*yield*/, storage_1.default.set(\"page-\" + url, d)];\r\n                case 4:\r\n                    _a.sent();\r\n                    return [2 /*return*/, true];\r\n            }\r\n        });\r\n    });\r\n}\r\nchrome.contextMenus.create({\r\n    title: \"Add Highlight\",\r\n    id: \"add_highlights\",\r\n    contexts: [\"selection\"],\r\n});\r\n/*chrome.contextMenus.create({\r\n  title: \"Add Note\",\r\n  id: \"add_note\",\r\n  contexts: [\"page\"],\r\n})*/\r\nfunction modalAddNote(currentUrl) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var d, x;\r\n        var _this = this;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    utils_1.print(\"quick note!\");\r\n                    return [4 /*yield*/, getPageHighlightData(currentUrl)];\r\n                case 1:\r\n                    d = _a.sent();\r\n                    if (d == null)\r\n                        return [2 /*return*/, false];\r\n                    return [4 /*yield*/, executeAsyncScript(\"modalAddNote.js\", function (request) { return __awaiter(_this, void 0, void 0, function () {\r\n                            var success;\r\n                            return __generator(this, function (_a) {\r\n                                switch (_a.label) {\r\n                                    case 0:\r\n                                        if (request.text.length == 0)\r\n                                            return [2 /*return*/, false];\r\n                                        displaySnackBar({ action: \"loading\", msg: \"Saving Note to Notion...\" });\r\n                                        return [4 /*yield*/, addHighlightToNotion(currentUrl, \"NOTE \\uD83D\\uDCDD : \" + request.text)];\r\n                                    case 1:\r\n                                        success = _a.sent();\r\n                                        if (success == true)\r\n                                            displaySnackBar({\r\n                                                action: \"success\",\r\n                                                msg: \"Note saved!\",\r\n                                                timeout: 1500,\r\n                                            });\r\n                                        else\r\n                                            displaySnackBar({\r\n                                                action: \"fail\",\r\n                                                msg: \"Didn't saved to Notion... Ensure you are connected on notion.so\",\r\n                                                timeout: 3000,\r\n                                            });\r\n                                        console.log(\"saved to notion!\", success);\r\n                                        return [2 /*return*/, { success: success }];\r\n                                }\r\n                            });\r\n                        }); })];\r\n                case 2:\r\n                    x = _a.sent();\r\n                    utils_1.print(\"receiver\", x);\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction hightlightOrNote(url, selectionText) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var x;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    console.log(\"url\", url);\r\n                    return [4 /*yield*/, getHighlightData(url)];\r\n                case 1:\r\n                    x = _a.sent();\r\n                    utils_1.print(\"here,\", x.success, x.res);\r\n                    if (!x.success) {\r\n                        displaySnackBar({\r\n                            action: \"fail\",\r\n                            msg: \"No Notion Page Found, \",\r\n                            tutorial: true,\r\n                            timeout: 3000,\r\n                        });\r\n                        return [2 /*return*/];\r\n                    }\r\n                    if (!selectionText) {\r\n                        modalAddNote(url);\r\n                    }\r\n                    else {\r\n                        highlight(url, selectionText);\r\n                    }\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nchrome.contextMenus.onClicked.addListener(function (info, tab) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            hightlightOrNote(info.pageUrl, info.selectionText);\r\n            return [2 /*return*/];\r\n        });\r\n    });\r\n});\r\nchrome.runtime.onMessage.addListener(function (rq, sender, sendResponse) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var _a, _b, _c;\r\n        return __generator(this, function (_d) {\r\n            switch (_d.label) {\r\n                case 0:\r\n                    _a = rq.type;\r\n                    switch (_a) {\r\n                        case \"getMetadatas\": return [3 /*break*/, 1];\r\n                    }\r\n                    return [3 /*break*/, 3];\r\n                case 1:\r\n                    _b = sendResponse;\r\n                    _c = [{}];\r\n                    return [4 /*yield*/, getMetaData()];\r\n                case 2:\r\n                    _b.apply(void 0, [__assign.apply(void 0, _c.concat([(_d.sent())]))]);\r\n                    _d.label = 3;\r\n                case 3: return [2 /*return*/, null];\r\n            }\r\n        });\r\n    });\r\n});\r\n/*\r\nchrome.runtime.onMessage.addListener(function ({type,params}, sender, sendResponse) {\r\n  console.log(\"got\", type)\r\n  return respondToMessage(type,params,sender).then((d) => {\r\n    console.log(\"send response\", d)\r\n    return sendResponse(d)\r\n  })\r\n})*/\r\nfunction currentTab() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            return [2 /*return*/, new Promise(function (resolve, reject) {\r\n                    try {\r\n                        chrome.tabs.query({ currentWindow: true, active: true }, function (tabArray) {\r\n                            //print(\"tabarray\", tabArray)\r\n                            resolve(tabArray[0]);\r\n                        });\r\n                    }\r\n                    catch (e) {\r\n                        reject(e);\r\n                    }\r\n                })];\r\n        });\r\n    });\r\n}\r\nfunction displaySnackBar(_a) {\r\n    var action = _a.action, msg = _a.msg, _b = _a.timeout, timeout = _b === void 0 ? 2000 : _b, tutorial = _a.tutorial;\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var filename, tab;\r\n        return __generator(this, function (_c) {\r\n            switch (_c.label) {\r\n                case 0:\r\n                    filename = \"displaySnackBar.js\";\r\n                    return [4 /*yield*/, currentTab()];\r\n                case 1:\r\n                    tab = (_c.sent());\r\n                    return [4 /*yield*/, new Promise(function (accept) {\r\n                            return chrome.tabs.executeScript(tab.id, {\r\n                                code: \"var action = \\\"\" + action + \"\\\"; timeout = \" + timeout + \"; msg = \\\"\" + msg + \"\\\"; tutorial = \" + (tutorial ? true : false),\r\n                            }, function () {\r\n                                return chrome.tabs.executeScript(tab.id, { file: \"/\" + filename }, function (ret) {\r\n                                    accept(ret[0]);\r\n                                });\r\n                            });\r\n                        })];\r\n                case 2: return [2 /*return*/, _c.sent()];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction executeScript(filename) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var tab;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, currentTab()];\r\n                case 1:\r\n                    tab = (_a.sent());\r\n                    return [4 /*yield*/, new Promise(function (accept) {\r\n                            return chrome.tabs.executeScript(tab.id, { file: \"/\" + filename }, function (ret) {\r\n                                accept(ret[0]);\r\n                            });\r\n                        })];\r\n                case 2: return [2 /*return*/, _a.sent()];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction executeAsyncScript(filename, cb) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var tab, asyncId;\r\n        var _this = this;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, currentTab()];\r\n                case 1:\r\n                    tab = (_a.sent());\r\n                    asyncId = Math.floor((1 + Math.random()) * 0x10000)\r\n                        .toString(16)\r\n                        .substring(1);\r\n                    return [4 /*yield*/, new Promise(function (accept) {\r\n                            return chrome.tabs.executeScript(tab.id, {\r\n                                code: \"var asyncId = '\" + asyncId + \"';\",\r\n                            }, function () {\r\n                                return chrome.tabs.executeScript(tab.id, { file: \"/\" + filename }, function () { return __awaiter(_this, void 0, void 0, function () {\r\n                                    function listener(request, sender, sendResponse) {\r\n                                        console.log(\"ask request: \" + ((request.end && \"FINAL\") || \"normal\") + \" (\" + ((request.asyncId != asyncId && \"canceled\") || \"ok\") + \")\", request);\r\n                                        if (request.asyncId != asyncId)\r\n                                            return;\r\n                                        if (request.end) {\r\n                                            chrome.runtime.onMessage.removeListener(listener);\r\n                                            resolve(request);\r\n                                            return null;\r\n                                        }\r\n                                        cb(request).then(function (resp) {\r\n                                            sendResponse(resp);\r\n                                        });\r\n                                        return true;\r\n                                    }\r\n                                    var resolve, message, _a;\r\n                                    return __generator(this, function (_b) {\r\n                                        switch (_b.label) {\r\n                                            case 0:\r\n                                                resolve = null;\r\n                                                chrome.runtime.onMessage.removeListener(listener);\r\n                                                chrome.runtime.onMessage.addListener(listener);\r\n                                                message = new Promise(function (_resolve) {\r\n                                                    resolve = _resolve;\r\n                                                });\r\n                                                _a = accept;\r\n                                                return [4 /*yield*/, message];\r\n                                            case 1:\r\n                                                _a.apply(void 0, [_b.sent()]);\r\n                                                return [2 /*return*/];\r\n                                        }\r\n                                    });\r\n                                }); });\r\n                            });\r\n                        })];\r\n                case 2: return [2 /*return*/, _a.sent()];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getMetaData() {\r\n    var _a;\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var tab, _b, metaData;\r\n        return __generator(this, function (_c) {\r\n            switch (_c.label) {\r\n                case 0:\r\n                    _c.trys.push([0, 2, , 3]);\r\n                    return [4 /*yield*/, currentTab()];\r\n                case 1:\r\n                    tab = (_c.sent());\r\n                    return [3 /*break*/, 3];\r\n                case 2:\r\n                    _b = _c.sent();\r\n                    utils_1.print(\"err\");\r\n                    return [2 /*return*/, undefined];\r\n                case 3:\r\n                    utils_1.print(tab, tab.title);\r\n                    return [4 /*yield*/, new Promise(function (accept) {\r\n                            return chrome.tabs.executeScript(tab.id, { file: \"/parseMetaTags.js\" }, function (ret) {\r\n                                accept(ret[0]);\r\n                            });\r\n                        })];\r\n                case 4:\r\n                    metaData = _c.sent();\r\n                    return [2 /*return*/, __assign(__assign({}, metaData), { title: (((_a = tab.url) === null || _a === void 0 ? void 0 : _a.startsWith(\"https://www.youtube.com\")) &&\r\n                                \"yt_author\" in metaData &&\r\n                                (tab.title || \"\") + \" - \" + metaData[\"yt_author\"]) ||\r\n                                tab.title, url: tab.url, favIconUrl: tab.favIconUrl })];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getCustomCss(customs) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var tab, _a, datas;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    _b.trys.push([0, 2, , 3]);\r\n                    return [4 /*yield*/, currentTab()];\r\n                case 1:\r\n                    tab = (_b.sent());\r\n                    return [3 /*break*/, 3];\r\n                case 2:\r\n                    _a = _b.sent();\r\n                    utils_1.print(\"err\");\r\n                    return [2 /*return*/, undefined];\r\n                case 3: \r\n                //pass parameters\r\n                return [4 /*yield*/, new Promise(function (accept) {\r\n                        return chrome.tabs.executeScript(tab.id, {\r\n                            code: \"var __save_to_notion_customs = \" + JSON.stringify(customs) + \";  \",\r\n                        }, function () {\r\n                            accept();\r\n                        });\r\n                    })\r\n                    //receive datas\r\n                ];\r\n                case 4:\r\n                    //pass parameters\r\n                    _b.sent();\r\n                    return [4 /*yield*/, new Promise(function (accept) {\r\n                            return chrome.tabs.executeScript(tab.id, { file: \"/getCustomCssData.js\" }, function (ret) {\r\n                                accept(ret[0]);\r\n                            });\r\n                        })];\r\n                case 5:\r\n                    datas = _b.sent();\r\n                    return [2 /*return*/, datas];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getPrefilledValue(dap, property) {\r\n    var _a, _b;\r\n    var opts;\r\n    switch (property.type) {\r\n        case \"select\":\r\n            if (!property.options)\r\n                return \"\";\r\n            opts = property.options.filter(function (option) { return option.id == dap.options.defaultSelectId; });\r\n            if (opts.length == 0)\r\n                return \"\"; //throw `property ${property.name} has been modified and we can't find default value`;\r\n            return opts[0].value;\r\n        case \"relation\":\r\n            var pages_1 = [];\r\n            var d_1 = ((_a = dap.options) === null || _a === void 0 ? void 0 : _a.defaultSelectIds) || [];\r\n            d_1.forEach(function (id, i) {\r\n                pages_1.push([\"‣\", [[\"p\", id]]]);\r\n                if (i + 1 < d_1.length) {\r\n                    pages_1.push([\",\"]);\r\n                }\r\n            });\r\n            return pages_1;\r\n        case \"multi_select\":\r\n            var values = [];\r\n            if (!property.options)\r\n                return [];\r\n            var ids_1 = {};\r\n            (_b = dap.options.defaultSelectIds) === null || _b === void 0 ? void 0 : _b.forEach(function (id) { return (ids_1[id] = true); });\r\n            opts = property.options.filter(function (option) { return ids_1[option.id]; });\r\n            if (opts.length == 0)\r\n                return []; //throw `property ${property.name} has been modified and we can't find default value`;\r\n            return opts.map(function (e) { return e.value; });\r\n        case \"image\":\r\n            if (!dap.options.defaultValue)\r\n                return undefined;\r\n            var img = dap.options\r\n                .defaultValue;\r\n            utils_1.print(\"IMG\", img);\r\n            if (img.imgUrl) {\r\n                var ret = __assign(__assign({}, img), { opts: dap.fieldOptions.image\r\n                        ? dap.fieldOptions.image\r\n                        : { size: \"normal\", type: \"coverLike\" } });\r\n                return ret;\r\n            }\r\n            return undefined;\r\n        case \"text\":\r\n        default:\r\n            return dap.options.defaultValue;\r\n    }\r\n}\r\nfunction formatData(form) {\r\n    var d = {};\r\n    for (var _i = 0, _a = form.daps; _i < _a.length; _i++) {\r\n        var dap = _a[_i];\r\n        var property = dap.property;\r\n        switch (dap.kind) {\r\n            case \"data\":\r\n                var x = dap.property.id;\r\n                d[x] = getPrefilledValue(dap, property);\r\n                if (typeof d[x] == \"undefined\") {\r\n                    delete d[x];\r\n                }\r\n                break;\r\n            case \"prefilled\":\r\n                if (!dap.options.defaultSelectId)\r\n                    throw \"todo\";\r\n                break;\r\n            default:\r\n                throw \"not implem\";\r\n        }\r\n    }\r\n    return d;\r\n}\r\nfunction submitToNotion(port, form, currentUrl) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var cookie, client, clientV2, col, templateCreationOperations, d, e_1, blocksMap, f, row, e_2;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    utils_1.print(\"SUBMIT TO NOTION\", form, currentUrl);\r\n                    port.postMessage({ type: \"submitting\" });\r\n                    return [4 /*yield*/, utils_1.promisify(chrome.cookies.get, {\r\n                            url: \"https://www.notion.so\",\r\n                            name: \"token_v2\",\r\n                        })];\r\n                case 1:\r\n                    cookie = _a.sent();\r\n                    if (!cookie) {\r\n                        port.postMessage({ type: \"error\", errorInfo: \"failed to fetch the cookie\" });\r\n                        port.disconnect();\r\n                        return [2 /*return*/];\r\n                    }\r\n                    console.log(\"preparing data to send to Notion...\");\r\n                    client = new notion_1.DummyNotionClient(cookie.value);\r\n                    clientV2 = new notion_1.NotionV3Client(cookie.value);\r\n                    console.log(\"got\", form.collection);\r\n                    return [4 /*yield*/, client.getCollectionLocally(form.collection.id, form.collection.parent_id, form.collection.schema)];\r\n                case 2:\r\n                    col = _a.sent();\r\n                    templateCreationOperations = [];\r\n                    _a.label = 3;\r\n                case 3:\r\n                    _a.trys.push([3, 5, , 6]);\r\n                    return [4 /*yield*/, formatData(form)];\r\n                case 4:\r\n                    d = _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 5:\r\n                    e_1 = _a.sent();\r\n                    utils_1.print(\"error formatting\", e_1);\r\n                    port.postMessage({ type: \"error\" });\r\n                    port.disconnect();\r\n                    return [2 /*return*/];\r\n                case 6:\r\n                    console.log(\"loading the template...\");\r\n                    if (!form.template) return [3 /*break*/, 9];\r\n                    utils_1.print(\"fetching template\", form.needToRefreshTemplate);\r\n                    return [4 /*yield*/, appUtils_1.getUpToDateTemplateBlocksMap(client, form.template.id, form.needToRefreshTemplate //false\r\n                        )\r\n                        //get template operations\r\n                    ];\r\n                case 7:\r\n                    blocksMap = _a.sent();\r\n                    //get template operations\r\n                    d.__template = { blocksMap: blocksMap, id: form.template.id };\r\n                    if (!form.needToRefreshTemplate) return [3 /*break*/, 9];\r\n                    utils_1.print(\"save template info\");\r\n                    return [4 /*yield*/, appUtils_1.getFormData(form.id)];\r\n                case 8:\r\n                    f = _a.sent();\r\n                    appUtils_1.saveFormData(__assign(__assign({}, f), { template: f.template\r\n                            ? __assign(__assign({}, f.template), { lastEditedTime: Date.now() }) : undefined }), \"edit\", form.id);\r\n                    _a.label = 9;\r\n                case 9:\r\n                    utils_1.print(\"formatted data\", d);\r\n                    utils_1.print(\"submit to notion...\");\r\n                    utils_1.print(\"got\", form.savePageContent, currentUrl);\r\n                    console.log(\"send data to Notion...\");\r\n                    _a.label = 10;\r\n                case 10:\r\n                    _a.trys.push([10, 12, , 13]);\r\n                    return [4 /*yield*/, col.createRow(d, form.savePageContent &&\r\n                            currentUrl && { title: \"Full Page Articles\", url: currentUrl })\r\n                        //print('submitting to Notion url cover...');\r\n                        //await col.updateRowCover({where:{id:row.id},data:{coverUrl:'https://media-exp1.licdn.com/dms/image/C561BAQGraaPJ8LBMCw/company-background_10000/0?e=2159024400&v=beta&t=iGq7MKSwG7LFl2ec4WP6_edMPmmorxW5x0N1oxfLneg'}})\r\n                        //print('ok done to update cover')\r\n                    ];\r\n                case 11:\r\n                    row = _a.sent();\r\n                    return [3 /*break*/, 13];\r\n                case 12:\r\n                    e_2 = _a.sent();\r\n                    utils_1.print(\"Fatal Error:\");\r\n                    utils_1.print(e_2);\r\n                    port.postMessage({ type: \"error\" });\r\n                    port.disconnect();\r\n                    return [2 /*return*/];\r\n                case 13:\r\n                    console.log(\"Done!\");\r\n                    if (currentUrl != null)\r\n                        createPageHighlightData(row.id, currentUrl);\r\n                    //save to cache\r\n                    port.postMessage({ type: \"success_submit\", id: row.id });\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getPageHighlightData(url) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    url = url /*.split(\"?\")[0]*/\r\n                        .split(\"#\")[0];\r\n                    console.log(\"here\", url);\r\n                    return [4 /*yield*/, storage_1.default.get(\"page-\" + url, null)];\r\n                case 1: return [2 /*return*/, (_a.sent())];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction currentTabUrl() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var tab, _a;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    _b.trys.push([0, 2, , 3]);\r\n                    return [4 /*yield*/, currentTab()];\r\n                case 1:\r\n                    tab = _b.sent();\r\n                    return [3 /*break*/, 3];\r\n                case 2:\r\n                    _a = _b.sent();\r\n                    utils_1.print(\"didnt fetch tab\");\r\n                    return [2 /*return*/, null];\r\n                case 3: return [2 /*return*/, tab.url];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction createPageHighlightData(id, url) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var d;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    url = url /*.split(\"?\")[0]*/\r\n                        .split(\"#\")[0];\r\n                    utils_1.print(\"saving\", url);\r\n                    d = {\r\n                        url: url,\r\n                        notionPageId: id,\r\n                        highlights: [],\r\n                    };\r\n                    return [4 /*yield*/, storage_1.default.set(\"page-\" + url, d)];\r\n                case 1:\r\n                    _a.sent();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nchrome.runtime.onConnect.addListener(function (port) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var _a, data;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    utils_1.print(\"receive port connection\", port.name);\r\n                    utils_1.print(port.name == \"get_metadatas\");\r\n                    _a = port.name;\r\n                    switch (_a) {\r\n                        case \"submit_form_to_notion\": return [3 /*break*/, 1];\r\n                        case \"get_metadatas\": return [3 /*break*/, 2];\r\n                        case \"get_custom_css\": return [3 /*break*/, 4];\r\n                    }\r\n                    return [3 /*break*/, 5];\r\n                case 1:\r\n                    port.onMessage.addListener(function (x) {\r\n                        return __awaiter(this, void 0, void 0, function () {\r\n                            return __generator(this, function (_a) {\r\n                                utils_1.print(\"received\", x);\r\n                                switch (x.type) {\r\n                                    case \"initial_data\":\r\n                                        submitToNotion(port, x.params.form, x.params.currentUrl);\r\n                                        break;\r\n                                }\r\n                                return [2 /*return*/];\r\n                            });\r\n                        });\r\n                    });\r\n                    return [2 /*return*/];\r\n                case 2: return [4 /*yield*/, getMetaData()];\r\n                case 3:\r\n                    data = _b.sent();\r\n                    if (!data) {\r\n                        port.postMessage({ type: \"error\" });\r\n                    }\r\n                    else {\r\n                        port.postMessage({ type: \"done\", data: data });\r\n                    }\r\n                    port.disconnect();\r\n                    return [2 /*return*/];\r\n                case 4:\r\n                    port.onMessage.addListener(function (x) {\r\n                        return __awaiter(this, void 0, void 0, function () {\r\n                            var _a, d;\r\n                            return __generator(this, function (_b) {\r\n                                switch (_b.label) {\r\n                                    case 0:\r\n                                        utils_1.print(\"received\", x);\r\n                                        _a = x.type;\r\n                                        switch (_a) {\r\n                                            case \"initial_data\": return [3 /*break*/, 1];\r\n                                        }\r\n                                        return [3 /*break*/, 3];\r\n                                    case 1: return [4 /*yield*/, getCustomCss(x.params.customs)];\r\n                                    case 2:\r\n                                        d = _b.sent();\r\n                                        utils_1.print(\"custom css\", d);\r\n                                        if (!d) {\r\n                                            port.postMessage({ type: \"error\" });\r\n                                        }\r\n                                        else {\r\n                                            port.postMessage({ type: \"done\", data: d });\r\n                                        }\r\n                                        return [3 /*break*/, 3];\r\n                                    case 3: return [2 /*return*/];\r\n                                }\r\n                            });\r\n                        });\r\n                    });\r\n                    return [2 /*return*/];\r\n                case 5: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n});\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar agent_1 = require(\"./agent\");\r\nexports.createAgent = agent_1.createAgent;\r\n","\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/** Import other sripts. */\r\nvar httputil_1 = require(\"./httputil\");\r\nvar log_1 = require(\"./log\");\r\nvar strings_1 = require(\"./strings\");\r\nvar APIError_1 = require(\"./error/APIError\");\r\n/**\r\n * Create an asynchronous Notion API function.\r\n * @param url The API's full URL.\r\n * @param token The API token for authentication.\r\n *\r\n * @category Library Internal\r\n */\r\nfunction createAPI(url, token) {\r\n    log_1.log.debug(\"agent.ts: Create API function with URL \\\"\" + url + \"\\\"\");\r\n    return function (req) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var result, error;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        log_1.log.debug(\"agent.ts: Call API \\\"\" + url + \"\\\".\");\r\n                        return [4 /*yield*/, httputil_1.post(url)\r\n                                .setHeader(\"accept\", \"*/*\")\r\n                                .setHeader(\"accept-language\", \"en-US,en;q=0.9\")\r\n                                .setHeader(\"cookie\", \"token_v2=\" + token + \";\")\r\n                                .setHeader(\"origin\", strings_1.Default.server)\r\n                                .setHeader(\"referer\", strings_1.Default.server)\r\n                                .setHeader(\"user-agent\", strings_1.Default.userAgent)\r\n                                .sendAsJson(req)];\r\n                    case 1:\r\n                        result = _a.sent();\r\n                        if (result.hasOwnProperty(\"errorId\")) {\r\n                            error = result;\r\n                            throw new APIError_1.APIError(error);\r\n                        }\r\n                        return [2 /*return*/, result];\r\n                }\r\n            });\r\n        });\r\n    };\r\n}\r\n/**\r\n * Create a Notion API agent.\r\n * @param opts A config object.\r\n *\r\n * @category Library\r\n */\r\nfunction createAgent(opts) {\r\n    if (opts === void 0) { opts = {}; }\r\n    var token = opts.token ? opts.token : \"\";\r\n    var server = opts.server ? opts.server : strings_1.Default.server;\r\n    if (opts.debug) {\r\n        log_1.log.setLogLevel(\"debug\");\r\n    }\r\n    log_1.log.debug(\"agent.ts: Create API agent with server \\\"\" + server + \"\\\" and token \\\"\" + token.substr(0, 9) + \"...\\\"\");\r\n    var getActivityLog = createAPI(server + \"/api/v3/getActivityLog\", token);\r\n    var getAssetsJson = createAPI(server + \"/api/v3/getAssetsJson\", token);\r\n    var getRecordValues = createAPI(server + \"/api/v3/getRecordValues\", token);\r\n    var getSnapshotsList = createAPI(server + \"/api/v3/getSnapshotsList\", token);\r\n    var getUserSharedPages = createAPI(server + \"/api/v3/getUserSharedPages\", token);\r\n    var loadPageChunk = createAPI(server + \"/api/v3/loadPageChunk\", token);\r\n    var loadUserContent = createAPI(server + \"/api/v3/loadUserContent\", token);\r\n    var queryCollection = createAPI(server + \"/api/v3/queryCollection\", token);\r\n    var submitTransaction = createAPI(server + \"/api/v3/submitTransaction\", token);\r\n    var search = createAPI(server + \"/api/v3/search\", token);\r\n    return {\r\n        getActivityLog: getActivityLog,\r\n        getAssetsJson: getAssetsJson,\r\n        getRecordValues: getRecordValues,\r\n        getSnapshotsList: getSnapshotsList,\r\n        getUserSharedPages: getUserSharedPages,\r\n        loadPageChunk: loadPageChunk,\r\n        loadUserContent: loadUserContent,\r\n        queryCollection: queryCollection,\r\n        submitTransaction: submitTransaction,\r\n        search: search,\r\n    };\r\n}\r\nexports.createAgent = createAgent;\r\n","\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/** Import libraries. */\r\n//import { makeHTTPRequest, makeHTTPSRequest } from \"@dnpr/make-request\"\r\n//import fetch from 'node-fetch';\r\n/** Import other sripts. */\r\nvar log_1 = require(\"./log\");\r\nvar RequestError_1 = require(\"./error/RequestError\");\r\n/**\r\n * @category Library Internal\r\n */\r\nfunction post(url) {\r\n    var myURL = new URL(url);\r\n    if (myURL.protocol !== \"http:\" && myURL.protocol !== \"https:\") {\r\n        throw new RequestError_1.RequestError(\"Unsupported protocol: \" + myURL.protocol);\r\n    }\r\n    var port = myURL.port ? myURL.port : myURL.protocol === \"http:\" ? 80 : 443;\r\n    var agentOptions = {\r\n        hostname: myURL.hostname,\r\n        authority: myURL.hostname,\r\n        port: port,\r\n        path: myURL.pathname + myURL.search,\r\n        method: \"POST\",\r\n        headers: {},\r\n    };\r\n    return {\r\n        setHeader: function (key, value) {\r\n            agentOptions.headers[key] = value;\r\n            return this;\r\n        },\r\n        sendAsJson: function (body) {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var payload, response, error_1, error_2;\r\n                return __generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0:\r\n                            log_1.log.debug(\"http-util.ts: \" + agentOptions.method + \" \" + agentOptions.hostname + \" \" + agentOptions.port + \" \" + agentOptions.path);\r\n                            /** @dnpr/make-request only support these two. */\r\n                            this.setHeader(\"accept-encoding\", \"gzip, deflate\");\r\n                            this.setHeader(\"content-type\", \"application/json\");\r\n                            payload = \"\";\r\n                            try {\r\n                                if (body)\r\n                                    payload = JSON.stringify(body);\r\n                            }\r\n                            catch (error) {\r\n                                throw error;\r\n                            }\r\n                            _a.label = 1;\r\n                        case 1:\r\n                            _a.trys.push([1, 3, , 4]);\r\n                            return [4 /*yield*/, fetch(myURL.toString(), {\r\n                                    method: \"post\",\r\n                                    headers: agentOptions.headers,\r\n                                    body: payload,\r\n                                })\r\n                                /*if (response.status < 200 || response.status > 299){\r\n                                  throw response.statusText\r\n                                }*/\r\n                            ];\r\n                        case 2:\r\n                            response = _a.sent();\r\n                            return [3 /*break*/, 4];\r\n                        case 3:\r\n                            error_1 = _a.sent();\r\n                            throw error_1;\r\n                        case 4:\r\n                            _a.trys.push([4, 6, , 7]);\r\n                            return [4 /*yield*/, response.json()];\r\n                        case 5: return [2 /*return*/, _a.sent()];\r\n                        case 6:\r\n                            error_2 = _a.sent();\r\n                            throw error_2;\r\n                        case 7: return [2 /*return*/];\r\n                    }\r\n                });\r\n            });\r\n        },\r\n    }; // return\r\n} // post\r\nexports.post = post;\r\n","'use strict'\n\n/** Return Values */\nconst RET_SUCCESS = 0;\nconst RET_FAIL = -1;\n\n/** Log Levels */\nconst LOG_LEVEL = {\n  verbose: 2,\n  debug: 3,\n  info: 4,\n  warn: 5,\n  error: 6\n}\n\nconst LOG_LEVEL_DEFAULT = LOG_LEVEL.warn\n\n/** Color Styles */\nconst STYLE = {\n  fgBlack: '\\x1b[30m',\n  fgRed: '\\x1b[31m',\n  fgGreen: '\\x1b[32m',\n  fgYellow: '\\x1b[33m',\n  fgBlue: '\\x1b[34m',\n  fgPink: '\\x1b[35m',\n  fgCyan: '\\x1b[36m',\n  fgWhite: '\\x1b[37m',\n  reset: '\\x1b[0m',\n  bold: '\\x1b[1m',\n}\n\n/**\n * @class A console.log() wrapper that logs more information.\n */\nclass Logger {\n\n  /**\n   * Options of Logger's constructor.\n   * @typedef LoggerOptions\n   * @property {boolean} useColor Whether to use colored output.\n   * @property {string} logLevel One of verbose, debug, info, warn, error.\n   */\n\n  /**\n   * Create a Logger instance.\n   * @param {string} appName The application name to use in logs.\n   * @param {LoggerOptions} options \n   */\n  constructor(appName, options = {}) {\n    this.appName = appName\n    this.useColor = (typeof options.useColor === 'undefined')\n      ? true : options.useColor\n    this.setLogLevel(options.logLevel)\n  }\n\n  /**\n   * Log verbose messages.\n   * @returns RET_SUCCESS if messages are logged to console. \n   * RET_FAIL if not.\n   */\n  verbose() {\n    if (LOG_LEVEL.verbose >= this.logLevel) {\n      let args = Array.from(arguments)\n      args.unshift(this._makeHeader('V', STYLE.bold + STYLE.fgBlue))\n      console.error.apply(console, args)\n      return RET_SUCCESS\n    } else {\n      return RET_FAIL\n    }\n  }\n\n  /**\n   * Log debug messages.\n   * @returns RET_SUCCESS if messages are logged to console. \n   * RET_FAIL if not.\n   */\n  debug() {\n    if (LOG_LEVEL.debug >= this.logLevel) {\n      let args = Array.from(arguments)\n      args.unshift(this._makeHeader('D', STYLE.bold + STYLE.fgBlue))\n      console.log.apply(console, args)\n      return RET_SUCCESS\n    } else {\n      return RET_FAIL\n    }\n  }\n\n  /**\n   * Log info messages.\n   * @returns RET_SUCCESS if messages are logged to console. \n   * RET_FAIL if not.\n   */\n  info() {\n    if (LOG_LEVEL.info >= this.logLevel) {\n      let args = Array.from(arguments)\n      args.unshift(this._makeHeader('I', STYLE.bold + STYLE.fgGreen))\n      console.log.apply(console, args)\n      return RET_SUCCESS\n    } else {\n      return RET_FAIL\n    }\n  }\n\n  /**\n   * Log warn messages.\n   * @returns RET_SUCCESS if messages are logged to console. \n   * RET_FAIL if not.\n   */\n  warn() {\n    if (LOG_LEVEL.warn >= this.logLevel) {\n      let args = Array.from(arguments)\n      args.unshift(this._makeHeader('W', STYLE.bold + STYLE.fgYellow))\n      console.log.apply(console, args)\n      return RET_SUCCESS\n    } else {\n      return RET_FAIL\n    }\n  }\n\n  /**\n   * Log error messages.\n   * @returns RET_SUCCESS if messages are logged to console. \n   * RET_FAIL if not.\n   */\n  error() {\n    if (LOG_LEVEL.error >= this.logLevel) {\n      let args = Array.from(arguments)\n      args.unshift(this._makeHeader('E', STYLE.bold + STYLE.fgRed))\n      console.error.apply(console, args)\n      return RET_SUCCESS\n    } else {\n      return RET_FAIL\n    }\n  }\n\n  /**\n   * Set or change the log level of the logger instance.\n   * @param {string} str One of verbose, debug, info, warn, error.\n   * @returns {number} RET_SUCCESS when set successfully, RET_FAIL when \n   * set unsuccessfully and fallback to default: \"warn\".\n   */\n  setLogLevel(str) {\n    switch (str) {\n      case 'verbose':\n        this.logLevel = LOG_LEVEL.verbose\n        break;\n      case 'debug':\n        this.logLevel = LOG_LEVEL.debug\n        break\n      case 'info':\n        this.logLevel = LOG_LEVEL.info\n        break\n      case 'warn':\n        this.logLevel = LOG_LEVEL.warn\n        break\n      case 'error':\n        this.logLevel = LOG_LEVEL.error\n        break\n      default:\n        this.warn(`Unknown log level string: ${str}, please specify one of\\\n verbose, debug, info, warn, error.`)\n        this.logLevel = LOG_LEVEL_DEFAULT\n        return RET_FAIL\n    }\n\n    return RET_SUCCESS\n  }\n\n  /**\n   * Compose the log header displayed before messages.\n   * @private\n   * @param {string} logLevelLabel The string label representing the log\n   * level.\n   * @param {string} style One of constant defined in STYLE object.\n   * @returns {string} The composed header.\n   */\n  _makeHeader(logLevelLabel, style) {\n    const h = `${logLevelLabel}/${this.appName}(${getTime()}):`\n    if (this.useColor && style)\n      return style + h + STYLE.reset\n    else\n      return h \n  }\n}\n\n/*************************************************************************\n * Utility Functions                                                     *\n *************************************************************************/\n\n/**\n * Get local time in format like \"2019-03-14+02:48:37.662\".\n * @function getTime\n * @returns {string} Local time in format like \"2019-03-14+02:48:37.662\".\n */\nfunction getTime() {\n  let date = new Date()\n  let offset = date.getTimezoneOffset() * 60000\n  let timeStamp = Date.now() - offset\n  return new Date(timeStamp).toISOString()\n    .replace(/Z|-|:/g, '')\n}\n\n/**\n * Filter circular object for JSON.stringify()\n * @function getCircularReplacer\n * @returns {object} Filtered object.\n * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Errors/Cyclic_object_value\n */\nfunction getCircularReplacer() {\n  const seen = new WeakSet()\n  return (key, value) => {\n    if (typeof value === \"object\" && value !== null) {\n      if (seen.has(value)) {\n        return\n      }\n      seen.add(value)\n    }\n    return value\n  }\n}\n\n/*************************************************************************\n * Exports                                                               *\n *************************************************************************/\n\nmodule.exports = { Logger, RET_FAIL, RET_SUCCESS }\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/**\r\n * @category Error\r\n */\r\nvar RequestError = /** @class */ (function (_super) {\r\n    __extends(RequestError, _super);\r\n    function RequestError(message) {\r\n        var _this = _super.call(this) || this;\r\n        _this.name = \"RequestError\";\r\n        Object.setPrototypeOf(_this, RequestError.prototype);\r\n        _this.message = message;\r\n        return _this;\r\n    }\r\n    return RequestError;\r\n}(Error));\r\nexports.RequestError = RequestError;\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/**\r\n * @category Library Constant\r\n */\r\nvar Default = {\r\n    server: \"https://www.notion.so\",\r\n    userAgent: \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36\",\r\n};\r\nexports.Default = Default;\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/**\r\n * @category Error\r\n */\r\nvar APIError = /** @class */ (function (_super) {\r\n    __extends(APIError, _super);\r\n    function APIError(error) {\r\n        var _this = _super.call(this) || this;\r\n        _this.name = \"APIError\";\r\n        Object.setPrototypeOf(_this, APIError.prototype);\r\n        _this.message = \"Server says \\\"\" + error.name + \": \" + error.message;\r\n        if (error.status) {\r\n            _this.message += \" Status: \" + error.status;\r\n        }\r\n        _this.message += '\"';\r\n        return _this;\r\n    }\r\n    return APIError;\r\n}(Error));\r\nexports.APIError = APIError;\r\n","\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n//import yaml from 'js-yaml';\r\n//todo: export all the util functions to a gist place where I can update it and use it when needed\r\nexports.print = console.log;\r\nexports.sleep = function (ms) { return __awaiter(void 0, void 0, void 0, function () { return __generator(this, function (_a) {\r\n    return [2 /*return*/, new Promise(function (resolve) { return setTimeout(resolve, ms); })\r\n        //export const ydump = (data) => yaml.safeDump(data)\r\n    ];\r\n}); }); };\r\n//export const ydump = (data) => yaml.safeDump(data)\r\nexports.jdump = function (data) { return JSON.stringify(data, null, 2); };\r\n","\"use strict\";\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar notion_1 = require(\"./notion\");\r\nfunction fetchFullContentPage(pageId, notionToken) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var page, baseBlocks, allBlocks, allBlockKeys, pendingBlocks, newBlocks, collection, collectionView;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, notion_1.fetchPageById(pageId, notionToken)\r\n                    //console.log(JSON.stringify(page, null, 2),'\\x1b[43m -- result \\x1b[0m');\r\n                ];\r\n                case 1:\r\n                    page = _a.sent();\r\n                    baseBlocks = page.recordMap.block;\r\n                    allBlocks = __assign({}, baseBlocks);\r\n                    _a.label = 2;\r\n                case 2:\r\n                    if (!true) return [3 /*break*/, 4];\r\n                    allBlockKeys = Object.keys(allBlocks);\r\n                    pendingBlocks = allBlockKeys.flatMap(function (blockId) {\r\n                        var block = allBlocks[blockId];\r\n                        if (block.role == \"none\")\r\n                            return [];\r\n                        var content = block.value.content;\r\n                        return content && block.value.type !== \"page\"\r\n                            ? content.filter(function (id) { return !allBlocks[id]; })\r\n                            : [];\r\n                    });\r\n                    if (!pendingBlocks.length) {\r\n                        return [3 /*break*/, 4];\r\n                    }\r\n                    return [4 /*yield*/, notion_1.fetchBlocks(pendingBlocks).then(function (res) { return res.recordMap.block; })];\r\n                case 3:\r\n                    newBlocks = _a.sent();\r\n                    allBlocks = __assign(__assign({}, allBlocks), newBlocks);\r\n                    return [3 /*break*/, 2];\r\n                case 4:\r\n                    collection = page.recordMap.collection\r\n                        ? page.recordMap.collection[Object.keys(page.recordMap.collection)[0]]\r\n                        : null;\r\n                    collectionView = page.recordMap.collection_view\r\n                        ? page.recordMap.collection_view[Object.keys(page.recordMap.collection_view)[0]]\r\n                        : null;\r\n                    /*\r\n                    if (collection && collectionView) {\r\n                      const pendingCollections = allBlockKeys.flatMap((blockId) => {\r\n                        const block = allBlocks[blockId]\r\n                        if (block.role == \"none\") return []\r\n                  \r\n                        return block.value.type === \"collection_view\" ? [block.value.id] : []\r\n                      })\r\n                  \r\n                      for (let b of pendingCollections) {\r\n                        const { rows, schema } = await getTableData(\r\n                          collection,\r\n                          collectionView.value.id,\r\n                          req.notionToken,\r\n                          true\r\n                        )\r\n                  \r\n                        const viewIds = (allBlocks[b] as any).value.view_ids as string[]\r\n                  \r\n                        allBlocks[b] = {\r\n                          ...allBlocks[b],\r\n                          collection: {\r\n                            title: collection.value.name,\r\n                            schema,\r\n                            types: viewIds.map((id) => {\r\n                              const col = page.recordMap.collection_view[id]\r\n                              return col ? col.value : undefined\r\n                            }),\r\n                            data: rows,\r\n                          },\r\n                        }\r\n                      }\r\n                    }\r\n                    */\r\n                    return [2 /*return*/, allBlocks];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.fetchFullContentPage = fetchFullContentPage;\r\n","\"use strict\";\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar NOTION_API = \"https://www.notion.so/api/v3\";\r\nexports.loadPageChunkBody = {\r\n    limit: 999,\r\n    cursor: { stack: [] },\r\n    chunkNumber: 0,\r\n    verticalColumns: false,\r\n};\r\nvar fetchNotionData = function (_a) {\r\n    var resource = _a.resource, body = _a.body, notionToken = _a.notionToken;\r\n    return __awaiter(void 0, void 0, void 0, function () {\r\n        var res;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, fetch(NOTION_API + \"/\" + resource, {\r\n                        method: \"POST\",\r\n                        headers: __assign({ \"content-type\": \"application/json\" }, (notionToken && { cookie: \"token_v2=\" + notionToken })),\r\n                        body: JSON.stringify(body),\r\n                    })];\r\n                case 1:\r\n                    res = _b.sent();\r\n                    return [2 /*return*/, res.json()];\r\n            }\r\n        });\r\n    });\r\n};\r\nexports.fetchPageById = function (pageId, notionToken, params) {\r\n    if (params === void 0) { params = exports.loadPageChunkBody; }\r\n    return __awaiter(void 0, void 0, void 0, function () {\r\n        var res;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, fetchNotionData({\r\n                        resource: \"loadPageChunk\",\r\n                        body: __assign({ pageId: pageId }, params),\r\n                        notionToken: notionToken,\r\n                    })];\r\n                case 1:\r\n                    res = _a.sent();\r\n                    return [2 /*return*/, res];\r\n            }\r\n        });\r\n    });\r\n};\r\nvar queryCollectionBody = {\r\n    query: { aggregations: [{ property: \"title\", aggregator: \"count\" }] },\r\n    loader: {\r\n        type: \"table\",\r\n        limit: 999,\r\n        searchQuery: \"\",\r\n        userTimeZone: \"Europe/Vienna\",\r\n        userLocale: \"en\",\r\n        loadContentCover: true,\r\n    },\r\n};\r\nexports.fetchTableData = function (collectionId, collectionViewId, notionToken) { return __awaiter(void 0, void 0, void 0, function () {\r\n    var table;\r\n    return __generator(this, function (_a) {\r\n        switch (_a.label) {\r\n            case 0: return [4 /*yield*/, fetchNotionData({\r\n                    resource: \"queryCollection\",\r\n                    body: __assign({ collectionId: collectionId,\r\n                        collectionViewId: collectionViewId }, queryCollectionBody),\r\n                    notionToken: notionToken,\r\n                })];\r\n            case 1:\r\n                table = _a.sent();\r\n                return [2 /*return*/, table];\r\n        }\r\n    });\r\n}); };\r\nexports.fetchNotionUsers = function (userIds, notionToken) { return __awaiter(void 0, void 0, void 0, function () {\r\n    var users;\r\n    return __generator(this, function (_a) {\r\n        switch (_a.label) {\r\n            case 0: return [4 /*yield*/, fetchNotionData({\r\n                    resource: \"getRecordValues\",\r\n                    body: {\r\n                        requests: userIds.map(function (id) { return ({ id: id, table: \"notion_user\" }); }),\r\n                    },\r\n                    notionToken: notionToken,\r\n                })];\r\n            case 1:\r\n                users = _a.sent();\r\n                if (users && users.results) {\r\n                    return [2 /*return*/, users.results.map(function (u) {\r\n                            var user = {\r\n                                id: u.value.id,\r\n                                firstName: u.value.given_name,\r\n                                lastLame: u.value.family_name,\r\n                                fullName: u.value.given_name + \" \" + u.value.family_name,\r\n                                profilePhoto: u.value.profile_photo,\r\n                            };\r\n                            return user;\r\n                        })];\r\n                }\r\n                return [2 /*return*/, []];\r\n        }\r\n    });\r\n}); };\r\nexports.fetchBlocks = function (blockList, notionToken) { return __awaiter(void 0, void 0, void 0, function () {\r\n    return __generator(this, function (_a) {\r\n        switch (_a.label) {\r\n            case 0: return [4 /*yield*/, fetchNotionData({\r\n                    resource: \"syncRecordValues\",\r\n                    body: {\r\n                        recordVersionMap: {\r\n                            block: blockList.reduce(function (obj, blockId) {\r\n                                obj[blockId] = -1;\r\n                                return obj;\r\n                            }, {}),\r\n                        },\r\n                    },\r\n                    notionToken: notionToken,\r\n                })];\r\n            case 1: return [2 /*return*/, _a.sent()];\r\n        }\r\n    });\r\n}); };\r\nexports.fetchNotionSearch = function (params, notionToken) { return __awaiter(void 0, void 0, void 0, function () {\r\n    return __generator(this, function (_a) {\r\n        // TODO: support other types of searches\r\n        return [2 /*return*/, fetchNotionData({\r\n                resource: \"search\",\r\n                body: {\r\n                    type: \"BlocksInAncestor\",\r\n                    source: \"quick_find_public\",\r\n                    ancestorId: params.ancestorId,\r\n                    filters: __assign({ isDeletedOnly: false, excludeTemplates: true, isNavigableOnly: true, requireEditPermissions: false, ancestors: [], createdBy: [], editedBy: [], lastEditedTime: {}, createdTime: {} }, params.filters),\r\n                    sort: \"Relevance\",\r\n                    limit: params.limit || 20,\r\n                    query: params.query,\r\n                },\r\n                notionToken: notionToken,\r\n            })];\r\n    });\r\n}); };\r\n","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\n\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto\n// implementation. Also, find the complete implementation of crypto on IE11.\nvar getRandomValues = (typeof(crypto) != 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto)) ||\n                      (typeof(msCrypto) != 'undefined' && typeof window.msCrypto.getRandomValues == 'function' && msCrypto.getRandomValues.bind(msCrypto));\n\nif (getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\n  module.exports = function whatwgRNG() {\n    getRandomValues(rnds8);\n    return rnds8;\n  };\n} else {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n\n  module.exports = function mathRNG() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  // join used to fix memory issue caused by concatenation: https://bugs.chromium.org/p/v8/issues/detail?id=3175#c4\n  return ([bth[buf[i++]], bth[buf[i++]], \n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]],\n\tbth[buf[i++]], bth[buf[i++]],\n\tbth[buf[i++]], bth[buf[i++]]]).join('');\n}\n\nmodule.exports = bytesToUuid;\n"],"sourceRoot":""}