!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=7)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.APP_NAME="Save to Notion",t.APP_VERSION="0.9.9",t.APP_VERSION_FULL="0.9.9",t.WHATS_NEW_LINK="https://www.notion.so/What-s-new-Save-To-Notion-b85cff00e8c24b10a893a6aa18a887fa",t.FORM_LIST_KEY="STORAGE_KEY_FORM_LIST",t.FORM_KEY_PREFIX="form-",t.COOKIE_KEY="cookie",t.NOTION_CLIENT_DATA_KEY="notion-client-data",t.notionColors={default:"rgba(206, 205, 202, 0.5)",gray:"rgba(155, 154, 151, 0.4)",brown:"rgba(140, 46, 0, 0.2)",yellow:"rgba(233, 168, 0, 0.2)",green:"rgba(0, 135, 107, 0.2)",orange:"rgba(245, 93, 0, 0.2)",blue:"rgba(0, 120, 223, 0.2)",purple:"rgba(103, 36, 222, 0.2)",pink:"rgba(221, 0, 129, 0.2)",red:"rgba(255, 0, 26, 0.2)"},t.randomNotionColor=function(){return Object.keys(t.notionColors)[Math.floor(Math.random()*Object.keys(t.notionColors).length)]}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.promisify=function(e,t){return new Promise((function(n,r){e(t,n)}))},t.call=function(e){new Promise((function(t,n){t(e())}))},t.makeid=function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=n.length,o=0;o<e;o++)t+=n.charAt(Math.floor(Math.random()*r));return t},t.print=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.sleep=function(e){return r(void 0,void 0,void 0,(function(){return o(this,(function(t){return[2,new Promise((function(t){return setTimeout(t,e)}))]}))}))},t.throttle=function(e,t){var n,r,o;return function(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];var s=new Date;return r&&(r(void 0),clearTimeout(o),r=null),new Promise((function(a){var u=n?Math.max(0,t-(s.getTime()-n.getTime())):0;r=a,o=setTimeout((function(){n=s,r=null,a(e.apply(null,i))}),u)}))}},t.getChipColor=function(e){return e.color in i.notionColors?i.notionColors[e.color]:i.notionColors.default};t.arrayMove=function(e,t,n){return function(e,t,n){var r=n<0?e.length+n:n,o=e.splice(t,1)[0];e.splice(r,0,o)}(e=e.slice(),t,n),e}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},a=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r};Object.defineProperty(t,"__esModule",{value:!0});var s=n(8),u=n(15),c=n(4),l=n(6),f=function(){function e(e){var t=this;this.defaultHeaders={accept:"*/*","accept-language":"en-US,en;q=0.9","accept-encoding":"gzip, deflate, br",origin:"https://www.notion.so",referer:"https://www.notion.so"},this.custom={createWebClippedPage:function(e,n){var r=n.title,a=n.url;return o(t,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.addWebClipperURLs({blockId:e,items:[{title:r,url:a}],from:"chrome",type:"block"})];case 1:return[2,t.sent().createdBlockIds[0]]}}))}))}},this.token=e}return e.prototype._axios=function(e,t,n,a){return void 0===t&&(t="get"),void 0===n&&(n={}),void 0===a&&(a={}),o(this,void 0,void 0,(function(){return i(this,(function(o){switch(o.label){case 0:return[4,fetch("https://www.notion.so/api/v3/"+(e.startsWith("/")&&e.slice(1)||e),{method:t.toUpperCase(),headers:r(r(r({"content-type":"application/json"},this.defaultHeaders),this.token&&{cookie:"token_v2="+this.token}),a),body:JSON.stringify(n)})];case 1:return[2,o.sent().json()]}}))}))},e.prototype.post=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n={}),this._axios(e,"post",t,n)},e.prototype.put=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n={}),this._axios(e,"put",t,n)},e.prototype.delete=function(e){return this._axios(e,"delete")},e.prototype.get=function(e){return this._axios(e,"get",null)},e.prototype.addWebClipperURLs=function(e){return this.post("/addWebClipperURLs",e)},e}();t.NotionV3Client=f;var p=function(e,t){switch(t.type){case"checkbox":if("boolean"!=typeof e)throw"value passed to property "+t.strippedName+" must be bool";return[[e?"Yes":"No"]];case"select":case"text":case"title":if("string"!=typeof e)throw"value passed to property "+t.strippedName+" must be string, but got "+e;return[[e]];case"number":return[[String(parseFloat(e))]];case"multi_select":return[[e.join(",")]];case"relation":return e;default:return u.print("WARNING: "+t.type+" not uncasted"),[[e]]}};var d={"youtube.com":!0},h=function(){function e(e,t,n,r){this.id=e,this.parentId=n,this.fetched=!1,this.schema={},this.viewId=t,this.rows={},this.client=r}return e.prototype.initLocally=function(e){this._extractSchema(e),this.fetched=!0},e.prototype._extractSchema=function(e){this.schema={};for(var t=0,n=Object.keys(e);t<n.length;t++){var o=n[t],i=e[o];this.schema[o]=r(r({},i),{id:o,strippedName:""})}u.print("keys are ",Object.keys(this.schema))},e.prototype.createRow=function(e,t){return o(this,void 0,void 0,(function(){var n,r,o,a,s,u,c,l,p;return i(this,(function(i){switch(i.label){case 0:return n=[],r=null,t?(o=new f(this.client.authToken),console.log("got",e),[4,o.custom.createWebClippedPage(this.parentId,{title:e.title,url:t.url})]):[3,2];case 1:return r=i.sent(),console.log("got",r),[3,3];case 2:a=this.client.createRecordOperations("block",{id:this.id,_table:"collection"},{type:"page"}),s=a.id,u=a.operations,r=s,n=u,i.label=3;case 3:if(this.rows[r]={id:r},c=!1,null!=t){c=!0;try{l=new URL(t.url),console.log("got",l.hostname),p=l.hostname.startsWith("www.")&&l.hostname.substring(4)||l.hostname,console.log(">>>>",p),p in d&&(c=!1)}catch(e){}}return[2,this.updateRow({where:{id:r},data:e,operations:n,skipFrontImage:c})]}}))}))},e.prototype.findRow=function(e){var t=e.where;return o(this,void 0,void 0,(function(){var e,n,r,o,a;return i(this,(function(i){if(t.id&&t.id in this.rows)return[2,this.rows[t.id]];for(n in e=Object.keys(t).length,this.rows){for(a in r=this.rows[n],o=0,t){if(r[a]!=t[a])break;o++}if(o==e)return[2,r]}return[2,null]}))}))},e.prototype.updateRow=function(e){var t=e.where,n=e.data,r=e.operations,s=e.skipFrontImage;return o(this,void 0,void 0,(function(){var e,o,f,d,h,v,m,g,b,y,w,_,k;return i(this,(function(i){switch(i.label){case 0:return e=[],o=r,[4,this.findRow({where:t})];case 1:if(!(f=i.sent()))throw"can't update because row not found";return d=f.id,n.__template?(v=(h=o.push).apply,m=[o],[4,c.getTransacOperationsFromTemplate(n.__template.blocksMap,n.__template.id,f.id)]):[3,3];case 2:v.apply(h,m.concat([i.sent()])),u.print(o,"[43m -- lowOperations [0m"),i.label=3;case 3:for(g in n.pageFrontImage&&0==s&&o.push.apply(o,function(e,t){var n=t.imgUrl,r=t.width,o=t.height,i=t.opts;u.print("here","ok","ok");var s=l(),c=l(),f={large:{width:672,height:380},normal:{width:672,height:250},small:{width:336,height:175}},p=f[i.size].width,d=f[i.size].height,h=null,v=null,m=!1,g=!1;switch(i.type){case"coverLike":"large"==i.size&&(g=!0),v=o,(h=r)!=p&&(v=Math.floor(v*(p/h)),h=p),v>d&&(h=Math.floor(h*(d/v)),v=d),h<p&&(g=!1),u.print("heve",v,h),v=null;break;case"fullWidthCover":m=!0,v=d}return a([{id:s,table:"block",path:[],command:"set",args:{type:"text",id:s,version:1}},{id:s,table:"block",path:[],command:"update",args:{parent_id:e,parent_table:"block",alive:!0}},{table:"block",id:e,path:["content"],command:"listBefore",args:{id:s}},{id:s,table:"block",path:[],command:"update",args:{type:"image"}},{id:s,table:"block",path:["properties"],command:"update",args:{source:[[n]]}},{id:s,table:"block",path:["format"],command:"update",args:{display_source:n}},{id:s,table:"block",path:["format"],command:"update",args:{block_height:v,block_width:h,block_full_width:m,block_page_width:g}}],(1==i.addDivider||void 0===i.addDivider)&&[{id:c,table:"block",path:[],command:"set",args:{type:"divider",id:c,properties:{}}},{id:c,table:"block",path:[],command:"update",args:{parent_id:e,parent_table:"block",alive:!0}},{table:"block",id:e,path:["content"],command:"listAfter",args:{after:s,id:c}}]||[])}(f.id,n.pageFrontImage)),n)"__template"!=g&&"pageFrontImage"!=g&&("pageCover"!=g?"pageIcon"!=g?(b=this.schema[g],y=["properties",b.id],w=p(n[g],b),e.push({path:y,value:w})):e.push({path:["format","page_icon"],value:n[g].imgUrl}):e.push({path:["format","page_cover"],value:n[g].imgUrl}));return[4,this.client.updateDataRecord(d,e,o)];case 4:for(k in i.sent(),_=this.rows[d],n)_[k]=n[k];return[2,{id:_.id}]}}))}))},e}();function v(e,t,n){return null!=e&&null!=e[t]&&e[t].length&&e[t][0].length&&e[t][0][0]||n}function m(e,t){for(var n,r,o=[],i=e[t];null!=i&&i.value;)"page"==i.value.type&&o.push({name:v(i.value.properties,"title","Untitled"),icon:(null===(n=i.value.format)||void 0===n?void 0:n.page_icon)||null}),i=e[(null===(r=i.value)||void 0===r?void 0:r.parent_id)||null];return o.reverse(),o}t.Collection=h,t.client=null;var g={id:null,spaces:[],givenName:null},b=function(){function e(e){this.agent=s.createAgent({token:e,debug:!1}),this.authToken=e,this.user=g}return e.prototype.addValueToPropertyCollection=function(e,t,n,s,u){return o(this,void 0,void 0,(function(){var o,c;return i(this,(function(i){switch(i.label){case 0:return o=r({},e.schema),c={id:s,value:n,color:u},o[t]=r(r({},o[t]),{options:a(o[t].options||[],[c])}),[4,this._submitTransaction([{id:e.id,table:"collection",path:[],command:"update",args:{schema:o}}])];case 1:return i.sent(),[2,c]}}))}))},e.prototype.setUserInfos=function(e){this.user=e},e.prototype.fetchUserInfos=function(){return o(this,void 0,void 0,(function(){var e,t,n,r,o;return i(this,(function(i){switch(i.label){case 0:return[4,this.agent.loadUserContent({})];case 1:for(r in e=i.sent(),t=Object.keys(e.recordMap.notion_user),this.user.id=t[0],n=e.recordMap.notion_user[this.user.id],this.user.givenName=n.value.given_name,e.recordMap.space)o=e.recordMap.space[r],this.user.spaces.push({id:r,name:o.value.name});return[2]}}))}))},e.prototype.createRecordOperations=function(e,t,n){void 0===n&&(n={});var o=l(),i=r({id:o,version:1,alive:!0,created_by:this.user.id,created_time:Date.now(),last_edited_time:Date.now(),parent_id:t.id,parent_table:t._table},n);return{id:o,operations:[this._buildOperation({id:o,command:"set",args:i,table:e})]}},e.prototype.createRecord=function(e,t,n){return void 0===n&&(n={}),o(this,void 0,void 0,(function(){var o,a;return i(this,(function(i){switch(i.label){case 0:return o=n.id||l(),a=r({id:o,version:1,alive:!0,created_by:this.user.id,created_time:Date.now(),last_edited_time:Date.now(),parent_id:t.id,parent_table:t._table},n),[4,this._submitTransaction([this._buildOperation({id:o,command:"set",args:a,table:e})])];case 1:return i.sent(),[2,o]}}))}))},e.prototype.updateDataRecord=function(e,t,n){return o(this,void 0,void 0,(function(){var r=this;return i(this,(function(o){switch(o.label){case 0:return[4,this._submitTransaction(a(n||[],t.map((function(t){return r._buildOperation({id:e,command:"set",table:"block",path:t.path,args:t.value})}))))];case 1:return o.sent(),[2,e]}}))}))},e.prototype.getCollectionLocally=function(e,t,n){return o(this,void 0,void 0,(function(){var r;return i(this,(function(o){return(r=new h(e,"",t,this)).initLocally(n),[2,r]}))}))},e.prototype._buildOperation=function(e){return{id:(e=r({table:"block",path:[],args:{},command:"set"},e)).id,path:e.path,args:e.args,command:e.command,table:e.table}},e.prototype.searchCollectionPages=function(e,t,n){var r;return o(this,void 0,void 0,(function(){var o,a,s,u,c,l,f;return i(this,(function(i){switch(i.label){case 0:return[4,this.agent.search({type:"BlocksInParent",query:e,spaceId:n,parentId:t,limit:20,filters:{isDeletedOnly:!1,excludeTemplates:!0,isNavigableOnly:!0,requireEditPermissions:!1,ancestors:[],createdBy:[],editedBy:[],lastEditedTime:{},createdTime:{}},sort:"Relevance",source:"relation_menu"})];case 1:for(o=i.sent(),a=[],s=0,u=o.results;s<u.length;s++)c=u[s],(l=c.id)in o.recordMap.block&&(f=o.recordMap.block[l].value,a.push({id:f.id,name:v(f.properties,"title","Untitled"),icon:(null===(r=f.format)||void 0===r?void 0:r.page_icon)||null}));return[2,a]}}))}))},e.prototype.searchCollections=function(e,t){return void 0===e&&(e=""),void 0===t&&(t=this.user.spaces[0].id),o(this,void 0,void 0,(function(){var n,r,o,a;return i(this,(function(i){switch(i.label){case 0:return[4,this.agent.search({query:e,type:"CollectionsInSpace",spaceId:t,limit:20,sort:"Relevance",source:"link_to_collection_block",filters:{isDeletedOnly:!1,excludeTemplates:!0,isNavigableOnly:!1,requireEditPermissions:!0,ancestors:[],createdBy:[],editedBy:[],lastEditedTime:{},createdTime:{}}})];case 1:for(o in n=i.sent(),r=[],n.recordMap.collection)(a=n.recordMap.collection[o].value).parents=m(n.recordMap.block,a.parent_id),r.push(a);return[2,r]}}))}))},e.prototype._submitTransaction=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){return[2,this.agent.submitTransaction({requestId:l(),transactions:[{id:l(),operations:e}]})]}))}))},e.prototype.appendBulletPointToPage=function(e,t){return o(this,void 0,void 0,(function(){var n,r;return i(this,(function(o){return n=l(),e=function(e){if(e){var t=e.replace(/\-/g,"").slice(-32);return(n=t).substr(0,8)+"-"+n.substr(8,4)+"-"+n.substr(12,4)+"-"+n.substr(16,4)+"-"+n.substr(20)}var n}(e),u.print("got",e),r=[{id:n,table:"block",path:[],command:"update",args:{type:"bulleted_list",id:n,parent_id:e,parent_table:"block",alive:!0,version:1,created_time:Date.now(),last_edited_time:Date.now(),properties:{title:[[t]]}}},{table:"block",id:e,path:["content"],command:"listAfter",args:{id:n}}],[2,this._submitTransaction(r)]}))}))},e}();t.DummyNotionClient=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new(n(11).Logger)("notionapi-agent");t.log=r},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),u=n(0),c=n(0),l=a(n(5)),f=n(1),p=n(16),d=n(6);function h(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){return[2,l.default.set("popup-state",r(r({},e),{createdAt:Date.now(),lastUpdatedAt:Date.now()}))]}))}))}function v(){return o(this,void 0,void 0,(function(){return i(this,(function(e){return[2,h(null)]}))}))}function m(e){return console.log("colection !!!",e.collection),r(r({},e),{collection:r({},e.collection),name:e.name.length&&e.name||"Untitled",daps:e.daps.filter((function(e){return null!=e.property}))})}t.getFormData=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,l.default.get(u.FORM_KEY_PREFIX+e,null)];case 1:return[2,t.sent()]}}))}))},t.saveCurrentPopupState=h,t.getCurrentPopupState=function(e){return o(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return[4,l.default.get("popup-state",null)];case 1:if(!(t=r.sent()))return[2,t];switch(v(),n=Date.now(),t.pos){case"fillForm":return t.url!=e?[2,null]:n-t.lastUpdatedAt>6e4?[2,null]:[2,t];case"settings":return n-t.lastUpdatedAt>6e4?[2,null]:[2,t]}return[2]}}))}))},t.resetCurrentPopupState=v,t.deleteFormData=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,l.default.get(u.FORM_LIST_KEY,[])];case 1:return t=n.sent(),l.default.set(u.FORM_LIST_KEY,t.filter((function(t){return t.id!=e}))),l.default.set(u.FORM_KEY_PREFIX+e,null),[2]}}))}))},t.saveFormData=function(e,t,n){return o(this,void 0,void 0,(function(){var r,o,a;return i(this,(function(i){switch(i.label){case 0:return[4,l.default.get(u.FORM_LIST_KEY,[])];case 1:if(r=i.sent(),"new"!=t)return[3,4];for(a=f.makeid(4);r.some((function(e){return e.id==a}));)a=f.makeid(4);return e.id=a,r.push({name:e.name,id:a}),[4,l.default.set(u.FORM_LIST_KEY,r)];case 2:return i.sent(),[4,l.default.set(u.FORM_KEY_PREFIX+a,m(e))];case 3:return i.sent(),o={id:a,name:e.name},[3,7];case 4:return r=r.map((function(t){return t.id!=n?t:{name:e.name,id:n,favorite:!0===t.favorite}})),o={id:n,name:e.name},[4,l.default.set(u.FORM_LIST_KEY,r)];case 5:return i.sent(),[4,l.default.set(u.FORM_KEY_PREFIX+n,m(e))];case 6:i.sent(),i.label=7;case 7:return f.print("storage size: ",JSON.stringify(e).length),[2,o]}}))}))},t.getTransacOperationsFromTemplate=function(e,t,n){return o(this,void 0,void 0,(function(){return i(this,(function(o){return[2,function e(t,n,o,i){var a=i||d(),s={id:a,table:"block",path:[],command:"update",args:{}},u=[s];if("none"==t.role)return{id:a,ops:[r(r({},s),{args:{type:"text",parent_id:n}})]};var c=t.value;if(s.args=r(r({},c),{id:a,parent_id:n,copied_from:c.id}),["is_template","created_time","last_edited_time"].forEach((function(e){delete s.args[e]})),c.content){var l=c.content.map((function(t){return e(o[t],a,o)})),f=l.map((function(e){return e.id}));s.args.content=f,u.push.apply(u,l.flatMap((function(e){return e.ops})))}return{id:a,ops:u}}(e[t],void 0,e,n).ops]}))}))},t.getTransacOperationsFromWebClipping=function(){return o(this,void 0,void 0,(function(){return i(this,(function(e){return[2,[]]}))}))},t.getUpToDateTemplateBlocksMap=function e(t,n,r){return o(this,void 0,void 0,(function(){var o;return i(this,(function(i){switch(i.label){case 0:return r?(f.print("refreshing the template..."),[4,p.fetchFullContentPage(n,t.authToken)]):[3,3];case 1:return o=i.sent(),[4,l.default.set("TEMPLATE-"+n,o)];case 2:return i.sent(),[3,7];case 3:return[4,l.default.get("TEMPLATE-"+n,null)];case 4:return null!=(o=i.sent())?[3,6]:[4,e(t,n,!0)];case 5:return o=i.sent(),[3,7];case 6:f.print("got template from cache!"),i.label=7;case 7:return f.print(o,"[43m -- content template [0m"),[2,o]}}))}))},t.throttle=function(e,t){var n,r,o;return function(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];var s=new Date;return r&&(r(void 0),clearTimeout(o),r=null),new Promise((function(a){var u=n?Math.max(0,t-(s.getTime()-n.getTime())):0;r=a,o=setTimeout((function(){n=s,r=null,a(e.apply(null,i))}),u)}))}};var g=["pageCover","pageFrontImage","pageIcon"];function b(e,t){if(e.needToResetCollection)return{daps:t,collection:void 0};for(var n=[],o=function(t){var o=e.fieldsToModify.find((function(e){return e.key==t.key})),i=void 0;if(t.property&&(g.some((function(e){return e==t.property.id}))?(f.print("reaplie",t.property),i=t.property):i=r(r({},e.collection.schema[t.property.id]),{id:t.property.id})),!o)return n.push(r(r({},t),{property:i})),"continue";switch(o.action){case"remove":return"continue";case"removeDefaultValue":n.push(r(r({},t),{property:i,options:{}}))}},i=0,a=t;i<a.length;i++){o(a[i])}return{collection:e.collection,daps:n}}function y(e,t){var n,r,a;return o(this,void 0,void 0,(function(){var o,s;return i(this,(function(i){switch(i.label){case 0:return[4,e.agent.loadPageChunk({pageId:t,limit:1,cursor:{stack:[[{id:t,table:"block",index:0}]]},chunkNumber:0,verticalColumns:!1})];case 1:return o=i.sent(),(s=o.recordMap.block[t])?(f.print(s,"[43m -- page [0m"),[2,{name:(null===(n=s.value)||void 0===n?void 0:n.properties.title[0][0])||"undefined",id:t,lastEditedTime:s.value.last_edited_time||Date.now(),icon:(null===(a=null===(r=s.value)||void 0===r?void 0:r.format)||void 0===a?void 0:a.page_icon)||null}]):[2,null]}}))}))}function w(e){try{return window.btoa(e)}catch(t){return e}}function _(e){try{return window.atob(e)}catch(t){return e}}function k(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),f.print("fetch",e.user),[4,e.fetchUserInfos()];case 1:return n.sent(),f.print("fetchdone",e.user),[3,3];case 2:return n.sent(),[2,{status:"error",errorMsg:"cookie_expired"}];case 3:return[4,l.default.set(c.NOTION_CLIENT_DATA_KEY,w(JSON.stringify(e.user)))];case 4:return n.sent(),[4,l.default.set(c.COOKIE_KEY,w(t))];case 5:return n.sent(),[2,{status:"ok",client:e}]}}))}))}t.applyRefreshCollection=b,t.applyRefreshCollectionOnData=function(e,t){var n=b(e,t.daps),o=n.collection,i=n.daps;return r(r({},t),{collection:o,daps:i,template:!e.needToRemoveTemplate&&t.template||void 0,needToRefreshTemplate:e.needToRefreshTemplate})},t.refreshCollection=function(e,t,n,r){return o(this,void 0,void 0,(function(){var o,a,s,u,c,l,p,d,h,v,m;return i(this,(function(i){switch(i.label){case 0:return o={needToResetCollection:!1,fieldsToModify:[]},[4,e.agent.loadPageChunk({pageId:t.parent_id,limit:1,cursor:{stack:[[{id:t.parent_id,table:"block",index:0}]]},chunkNumber:0,verticalColumns:!1})];case 1:return a=i.sent(),t.id in a.recordMap.collection?(o.collection=a.recordMap.collection[t.id].value,s=o.collection,r.getTemplatesInfo&&s.template_pages?(u=s,[4,Promise.all(s.template_pages.map((function(t){return y(e,t)})))]):[3,3]):(o.needToResetCollection=!0,[2,o]);case 2:u.templatesInfo=i.sent(),i.label=3;case 3:return r.checkTemplateUpToDate?(s.template_pages||[]).some((function(e){return r.checkTemplateUpToDate.id}))?[3,4]:(o.needToRemoveTemplate=!0,[3,6]):[3,6];case 4:return[4,y(e,r.checkTemplateUpToDate.id)];case 5:c=i.sent(),f.print(c.lastEditedTime>r.checkTemplateUpToDate.lastEditedTime,"checking template is up to date",r.checkTemplateUpToDate,c),c.lastEditedTime>r.checkTemplateUpToDate.lastEditedTime&&(o.needToRefreshTemplate=!0),o.collection.template=c,i.label=6;case 6:return l=o.collection.schema,[4,e.getCollectionLocally(t.id,t.parent_id,l)];case 7:for(p=i.sent(),d=function(e){if(e.property){if(g.some((function(t){return t==e.property.id})))return"continue";if(e.property.id in p.schema){var t=p.schema[e.property.id];if(e.property.type!=t.type)o.fieldsToModify.push({key:e.key,action:"removeDefaultValue"});else if(["select","multi_select"].includes(e.property.type))switch(e.property.type){case"select":!e.options.defaultSelectId||t.options&&t.options.some((function(t){return t.id==e.options.defaultSelectId}))||o.fieldsToModify.push({key:e.key,action:"removeDefaultValue"});break;case"multi_select":!e.options.defaultSelectIds||t.options&&e.options.defaultSelectIds.every((function(e){return t.options.some((function(t){return t.id==e}))}))||o.fieldsToModify.push({key:e.key,action:"removeDefaultValue"})}}else o.fieldsToModify.push({key:e.key,action:"remove"})}},h=0,v=n;h<v.length;h++)m=v[h],d(m);return[2,o]}}))}))},t.getClient=function(e){return o(this,void 0,void 0,(function(){var t,n,r,o,a;return i(this,(function(i){switch(i.label){case 0:return[4,f.promisify(chrome.cookies.get,{url:"https://www.notion.so",name:"token_v2"})];case 1:return(n=i.sent())?(r=n.value,[4,l.default.get(c.COOKIE_KEY,null)]):[2,{status:"error",errorMsg:"need_to_login_to_notion"}];case 2:return(o=i.sent())&&(o=_(o)),[4,l.default.get(c.NOTION_CLIENT_DATA_KEY,null)];case 3:return(a=i.sent())&&(a=JSON.parse(_(a))),t=new s.DummyNotionClient(r),o&&o==r&&a?[3,5]:(e&&e("fetching_client"),[4,k(t,r)]);case 4:return[2,i.sent()];case 5:t.setUserInfos(a),i.label=6;case 6:return[2,{status:"ok",client:t}]}}))}))};var T={},O={};function P(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return e in T?[2,T[e].map]:[4,l.default.get("collection-pages-"+e,{count:0,map:{},order:[]})];case 1:return t=n.sent(),T[e]=t,[2,t.map]}}))}))}t.getCachedCollectionPages=P,t.upsertCachedCollectionPage=function(e,t){return o(this,void 0,void 0,(function(){var n,a,s=this;return i(this,(function(u){switch(u.label){case 0:return[4,P(t)];case 1:return n=u.sent(),e.id in n||(T[t].count>300&&(a=T[t].order.shift(),delete n[a],T[t].count--),T[t].count++,T[t].order.push(e.id)),n[e.id]=e,O[t]||(O[t]=setTimeout((function(){return o(s,void 0,void 0,(function(){var e,n,o;return i(this,(function(i){switch(i.label){case 0:return e=T[t].map,n=Object.keys(e).sort((function(t,n){return e[t].name.toLowerCase()<e[n].name.toLowerCase()?-1:1})),o={},n.forEach((function(e){return o[e]=T[t].map[e]})),[4,l.default.set("collection-pages-"+t,r(r({},T[t]),{map:o}))];case 1:return i.sent(),O[t]=null,[2]}}))}))}),200)),[2,n]}}))}))}},function(e,t,n){"use strict";var r,o,i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1);function u(e,t){return 0===t?e:e+"_"+t}var c=(null===(r=chrome.storage.sync)||void 0===r?void 0:r.QUOTA_BYTES_PER_ITEM)||8192,l=(null===(o=chrome.storage.sync)||void 0===o?void 0:o.MAX_ITEMS)||512;function f(e,t){return i(this,void 0,void 0,(function(){var n=this;return a(this,(function(r){return[2,new Promise((function(r){!function(e,t,n){chrome.storage.local.get(null,(function(r){var o,i="",a=!1;for(o=0;o<l&&void 0!==r[u(e,o)];o++)a=!0,i+=r[u(e,o)];a?t(JSON.parse(i)):n()}))}(e,(function(e){r(e)}),(function(){return i(n,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return s.print("no value found, saving default"),[4,p(e,t)];case 1:return n.sent(),r(t),[2]}}))}))}))}))]}))}))}function p(e,t){return i(this,void 0,void 0,(function(){return a(this,(function(n){return new Promise((function(n){!function(e,t,n){for(var r,o,i=0,a={},s=JSON.stringify(t),l=[];s.length>0;)o=u(e,i),r=s.substr(0,c-o.length-2),l.push(r.length),a[o]=r,s=s.substr(c-o.length-2),i++;chrome.storage.local.set(a,n),chrome.storage.local.remove(u(e,i))}(e,t,(function(){n()}))})),[2]}))}))}t.get=f,t.set=p,t.default={set:p,get:f}},function(e,t,n){var r=n(18),o=n(19);e.exports=function(e,t,n){var i=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var s=0;s<16;++s)t[i+s]=a[s];return t||o(a)}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),u=n(1),c=n(4),l=a(n(5));function f(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,T(e)];case 1:return t=n.sent(),console.log(">>",t),null==t?[2,{success:!1,errorMsg:"page not saved"}]:[2,{success:!0,res:t}]}}))}))}function p(e,t){return o(this,void 0,void 0,(function(){var n,r,o;return i(this,(function(i){switch(i.label){case 0:return u.print("get page data from cache"),[4,T(e)];case 1:return null==(n=i.sent())?[2,!1]:(u.print("get client"),[4,c.getClient()]);case 2:return"error"==(r=i.sent()).status?[2,!1]:(o=r.client,u.print("saving to notion"),[4,o.appendBulletPointToPage(n.notionPageId,t)]);case 3:return i.sent(),n.highlights.push({text:t}),u.print("storing in cache"),[4,l.default.set("page-"+e,n)];case 4:return i.sent(),[2,!0]}}))}))}function d(e,t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return console.log("url",e),[4,f(e)];case 1:return n=r.sent(),u.print("here,",n.success,n.res),n.success?(t?function(e,t){o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return v({action:"loading",msg:"Saving Highlight to Notion..."}),[4,p(e,t)];case 1:return 0!=n.sent()?[3,2]:(u.print("failed to highlight"),v({action:"fail",msg:"Didn't saved to Notion... Ensure you are connected on notion.so",timeout:3e3}),[2]);case 2:return[4,m("highlightSelection.js")];case 3:n.sent(),v({action:"success",msg:"Highlight saved!",timeout:1500}),n.label=4;case 4:return[2]}}))}))}(e,t):function(e){o(this,void 0,void 0,(function(){var t,n=this;return i(this,(function(r){switch(r.label){case 0:return u.print("quick note!"),[4,T(e)];case 1:return null==r.sent()?[2,!1]:[4,g("modalAddNote.js",(function(t){return o(n,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return 0==t.text.length?[2,!1]:(v({action:"loading",msg:"Saving Note to Notion..."}),[4,p(e,"NOTE 📝 : "+t.text)]);case 1:return v(1==(n=r.sent())?{action:"success",msg:"Note saved!",timeout:1500}:{action:"fail",msg:"Didn't saved to Notion... Ensure you are connected on notion.so",timeout:3e3}),console.log("saved to notion!",n),[2,{success:n}]}}))}))}))];case 2:return t=r.sent(),u.print("receiver",t),[2]}}))}))}(e),[2]):(v({action:"fail",msg:"No Notion Page Found, ",tutorial:!0,timeout:3e3}),[2])}}))}))}function h(){return o(this,void 0,void 0,(function(){return i(this,(function(e){return[2,new Promise((function(e,t){try{chrome.tabs.query({currentWindow:!0,active:!0},(function(t){e(t[0])}))}catch(e){t(e)}}))]}))}))}function v(e){var t=e.action,n=e.msg,r=e.timeout,a=void 0===r?2e3:r,s=e.tutorial;return o(this,void 0,void 0,(function(){var e,r;return i(this,(function(o){switch(o.label){case 0:return e="displaySnackBar.js",[4,h()];case 1:return r=o.sent(),[4,new Promise((function(o){return chrome.tabs.executeScript(r.id,{code:'var action = "'+t+'"; timeout = '+a+'; msg = "'+n+'"; tutorial = '+!!s},(function(){return chrome.tabs.executeScript(r.id,{file:"/"+e},(function(e){o(e[0])}))}))}))];case 2:return[2,o.sent()]}}))}))}function m(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,h()];case 1:return t=n.sent(),[4,new Promise((function(n){return chrome.tabs.executeScript(t.id,{file:"/"+e},(function(e){n(e[0])}))}))];case 2:return[2,n.sent()]}}))}))}function g(e,t){return o(this,void 0,void 0,(function(){var n,r,a=this;return i(this,(function(s){switch(s.label){case 0:return[4,h()];case 1:return n=s.sent(),r=Math.floor(65536*(1+Math.random())).toString(16).substring(1),[4,new Promise((function(s){return chrome.tabs.executeScript(n.id,{code:"var asyncId = '"+r+"';"},(function(){return chrome.tabs.executeScript(n.id,{file:"/"+e},(function(){return o(a,void 0,void 0,(function(){function e(o,i,a){if(console.log("ask request: "+(o.end?"FINAL":"normal")+" ("+(o.asyncId!=r?"canceled":"ok")+")",o),o.asyncId==r)return o.end?(chrome.runtime.onMessage.removeListener(e),n(o),null):(t(o).then((function(e){a(e)})),!0)}var n,o,a;return i(this,(function(t){switch(t.label){case 0:return n=null,chrome.runtime.onMessage.removeListener(e),chrome.runtime.onMessage.addListener(e),o=new Promise((function(e){n=e})),a=s,[4,o];case 1:return a.apply(void 0,[t.sent()]),[2]}}))}))}))}))}))];case 2:return[2,s.sent()]}}))}))}function b(){var e;return o(this,void 0,void 0,(function(){var t,n;return i(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,h()];case 1:return t=o.sent(),[3,3];case 2:return o.sent(),u.print("err"),[2,void 0];case 3:return u.print(t,t.title),[4,new Promise((function(e){return chrome.tabs.executeScript(t.id,{file:"/parseMetaTags.js"},(function(t){e(t[0])}))}))];case 4:return n=o.sent(),[2,r(r({},n),{title:(null===(e=t.url)||void 0===e?void 0:e.startsWith("https://www.youtube.com"))&&"yt_author"in n&&(t.title||"")+" - "+n.yt_author||t.title,url:t.url,favIconUrl:t.favIconUrl})]}}))}))}function y(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,h()];case 1:return t=n.sent(),[3,3];case 2:return n.sent(),u.print("err"),[2,void 0];case 3:return[4,new Promise((function(n){return chrome.tabs.executeScript(t.id,{code:"var __save_to_notion_customs = "+JSON.stringify(e)+";  "},(function(){n()}))}))];case 4:return n.sent(),[4,new Promise((function(e){return chrome.tabs.executeScript(t.id,{file:"/getCustomCssData.js"},(function(t){e(t[0])}))}))];case 5:return[2,n.sent()]}}))}))}function w(e,t){var n,o,i;switch(t.type){case"select":return t.options?0==(i=t.options.filter((function(t){return t.id==e.options.defaultSelectId}))).length?"":i[0].value:"";case"relation":var a=[],s=(null===(n=e.options)||void 0===n?void 0:n.defaultSelectIds)||[];return s.forEach((function(e,t){a.push(["‣",[["p",e]]]),t+1<s.length&&a.push([","])})),a;case"multi_select":if(!t.options)return[];var c={};return null===(o=e.options.defaultSelectIds)||void 0===o||o.forEach((function(e){return c[e]=!0})),0==(i=t.options.filter((function(e){return c[e.id]}))).length?[]:i.map((function(e){return e.value}));case"image":if(!e.options.defaultValue)return;var l=e.options.defaultValue;return u.print("IMG",l),l.imgUrl?r(r({},l),{opts:e.fieldOptions.image?e.fieldOptions.image:{size:"normal",type:"coverLike"}}):void 0;case"text":default:return e.options.defaultValue}}function _(e){for(var t={},n=0,r=e.daps;n<r.length;n++){var o=r[n],i=o.property;switch(o.kind){case"data":var a=o.property.id;t[a]=w(o,i),void 0===t[a]&&delete t[a];break;case"prefilled":if(!o.options.defaultSelectId)throw"todo";break;default:throw"not implem"}}return t}function k(e,t,n){return o(this,void 0,void 0,(function(){var a,f,p,d,h,v,m,g,b;return i(this,(function(y){switch(y.label){case 0:return u.print("SUBMIT TO NOTION",t,n),e.postMessage({type:"submitting"}),[4,u.promisify(chrome.cookies.get,{url:"https://www.notion.so",name:"token_v2"})];case 1:return(a=y.sent())?(console.log("preparing data to send to Notion..."),f=new s.DummyNotionClient(a.value),new s.NotionV3Client(a.value),console.log("got",t.collection),[4,f.getCollectionLocally(t.collection.id,t.collection.parent_id,t.collection.schema)]):(e.postMessage({type:"error",errorInfo:"failed to fetch the cookie"}),e.disconnect(),[2]);case 2:p=y.sent(),[],y.label=3;case 3:return y.trys.push([3,5,,6]),[4,_(t)];case 4:return d=y.sent(),[3,6];case 5:return h=y.sent(),u.print("error formatting",h),e.postMessage({type:"error"}),e.disconnect(),[2];case 6:return console.log("loading the template..."),t.template?(u.print("fetching template",t.needToRefreshTemplate),[4,c.getUpToDateTemplateBlocksMap(f,t.template.id,t.needToRefreshTemplate)]):[3,9];case 7:return v=y.sent(),d.__template={blocksMap:v,id:t.template.id},t.needToRefreshTemplate?(u.print("save template info"),[4,c.getFormData(t.id)]):[3,9];case 8:m=y.sent(),c.saveFormData(r(r({},m),{template:m.template?r(r({},m.template),{lastEditedTime:Date.now()}):void 0}),"edit",t.id),y.label=9;case 9:u.print("formatted data",d),u.print("submit to notion..."),u.print("got",t.savePageContent,n),console.log("send data to Notion..."),y.label=10;case 10:return y.trys.push([10,12,,13]),[4,p.createRow(d,t.savePageContent&&n&&{title:"Full Page Articles",url:n})];case 11:return g=y.sent(),[3,13];case 12:return b=y.sent(),u.print("Fatal Error:"),u.print(b),e.postMessage({type:"error"}),e.disconnect(),[2];case 13:return console.log("Done!"),null!=n&&function(e,t){o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return t=t.split("#")[0],u.print("saving",t),n={url:t,notionPageId:e,highlights:[]},[4,l.default.set("page-"+t,n)];case 1:return r.sent(),[2]}}))}))}(g.id,n),e.postMessage({type:"success_submit",id:g.id}),[2]}}))}))}function T(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return e=e.split("#")[0],console.log("here",e),[4,l.default.get("page-"+e,null)];case 1:return[2,t.sent()]}}))}))}u.print("hello world"),chrome.commands.onCommand.addListener((function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return console.log("command",e),[4,m("getselectedText.js")];case 1:return d((t=n.sent()).pageUrl,t.selectionText.length>0&&t.selectionText||null),[2]}}))}))})),chrome.contextMenus.create({title:"Add Highlight",id:"add_highlights",contexts:["selection"]}),chrome.contextMenus.onClicked.addListener((function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(t){return d(e.pageUrl,e.selectionText),[2]}))}))})),chrome.runtime.onMessage.addListener((function(e,t,n){return o(this,void 0,void 0,(function(){var t,o;return i(this,(function(i){switch(i.label){case 0:switch(e.type){case"getMetadatas":return[3,1]}return[3,3];case 1:return t=n,o=[{}],[4,b()];case 2:t.apply(void 0,[r.apply(void 0,o.concat([i.sent()]))]),i.label=3;case 3:return[2,null]}}))}))})),chrome.runtime.onConnect.addListener((function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:switch(u.print("receive port connection",e.name),u.print("get_metadatas"==e.name),e.name){case"submit_form_to_notion":return[3,1];case"get_metadatas":return[3,2];case"get_custom_css":return[3,4]}return[3,5];case 1:return e.onMessage.addListener((function(t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(u.print("received",t),t.type){case"initial_data":k(e,t.params.form,t.params.currentUrl)}return[2]}))}))})),[2];case 2:return[4,b()];case 3:return(t=n.sent())?e.postMessage({type:"done",data:t}):e.postMessage({type:"error"}),e.disconnect(),[2];case 4:return e.onMessage.addListener((function(t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:switch(u.print("received",t),t.type){case"initial_data":return[3,1]}return[3,3];case 1:return[4,y(t.params.customs)];case 2:return n=r.sent(),u.print("custom css",n),n?e.postMessage({type:"done",data:n}):e.postMessage({type:"error"}),[3,3];case 3:return[2]}}))}))})),[2];case 5:return[2]}}))}))}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9);t.createAgent=r.createAgent},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(10),a=n(3),s=n(13),u=n(14);function c(e,t){return a.log.debug('agent.ts: Create API function with URL "'+e+'"'),function(n){return r(this,void 0,void 0,(function(){var r,c;return o(this,(function(o){switch(o.label){case 0:return a.log.debug('agent.ts: Call API "'+e+'".'),[4,i.post(e).setHeader("accept","*/*").setHeader("accept-language","en-US,en;q=0.9").setHeader("cookie","token_v2="+t+";").setHeader("origin",s.Default.server).setHeader("referer",s.Default.server).setHeader("user-agent",s.Default.userAgent).sendAsJson(n)];case 1:if((r=o.sent()).hasOwnProperty("errorId"))throw c=r,new u.APIError(c);return[2,r]}}))}))}}t.createAgent=function(e){void 0===e&&(e={});var t=e.token?e.token:"",n=e.server?e.server:s.Default.server;return e.debug&&a.log.setLogLevel("debug"),a.log.debug('agent.ts: Create API agent with server "'+n+'" and token "'+t.substr(0,9)+'..."'),{getActivityLog:c(n+"/api/v3/getActivityLog",t),getAssetsJson:c(n+"/api/v3/getAssetsJson",t),getRecordValues:c(n+"/api/v3/getRecordValues",t),getSnapshotsList:c(n+"/api/v3/getSnapshotsList",t),getUserSharedPages:c(n+"/api/v3/getUserSharedPages",t),loadPageChunk:c(n+"/api/v3/loadPageChunk",t),loadUserContent:c(n+"/api/v3/loadUserContent",t),queryCollection:c(n+"/api/v3/queryCollection",t),submitTransaction:c(n+"/api/v3/submitTransaction",t),search:c(n+"/api/v3/search",t)}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),a=n(12);t.post=function(e){var t=new URL(e);if("http:"!==t.protocol&&"https:"!==t.protocol)throw new a.RequestError("Unsupported protocol: "+t.protocol);var n=t.port?t.port:"http:"===t.protocol?80:443,s={hostname:t.hostname,authority:t.hostname,port:n,path:t.pathname+t.search,method:"POST",headers:{}};return{setHeader:function(e,t){return s.headers[e]=t,this},sendAsJson:function(e){return r(this,void 0,void 0,(function(){var n,r;return o(this,(function(o){switch(o.label){case 0:i.log.debug("http-util.ts: "+s.method+" "+s.hostname+" "+s.port+" "+s.path),this.setHeader("accept-encoding","gzip, deflate"),this.setHeader("content-type","application/json"),n="";try{e&&(n=JSON.stringify(e))}catch(e){throw e}o.label=1;case 1:return o.trys.push([1,3,,4]),[4,fetch(t.toString(),{method:"post",headers:s.headers,body:n})];case 2:return r=o.sent(),[3,4];case 3:throw o.sent();case 4:return o.trys.push([4,6,,7]),[4,r.json()];case 5:return[2,o.sent()];case 6:throw o.sent();case 7:return[2]}}))}))}}}},function(e,t,n){"use strict";const r=0,o=-1,i={verbose:2,debug:3,info:4,warn:5,error:6},a=i.warn,s={fgBlack:"[30m",fgRed:"[31m",fgGreen:"[32m",fgYellow:"[33m",fgBlue:"[34m",fgPink:"[35m",fgCyan:"[36m",fgWhite:"[37m",reset:"[0m",bold:"[1m"};e.exports={Logger:class{constructor(e,t={}){this.appName=e,this.useColor=void 0===t.useColor||t.useColor,this.setLogLevel(t.logLevel)}verbose(){if(i.verbose>=this.logLevel){let e=Array.from(arguments);return e.unshift(this._makeHeader("V",s.bold+s.fgBlue)),console.error.apply(console,e),r}return o}debug(){if(i.debug>=this.logLevel){let e=Array.from(arguments);return e.unshift(this._makeHeader("D",s.bold+s.fgBlue)),console.log.apply(console,e),r}return o}info(){if(i.info>=this.logLevel){let e=Array.from(arguments);return e.unshift(this._makeHeader("I",s.bold+s.fgGreen)),console.log.apply(console,e),r}return o}warn(){if(i.warn>=this.logLevel){let e=Array.from(arguments);return e.unshift(this._makeHeader("W",s.bold+s.fgYellow)),console.log.apply(console,e),r}return o}error(){if(i.error>=this.logLevel){let e=Array.from(arguments);return e.unshift(this._makeHeader("E",s.bold+s.fgRed)),console.error.apply(console,e),r}return o}setLogLevel(e){switch(e){case"verbose":this.logLevel=i.verbose;break;case"debug":this.logLevel=i.debug;break;case"info":this.logLevel=i.info;break;case"warn":this.logLevel=i.warn;break;case"error":this.logLevel=i.error;break;default:return this.warn(`Unknown log level string: ${e}, please specify one of verbose, debug, info, warn, error.`),this.logLevel=a,o}return r}_makeHeader(e,t){const n=`${e}/${this.appName}(${function(){let e=6e4*(new Date).getTimezoneOffset(),t=Date.now()-e;return new Date(t).toISOString().replace(/Z|-|:/g,"")}()}):`;return this.useColor&&t?t+n+s.reset:n}},RET_FAIL:o,RET_SUCCESS:r}},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(n){var r=e.call(this)||this;return r.name="RequestError",Object.setPrototypeOf(r,t.prototype),r.message=n,r}return o(t,e),t}(Error);t.RequestError=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Default={server:"https://www.notion.so",userAgent:"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36"}},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(n){var r=e.call(this)||this;return r.name="APIError",Object.setPrototypeOf(r,t.prototype),r.message='Server says "'+n.name+": "+n.message,n.status&&(r.message+=" Status: "+n.status),r.message+='"',r}return o(t,e),t}(Error);t.APIError=i},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.print=console.log,t.sleep=function(e){return r(void 0,void 0,void 0,(function(){return o(this,(function(t){return[2,new Promise((function(t){return setTimeout(t,e)}))]}))}))},t.jdump=function(e){return JSON.stringify(e,null,2)}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(17);t.fetchFullContentPage=function(e,t){return o(this,void 0,void 0,(function(){var n,o,s,u,c,l;return i(this,(function(i){switch(i.label){case 0:return[4,a.fetchPageById(e,t)];case 1:n=i.sent(),o=n.recordMap.block,s=r({},o),i.label=2;case 2:return u=Object.keys(s),(c=u.flatMap((function(e){var t=s[e];if("none"==t.role)return[];var n=t.value.content;return n&&"page"!==t.value.type?n.filter((function(e){return!s[e]})):[]}))).length?[4,a.fetchBlocks(c).then((function(e){return e.recordMap.block}))]:[3,4];case 3:return l=i.sent(),s=r(r({},s),l),[3,2];case 4:return n.recordMap.collection?n.recordMap.collection[Object.keys(n.recordMap.collection)[0]]:null,n.recordMap.collection_view?n.recordMap.collection_view[Object.keys(n.recordMap.collection_view)[0]]:null,[2,s]}}))}))}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});t.loadPageChunkBody={limit:999,cursor:{stack:[]},chunkNumber:0,verticalColumns:!1};var a=function(e){var t=e.resource,n=e.body,a=e.notionToken;return o(void 0,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,fetch("https://www.notion.so/api/v3/"+t,{method:"POST",headers:r({"content-type":"application/json"},a&&{cookie:"token_v2="+a}),body:JSON.stringify(n)})];case 1:return[2,e.sent().json()]}}))}))};t.fetchPageById=function(e,n,s){return void 0===s&&(s=t.loadPageChunkBody),o(void 0,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,a({resource:"loadPageChunk",body:r({pageId:e},s),notionToken:n})];case 1:return[2,t.sent()]}}))}))};var s={query:{aggregations:[{property:"title",aggregator:"count"}]},loader:{type:"table",limit:999,searchQuery:"",userTimeZone:"Europe/Vienna",userLocale:"en",loadContentCover:!0}};t.fetchTableData=function(e,t,n){return o(void 0,void 0,void 0,(function(){return i(this,(function(o){switch(o.label){case 0:return[4,a({resource:"queryCollection",body:r({collectionId:e,collectionViewId:t},s),notionToken:n})];case 1:return[2,o.sent()]}}))}))},t.fetchNotionUsers=function(e,t){return o(void 0,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,a({resource:"getRecordValues",body:{requests:e.map((function(e){return{id:e,table:"notion_user"}}))},notionToken:t})];case 1:return(n=r.sent())&&n.results?[2,n.results.map((function(e){return{id:e.value.id,firstName:e.value.given_name,lastLame:e.value.family_name,fullName:e.value.given_name+" "+e.value.family_name,profilePhoto:e.value.profile_photo}}))]:[2,[]]}}))}))},t.fetchBlocks=function(e,t){return o(void 0,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,a({resource:"syncRecordValues",body:{recordVersionMap:{block:e.reduce((function(e,t){return e[t]=-1,e}),{})}},notionToken:t})];case 1:return[2,n.sent()]}}))}))},t.fetchNotionSearch=function(e,t){return o(void 0,void 0,void 0,(function(){return i(this,(function(n){return[2,a({resource:"search",body:{type:"BlocksInAncestor",source:"quick_find_public",ancestorId:e.ancestorId,filters:r({isDeletedOnly:!1,excludeTemplates:!0,isNavigableOnly:!0,requireEditPermissions:!1,ancestors:[],createdBy:[],editedBy:[],lastEditedTime:{},createdTime:{}},e.filters),sort:"Relevance",limit:e.limit||20,query:e.query},notionToken:t})]}))}))}},function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var o=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0,o=n;return[o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]]].join("")}}]);