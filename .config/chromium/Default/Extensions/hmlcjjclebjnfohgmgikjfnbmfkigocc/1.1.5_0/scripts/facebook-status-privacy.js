"use strict";!function(e){new Vue({el:"#juno_okyo",data:{cache:{},current_privacy:["everyone"],new_privacy:"friends",keywords:"",limit:0,count:0,before_day:"",posts:[],posts_updated:[],posts_update_queue:[],page_info:null,loading:!1,status:"idle"},methods:{onSubmit:function(){1===this.current_privacy.length&&this.current_privacy[0]===this.new_privacy||(this.loading=!0,this.resetData(),this.status="Loading user feed...",e.runtime.sendMessage({cmd:"get_user_feed",authentication:this.cache}))},dateToTimestamp:function(e){return Date.parse(e)},resetData:function(){this.count=0,this.posts=[],this.posts_updated=[],this.posts_update_queue=[],this.page_info=null,this.status="idle"},setPrivacy:function(t,s){this.status="Updating privacy: "+this.getPostId(t)+"...","only_me"===s.toLowerCase()&&(s="self"),s=s.toUpperCase(),e.runtime.sendMessage({cmd:"set_status_privacy",postId:t,privacy:s,authentication:this.cache})},runQueue:function(){if(0===this.posts_update_queue.length)return this.loading=!1,void(this.status="Done!");var e=this.posts_update_queue.shift();this.setPrivacy(e,this.new_privacy)},checkPosts:function(){if(this.posts.length>0){if(this.limit>0&&this.count>=this.limit)return this.status="Done! Found: "+this.posts_updated.length+" posts.",void this.runQueue();this.count++;var t=this.posts.shift();if(t.node.can_viewer_edit_post_privacy){var s=!0;if(""!==this.before_day){var i=this.dateToTimestamp(this.before_day),n=1e3*t.node.creation_time;new Date(n)>new Date(i)&&(s=!1)}if(""!==this.keywords)if(null!==t.node.message){for(var a=this.keywords.split(","),o=!1,r=0,u=a.length;r<u;r++)if(t.node.message.text.toLowerCase().includes(a[r].trim().toLowerCase())){o=!0;break}o||(s=!1)}else s=!1;if(t.node.privacy_scope){var d=t.node.privacy_scope.type;d!==this.new_privacy&&this.current_privacy.includes(d)||(s=!1)}s&&(this.posts_update_queue.push(t.node.id),this.posts_updated.push({id:t.node.id,message:this.createSnippet(null!==t.node.message?t.node.message.text:""),current_privacy:t.node.privacy_scope.type,new_privacy:"pending",time:dateFns.distanceInWordsToNow(1e3*t.node.creation_time)})),this.checkPosts()}else this.checkPosts()}else null!==this.page_info&&this.page_info.has_next_page?(this.status="Fetching next page... (Found: "+this.posts_updated.length+")",e.runtime.sendMessage({cmd:"get_user_feed",cursor:this.page_info.end_cursor,authentication:this.cache})):(this.status="Done! Found: "+this.posts_updated.length+" posts.",this.runQueue())},getPostId:function(e){var t=/([0-9]+):([0-9]+)/,s=t.exec(atob(e));return null!==s?s[1]+"_"+s[2]:e},getPostUrl:function(e){var t=/([0-9]+):([0-9]+)/,s=t.exec(atob(e));return null!==s?s[1]+"/posts/"+s[2]:""},createSnippet:function(e){return e.length>50?e.substr(0,50)+"...":e}},mounted:function(){var t=this;e.runtime.onMessage.addListener(function(e,s,i){var n=e.cmd.toLowerCase();switch(n){case"get_user_feed_response":var a=e.data;a.timeline_feed_units&&a.timeline_feed_units.edges.length>0&&(t.posts=a.timeline_feed_units.edges,t.page_info=a.timeline_feed_units.page_info,t.checkPosts());break;case"facebook_init_response":t.cache={uid:e.uid,csrf_token:e.data};break;case"set_status_privacy_response":if(e.success){var o=t.posts_updated.findIndex(function(t){return t.id===e.data});o>-1&&(t.posts_updated[o].new_privacy=t.new_privacy),t.runQueue()}else t.status="Error... Please try again later.",t.loading=!1}}),e.runtime.sendMessage({cmd:"facebook_init"})}}),e.runtime.sendMessage({cmd:"track_page_view",path:"/facebook-status-privacy-manager.html"})}(chrome);