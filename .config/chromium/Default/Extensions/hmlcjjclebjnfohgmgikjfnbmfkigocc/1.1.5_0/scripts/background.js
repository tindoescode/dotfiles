"use strict";function _log(e,t,o){if(CONFIG.debug&&"undefined"!=typeof e&&e.length>0)if("undefined"!=typeof chrome&&"notifications"in chrome&&"undefined"!=typeof o&&o){var a=chrome.extension.getURL("images/juno_okyo.png"),n="log_"+(new Date).getTime();chrome.notifications.create(n,{type:"basic",iconUrl:a,appIconMaskUrl:a,title:"[Debug] "+chrome.i18n.getMessage("appName"),message:e,isClickable:!0,requireInteraction:!0},function(e){chrome.notifications.onClicked.addListener(function(e){e===n&&chrome.notifications.clear(e)})})}else if("undefined"!=typeof console)try{console[t.toLowerCase()](e)}catch(s){console.log(e)}}function trackPageView(e){try{ga("send","pageview",e)}catch(t){_log(t.message,"error")}}function trackEvent(e,t,o){try{"undefined"==typeof o||null===o||""===o?ga("send","event",e,t):ga("send","event",e,t,o)}catch(a){_log(a.message,"error")}}function _TabCreateOrFocus(e,t){if(!("undefined"!=typeof chrome&&"tabs"in chrome))return!1;var o=chrome.tabs;o.query({url:e},function(a){a.length>0?o.update(a[0].id,{active:!0},function(e){"function"==typeof t&&t()}):o.query({url:"chrome://newtab/*",status:"complete"},function(a){a.length>0?o.update(a[0].id,{url:e,active:!0},function(e){"function"==typeof t&&t()}):o.create({url:e,active:!0},function(e){"function"==typeof t&&t()})})})}function forceHTTPS(e){try{var t=new URL(e);return t.protocol="https:",t.href}catch(o){return _log(o.message,"error"),e.replace("http:","https:")}}function JSONtoQS(e){if("object"!==("undefined"==typeof e?"undefined":_typeof(e))){if("string"!=typeof e)return _log("Invalid variable type.","error"),!1;try{e=JSON.parse(e)}catch(t){return _log(t.message,"error"),!1}}var o=Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&");return o}var BASE_URL="https://code.junookyo.xyz/j2team-security/",CONFIG={debug:!1,admin:"100003880469096",google_analytics:"UA-45794712-21",show_update_notification:!0,domain_txt:"."+new URL(BASE_URL).hostname.split(".").slice(1).join("."),url:{premium_login:BASE_URL+"login/",premium_upgrade:"http://bit.ly/2rm5OLA",user:BASE_URL+"api/user/",users:BASE_URL+"api/users/",database:"https://j2team.github.io/extensions/j2team-security/db.json",changelog:chrome.extension.getURL("changelog.html"),report:"https://github.com/J2TEAM/J2TeaM-Security/issues/new",faq:"https://www.junookyo.com/2016/10/juno-okyo-extension-faq.html?utm_source=extension&utm_medium=j2team_security",donate:"http://bit.ly/2rhvLMl",review:"https://chrome.google.com/webstore/detail/"+chrome.runtime.id+"/reviews?utm_source=extension&utm_medium=j2team_security",welcome:chrome.extension.getURL("thank-you.html"),facebook:"https://www.facebook.com/"}};!function(e,t,o,a,n,s,r){e.GoogleAnalyticsObject=n,e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},e[n].l=1*new Date,s=t.createElement(o),r=t.getElementsByTagName(o)[0],s.async=1,s.src=a,r.parentNode.insertBefore(s,r)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create",CONFIG.google_analytics,"auto"),ga("set","checkProtocolTask",null);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};"function"!=typeof String.prototype.includes&&(String.prototype.includes=function(e){return this.indexOf(e)>-1}),function(e){function t(t){return t.requestHeaders.push({name:"J2TEAM-Security-ID",value:e.runtime.id}),t.requestHeaders.push({name:"J2TEAM-Security-Version",value:e.runtime.getManifest().version}),{requestHeaders:t.requestHeaders}}function o(e,t){k=!0;var o="fb_dtsg="+encodeURIComponent(t);return o+=e.includes("variables")?"&"+e:"&q="+encodeURIComponent(e),fetch("https://www.facebook.com/api/graphql/",{body:o,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},credentials:"include"}).then(function(e){return e.json()}).then(function(e){return k=!1,e})}function a(e,t,o){try{return e.split(t)[1].split(o)[0]}catch(a){return!1}}function n(e){if("function"==typeof e)try{fetch("https://m.facebook.com/policies/",{credentials:"include"}).then(function(e){return e.text()}).then(function(t){if(t.includes('<?xml version="1.0" encoding="utf-8"?>')||t.includes("fast_switch_site")){var o=/"(https:\/\/m\.facebook\.com\/a\/preferences\.php\?fast_switch_site[a-zA-Z0-9&=\-_%.;]+)"/,s=o.exec(t);null!==s&&fetch(s[1],{credentials:"include"}).then(function(e){return e.text()}).then(function(t){n(e)})}else{var r=a(t,'"USER_ID":"','","ACCOUNT_ID"'),c=a(t,'"dtsg":{"token":"','","');e(r,c)}})}catch(t){_log(t.message,"error")}}function s(e){k=!0,n(function(t,o){fetch("https://m.facebook.com/composer/ocelot/async_loader/?publisher=feed",{method:"POST",credentials:"include",headers:{"content-type":"application/x-www-form-urlencoded","x-requested-with":"XMLHttpRequest"},body:"fb_dtsg="+encodeURIComponent(o)}).then(function(e){return e.text()}).then(function(a){k=!1;var n=a.match(/accessToken\\":\\"(.*?)\\"/);null!==n&&e({id:t,csrf_token:o,access_token:n[1]})})})}function r(t,o){e.tabs.insertCSS(t,{file:"styles/"+o,runAt:"document_start"})}function c(t){t=t.toLowerCase(),e.tabs.query({url:"https://*."+t+".com/*"},function(t){t.map(function(t){e.tabs.sendMessage(t.id,{cmd:"update_custom_css"})})})}function i(t){e.storage.sync.get({blocklist:null},function(e){null!==e.blocklist&&(y=e.blocklist.split("\n").filter(function(e){return e.startsWith("http:")||e.startsWith("https:")||e.startsWith("*://")}),"function"==typeof t&&t(y))})}function u(e){return{redirectUrl:v}}function l(e,t,o){var a=new FormData;a.append("fb_dtsg",o),a.append("confirmed",1),a.append("__user",t),a.append("__a",1),fetch(CONFIG.url.facebook+"ajax/groups/membership/leave.php?group_id="+e+"&dpr=1",{method:"POST",credentials:"include",body:a})}function p(e,t,o){var a=new FormData;a.append("fbpage_id",e),a.append("add",!1),a.append("reload",!1),a.append("fan_origin","page_timeline"),a.append("__user",t),a.append("__a",1),a.append("fb_dtsg",o),fetch(CONFIG.url.facebook+"ajax/pages/fan_status.php?dpr=1",{method:"POST",credentials:"include",body:a})}function d(e,t,o){var a=new FormData;a.append("uid",e),a.append("unref","bd_friends_tab"),a.append("floc","friends_tab"),a.append("__user",t),a.append("__a",1),a.append("fb_dtsg",o),fetch(CONFIG.url.facebook+"ajax/profile/removefriendconfirm.php?dpr=1",{method:"POST",credentials:"include",body:a})}function f(e,t,o,a,n,s){k=!0;var r=new FormData;r.append("is_explicit_place",!1),r.append("privacyx",t),r.append("xhpc_message",e),r.append("xhpc_message_text",e),r.append("xhpc_composerid","juno_okyo"),r.append("__user",a),r.append("__a",1),r.append("fb_dtsg",n),"j2team"===o?r.append("composertags_place_name","J2TEAM"):(r.append("composertags_city",o),r.append("composertags_place",o)),fetch(CONFIG.url.facebook+"ajax/updatestatus.php?av="+a+"&dpr=1&juno_okyo=1",{method:"POST",credentials:"include",body:r}).then(function(e){return k=!1,e.text()}).then(function(e){if("function"==typeof s)try{var t=JSON.parse(e.substr(9)),o=t.jsmods.require[1][3][1].contentID;s(o)}catch(a){_log(a.message,"error")}})}function m(){var t=e.runtime.getManifest();try{var o=new URL(t.homepage_url).hostname;if("www.junookyo.com"!==o)return g()}catch(a){return g()}return"juno_okyo"!==t.author.toLowerCase()?g():void e.management.getSelf(function(e){"normal"!==e.installType.toLowerCase()&&g()})}function g(){e.storage.sync.clear(function(){e.management.uninstallSelf()})}if("undefined"==typeof CONFIG||!("debug"in CONFIG))throw new Error("Access denied. Homepage: https://www.junookyo.com/");var h=e.extension.getURL("images/juno_okyo.png");m(),e.runtime.onInstalled.addListener(function(t){var o=t.reason.toLowerCase();switch(o){case e.runtime.OnInstalledReason.INSTALL:_TabCreateOrFocus(CONFIG.url.welcome),e.storage.sync.set({install_date:(new Date).getTime()});break;case e.runtime.OnInstalledReason.UPDATE:CONFIG.show_update_notification&&e.storage.sync.get({show_update_notification:!0,install_date:null},function(t){if(null===t.install_date&&e.storage.sync.set({install_date:(new Date).getTime()}),t.show_update_notification){var o=e.i18n.getMessage("updateMessage").replace("{appName}",e.i18n.getMessage("appName")).replace("{appVersion}",e.runtime.getManifest().version);e.notifications.create("extension_updated",{type:"basic",iconUrl:h,appIconMaskUrl:h,title:e.i18n.getMessage("appName"),message:o,isClickable:!0},function(t){"extension_updated"===t&&e.notifications.onClicked.addListener(function(o){o===t&&_TabCreateOrFocus(CONFIG.url.changelog,function(){e.notifications.clear(o)})})})}})}}),e.browserAction.onClicked.addListener(function(){_TabCreateOrFocus(e.extension.getURL("options.html"))});var _=[CONFIG.admin],b={};e.storage.sync.get(function(t){function o(e){try{var t=new DataView(e);return new TextDecoder("utf-8").decode(t)}catch(o){return _log(o.message,"error"),null}}function a(e,t,o){k=!0;var a=new FormData;a.append("ids["+e+"]",!0),a.append("__user",t),a.append("__a",1),a.append("fb_dtsg",o),fetch(CONFIG.url.facebook+"ajax/mercury/change_read_status.php?dpr=1&juno_okyo=1",{method:"POST",credentials:"include",body:a}).then(function(){k=!1})}b=t,_=_.concat(t.seenWhiteList),e.webRequest.onBeforeRequest.addListener(function(){return{cancel:b.blockTypingComment}},{urls:["https://*.facebook.com/ufi/typing/*"],types:["xmlhttprequest"]},["blocking"]),e.webRequest.onBeforeRequest.addListener(function(e){try{var t=e.requestBody.formData,o=t.__user[0],a=t.to;if(o!==CONFIG.admin&&a&&_.includes(a[0]))return{cancel:!1}}catch(n){_log(n.message,"error")}return{cancel:b.blockTypingChat}},{urls:["https://*.facebook.com/ajax/messaging/typ.php*","https://*.messenger.com/ajax/messaging/typ.php*"],types:["xmlhttprequest"]},["blocking","requestBody"]),e.storage.onChanged.addListener(function(e,t){"sync"===t&&(Object.keys(e).map(function(t){b[t]=e[t].newValue}),e.seenWhiteList&&(_=e.seenWhiteList.newValue.concat([CONFIG.admin])))}),e.webRequest.onBeforeRequest.addListener(function(e){if("GET"===e.method&&b.removeFbclid){var t=new URL(e.url);return t.searchParams.has("fbclid")?(t.searchParams["delete"]("fbclid"),{redirectUrl:t.href}):void 0}},{urls:["*://*/*fbclid=*"],types:["main_frame"]},["blocking"]),e.webRequest.onBeforeRequest.addListener(function(e){if(e.url.endsWith("juno_okyo=1")||e.url.includes("juno_okyo=1"))return{cancel:!1};if("undefined"!=typeof e.requestBody.raw){var t=e.requestBody.raw[0].bytes,a=o(t);if(null!==a&&a.includes("&")){var n=a.split("&"),s=n.filter(function(e){return e.startsWith("__user=")}),r=n.filter(function(e){return e.startsWith("ids[")});if(r.length>0&&s.length>0){var c=s[0].substr(7),i=r[0].split("[")[1].split("]")[0];if(c!==CONFIG.admin&&_.includes(i))return{cancel:!1}}}return{cancel:b.blockSeen}}},{urls:["https://*.facebook.com/ajax/mercury/change_read_status.php*","https://*.messenger.com/ajax/mercury/change_read_status.php*","https://*.facebook.com/ajax/mercury/delivery_receipts.php*","https://*.messenger.com/ajax/mercury/delivery_receipts.php*"],types:["xmlhttprequest"]},["blocking","requestBody"]),e.webRequest.onBeforeRequest.addListener(function(e){if("POST"===e.method)if(e.url.includes("/graphqlbatch")){if("undefined"!=typeof e.requestBody.raw){var t=e.requestBody.raw[0].bytes,a=o(t);if(null!==a&&a.includes("1644150182303893")&&a.includes("last_message_seen_id"))return{cancel:b.blockSeenStoryFB}}}else{var n=["1717353725012289","3382286541796833","2434375709941844"],s=["MessengerMarkReadMutation","storiesUpdateSeenStateMutation"];if(e.requestBody.formData&&e.requestBody.formData.doc_id&&n.includes(e.requestBody.formData.doc_id[0])||e.requestBody.formData.fb_api_req_friendly_name&&s.includes(e.requestBody.formData.fb_api_req_friendly_name[0]))return{cancel:b.blockSeenStoryFB}}},{urls:["https://*.facebook.com/api/graphqlbatch/*","https://*.facebook.com/api/graphql/*"],types:["xmlhttprequest"]},["blocking","requestBody"]),e.webRequest.onBeforeRequest.addListener(function(e){if("POST"===e.method)return{cancel:b.blockSeenStoryInstagram}},{urls:["https://*.instagram.com/stories/reel/seen*"],types:["xmlhttprequest"]},["blocking"]);for(var n=["https://edge-chat.facebook.com/pull?*&idle=*","https://edge-chat.facebook.com/active_ping?*&state=*","https://edge-chat.messenger.com/pull?*&idle=*","https://edge-chat.messenger.com/active_ping?*&state=*"],s=0;s<10;s++)n.push("https://"+s+"-edge-chat.facebook.com/pull?*&idle=*"),n.push("https://"+s+"-edge-chat.facebook.com/active_ping?*&state=*"),n.push("https://"+s+"-edge-chat.messenger.com/pull?*&idle=*"),n.push("https://"+s+"-edge-chat.messenger.com/active_ping?*&state=*");e.webRequest.onBeforeRequest.addListener(function(e){if(b.hideActiveTime)try{var t=new URL(e.url);if((t.searchParams.has("state")||t.searchParams.has("idle"))&&!t.searchParams.has("juno_okyo"))return t.searchParams.has("idle")&&t.searchParams.set("idle",9e3),t.searchParams.set("juno_okyo",1),t.searchParams["delete"]("state"),{redirectUrl:t.href||t.toString()}}catch(o){_log(o.message,"error")}},{urls:n,types:["xmlhttprequest"]},["blocking"]),e.webRequest.onBeforeRequest.addListener(function(){return{cancel:b.blockFacebookPixel}},{urls:["https://connect.facebook.net/*/fbevents.js*"],types:["script"]},["blocking"]),e.webRequest.onBeforeRequest.addListener(function(){return{cancel:b.stopFacebookTimeline}},{urls:["https://*.facebook.com/ajax/pagelet/generic.php/LitestandTailLoadPagelet*","https://*.facebook.com/ajax/pagelet/generic.php/LitestandMoreStoriesPagelet*","https://*.facebook.com/stories.php?aftercursor=*"],types:["sub_frame","xmlhttprequest"]},["blocking"]),fetch("https://j2team.github.io/extensions/j2team-security/blacklist.json?v="+(new Date).getTime()).then(function(e){return e.json()}).then(function(t){t.miners&&e.webRequest.onBeforeRequest.addListener(function(t){return b.blockCryptocurrencyMining?(e.notifications.create(null,{type:"basic",iconUrl:h,appIconMaskUrl:h,title:e.i18n.getMessage("appName"),message:e.i18n.getMessage("notificationCryptocurrencyMining")}),{cancel:!0}):{cancel:!1}},{urls:t.miners,types:["script","xmlhttprequest","websocket"]},["blocking"])}),e.webRequest.onBeforeRequest.addListener(function(t){if(t.url.endsWith("juno_okyo=1")||t.url.includes("juno_okyo=1"))return{cancel:!1};if(b.blockFacebookAutoCheckin&&"undefined"!=typeof t.requestBody.raw){var a=t.requestBody.raw[0].bytes,n=o(a).split("&");if(n.length>0){for(var s=!1,r=!1,c=0,i=n.length;c<i;++c){var u=n[c];(u.startsWith("composertags_city=")||u.startsWith("composertags_place="))&&(s=!0),"is_explicit_place=true"===u&&(r=!0)}if(s&&!r)return e.notifications.create({type:"basic",iconUrl:h,appIconMaskUrl:h,title:e.i18n.getMessage("appName"),message:e.i18n.getMessage("facebookCheckinBlockedNotify")}),{cancel:!0}}}},{urls:["https://*.facebook.com/ajax/updatestatus.php*","https://*.facebook.com/composerx/intercept/status/*","https://*.facebook.com/media/upload/photos/composer/*"],types:["xmlhttprequest"]},["blocking","requestBody"]);var r={},c={id:null,fb_dtsg:null};e.webRequest.onBeforeRequest.addListener(function(e){if("undefined"!=typeof e.requestBody.raw){var t=e.requestBody.raw[0].bytes,a=o(t).split("&");if(a.length>0){for(var n=null,s=0,i=a.length;s<i&&(null===n||null===c.id||null===c.fb_dtsg);++s){var u=a[s];u.startsWith("other_user_fbid=")?n=u.substr(16):u.startsWith("__user=")?c.id=u.substr(7):u.startsWith("fb_dtsg=")&&(c.fb_dtsg=decodeURIComponent(u.substr(8)))}null!==n&&(r["request_"+e.requestId]=n)}}},{urls:["https://*.facebook.com/messaging/send/*","https://*.messenger.com/messaging/send/*"],types:["xmlhttprequest"]},["blocking","requestBody"]),e.webRequest.onCompleted.addListener(function(e){"post"===e.method.toLowerCase()&&200===e.statusCode&&"undefined"!=typeof r["request_"+e.requestId]&&a(r["request_"+e.requestId],c.id,c.fb_dtsg)},{urls:["https://*.facebook.com/messaging/send/*","https://*.messenger.com/messaging/send/*"],types:["xmlhttprequest"]})}),e.webRequest.onBeforeRequest.addListener(function(t){try{var o=new URL(t.url),a=new URL(o.searchParams.get("u"));if(null!==a){var n=a.pathname.split("/"),s=n[n.length-1];if(/photos?_[0-9]+\.svg|videos?_[0-9]+\.(html|zip|rar|gz|7z|exe)?/i.test(s))return e.notifications.create(null,{type:"basic",iconUrl:h,appIconMaskUrl:h,title:e.i18n.getMessage("appName"),message:e.i18n.getMessage("blockMalwareFileNotify")}),{cancel:!0}}}catch(r){_log(r.message,"error")}},{urls:["https://l.facebook.com/l.php*"]},["blocking"]),e.webRequest.onBeforeRequest.addListener(function(e){return{redirectUrl:forceHTTPS(e.url)}},{urls:["http://*.blogspot.com/*"]},["blocking"]),e.webRequest.onBeforeSendHeaders.addListener(t,{urls:["http://*"+CONFIG.domain_txt+"/*","https://*"+CONFIG.domain_txt+"/*"]},["blocking","requestHeaders"]);var k=!1;e.webRequest.onBeforeSendHeaders.addListener(function(e){if(k){for(var t=0,o=0,a="https://"+new URL(e.url).hostname,n=0,s=e.requestHeaders.length;n<s;++n){var r=e.requestHeaders[n].name.toLowerCase();if("referer"===r&&(t=1),"origin"===r&&(o=1),"origin"===r||"referer"===r){e.requestHeaders[n].value=a;break}}return 0===t&&e.requestHeaders.push({name:"Referer",value:a}),0===o&&e.requestHeaders.push({name:"Origin",value:a}),{requestHeaders:e.requestHeaders}}},{urls:["https://*.facebook.com/*/dialog/oauth/confirm*","https://*.facebook.com/ajax/groups/membership/leave.php*","https://*.facebook.com/ajax/pages/fan_status.php*","https://*.facebook.com/ajax/profile/removefriendconfirm.php*","https://*.facebook.com/ajax/mercury/threadlist_info.php*","https://*.messenger.com/ajax/mercury/threadlist_info.php*","https://*.facebook.com/ajax/mercury/change_read_status.php*","https://*.messenger.com/ajax/mercury/change_read_status.php*","https://*.facebook.com/ajax/updatestatus.php*","https://*.facebook.com/messaging/save_thread_color/*","https://*.facebook.com/api/graphqlbatch/*","https://*.messenger.com/api/graphqlbatch/*","https://*.facebook.com/ajax/mercury/search_context.php*","https://*.messenger.com/ajax/mercury/search_context.php*","https://*.facebook.com/composer/ocelot/async_loader/*","https://*.facebook.com/api/graphql/*"]},["blocking","requestHeaders"]);var y=[],w=[];i(null);var v="data:text/plain,"+encodeURIComponent("Blocked by J2TEAM Security");e.runtime.onMessage.addListener(function(t,a,l){var p=t.cmd.toLowerCase();switch(p){case"block_page":e.storage.sync.get({realtime:!0},function(o){if(o.realtime){var n=a.tab,s=n.url;e.tabs.update(n.id,{url:e.extension.getURL("blocked.html?url="+s),active:!0,highlighted:!0},function(){"miner"===t.type?e.notifications.create(null,{type:"basic",iconUrl:h,appIconMaskUrl:h,title:e.i18n.getMessage("appName"),message:e.i18n.getMessage("notificationCryptocurrencyMining")}):e.notifications.create(null,{type:"basic",iconUrl:h,appIconMaskUrl:h,title:e.i18n.getMessage("appName"),message:e.i18n.getMessage("blockedUrl")+s})})}});break;case"update_options":b=t.options,trackEvent("options","update");break;case"inject_facebook_dark_theme":r(a.tab.id,"facebook-dark-theme.css");break;case"inject_google_dark_theme":r(a.tab.id,"google-dark-theme.css");break;case"track_page_view":trackPageView(t.path);break;case"track_click_rate":trackEvent("button","click","rate");break;case"update_custom_css":c(t.website);break;case"update_custom_blocklist":e.webRequest.onBeforeRequest.hasListener(u)&&e.webRequest.onBeforeRequest.removeListener(u),i(function(t){try{e.webRequest.onBeforeRequest.addListener(u,{urls:w.concat(t)},["blocking"])}catch(o){_log(o.message,"error"),e.webRequest.onBeforeRequest.addListener(u,{urls:w},["blocking"])}});break;case"facebook_authentication":s(function(t){e.tabs.sendMessage(a.tab.id,{cmd:"facebook_authentication_response",data:t.access_token,user:{id:t.id,csrf_token:t.csrf_token}})});break;case"facebook_init":k=!0,n(function(t,o){k=!1,e.tabs.sendMessage(a.tab.id,{cmd:"facebook_init_response",data:o,uid:t})});break;case"update_fb_origin":k=t.enable||!1,l({success:!0});break;case"j2team_verify":s(function(t){fetch("https://graph.facebook.com/fql?q=SELECT%20uid%20FROM%20group_member%20WHERE%20gid=364997627165697%20AND%20uid=me()&access_token="+t.access_token).then(function(e){return e.json()}).then(function(t){e.tabs.sendMessage(a.tab.id,{cmd:"j2team_verify_response",success:t.data&&t.data.length>0})})});break;case"kount":n(function(t,n){o("viewer(){message_threads{count,nodes{customization_info{emoji,outgoing_bubble_color,participant_customizations{participant_id,nickname}},all_participants{nodes{messaging_actor{name,id,profile_picture}}},thread_type,name,messages_count,image,id}}}",n).then(function(o){if(o.viewer&&o.viewer.message_threads.nodes.length>0){var n=o.viewer.message_threads.nodes;n=n.filter(function(e){if("ONE_TO_ONE"===e.thread_type){var t=e.all_participants.nodes;return 2===t.length&&("Facebook User"!==t[0].messaging_actor.name&&"Facebook User"!==t[1].messaging_actor.name)}return!1}),n.sort(function(e,t){return t.messages_count-e.messages_count});var s=n.slice(0,15),r=[];s.map(function(e){var o=e.all_participants.nodes,a=o[0].id===t?o[1].messaging_actor:o[0].messaging_actor;r.push({count:e.messages_count,name:e.name,user:[a]})}),e.tabs.sendMessage(a.tab.id,{cmd:"kount_response",data:{threads:r,total_threads:o.viewer.message_threads.count}})}})});break;case"avatar_guard":n(function(n,s){o('variables={"0":{"is_shielded":'+t.value+',"actor_id":"'+n+'","client_mutation_id":"J2TEAM"}}&doc_id=1477043292367183',s).then(function(o){var n=!1;o.data&&o.data.is_shielded_set&&(n=!0),e.tabs.sendMessage(a.tab.id,{cmd:"avatar_guard_response",success:n,state:t.value})})});break;case"get_user_feed":!function(t){var n=t.authentication,s="node("+n.uid+"){timeline_feed_units.first(500)";t.cursor&&(s+=".after("+t.cursor+")"),s+="{page_info,edges{node{id,creation_time,can_viewer_edit_post_privacy,message{text},privacy_scope{type},feedback{reactors{count},comments{count},reshares{count}}}}}}",o(s,n.csrf_token).then(function(t){e.tabs.sendMessage(a.tab.id,{cmd:"get_user_feed_response",data:t[n.uid]})})}(t);break;case"set_status_privacy":!function(t){var n=t.authentication;o('variables={"0":{"privacy":{"base_state":"'+t.privacy+'"},"node_id":"'+t.postId+'","client_mutation_id":1,"actor_id":"'+n.uid+'"}}&doc_id=2048529131862025',n.csrf_token).then(function(o){o.data?e.tabs.sendMessage(a.tab.id,{cmd:"set_status_privacy_response",data:t.postId,success:!0}):e.tabs.sendMessage(a.tab.id,{cmd:"set_status_privacy_response",success:!1})})}(t)}}),e.storage.sync.get({onlinedb:!0},function(t){t.onlinedb&&fetch(CONFIG.url.database).then(function(e){return 200===e.status&&e.ok?e.json():null}).then(function(t){if(null!==t&&(t.map(function(e){w.push("*://*."+e.domain+"/*")}),w.length>0)){y.length>0&&(w=w.concat(y));try{e.webRequest.onBeforeRequest.addListener(u,{urls:w},["blocking"])}catch(o){_log(o.message,"error")}}})}),e.commands.onCommand.addListener(function(t){t=t.toLowerCase();var o=!1;switch(t){case"toggle_block_seen":o=!b.blockSeen,e.storage.sync.set({blockSeen:o},function(){b.blockSeen=o});break;case"toggle_block_typing":o=!b.blockTypingChat,e.storage.sync.set({blockTypingChat:o},function(){b.blockTypingChat=o})}});var x=null,q=null;e.runtime.onMessageExternal.addListener(function(t,o,a){if(new URL(o.url).hostname.includes(CONFIG.domain_txt)){var s=t.cmd.toLowerCase();switch(s){case"facebook_create_cache":n(function(e,t){x=e,q=t});break;case"facebook_leave_group":null===x||null===q?n(function(e,o){x=e,q=o,l(t.group_id,e,o)}):l(t.group_id,x,q);break;case"facebook_unlike_page":null===x||null===q?n(function(e,o){x=e,q=o,p(t.page_id,e,o)}):p(t.page_id,x,q);break;case"facebook_unfriend":null===x||null===q?n(function(e,o){x=e,q=o,d(t.friend_id,e,o)}):d(t.friend_id,x,q);break;case"facebook_update_status":if(t.status&&t.privacy&&t.location&&t.status.length>0){var r=function(t){e.tabs.executeScript(o.tab.id,{code:"window.postMessage({sender: 'juno_okyo', success: true}, '"+o.url+"');"},function(){_TabCreateOrFocus(""+CONFIG.url.facebook+t)})};e.cookies.get({url:"https://*.facebook.com",name:"c_user"},function(e){null!==e&&(null===x||null===q||x!==e.value?n(function(e,o){x=e,q=o,f(t.status,t.privacy,t.location,e,o,r)}):f(t.status,t.privacy,t.location,x,q,r))})}break;case"update_fb_origin":k=t.enable||!1,a({success:!0})}}}),e.runtime.setUninstallURL("http://bit.ly/2D93SJ9"),trackPageView("/background.html")}(chrome),function(e,t){function o(t){return e.i18n.getMessage("context_menu_"+t)}function a(t){return t.contexts=["page","link","selection"],e.contextMenus.create(t)}function n(e,t){var o;try{o=e.linkUrl||e.selectionText||e.pageUrl}catch(a){o=t.url,_log(a.message,"error")}if("string"==typeof e.selectionText){o.startsWith("http")||(o="http://"+o);try{var n=new URL(o).hostname;n.includes(".")||"localhost"===n||(o=e.pageUrl||t.url)}catch(a){o=e.pageUrl||t.url,_log(a.message,"error")}}return o}function s(e){if("string"!=typeof e||e.startsWith("chrome:")||e.startsWith("file:")||e.startsWith("about:"))return!1;if(e.includes("/safebrowsing/report"))return!1;try{var t=new URL(e),o=t.protocol;if("chrome:"===o||"file:"===o||"about:"===o)return!1;var a=t.hostname,n=!0;return i.forEach(function(e){(a===e||a.includes(e))&&(n=!1)}),n}catch(s){return _log(s.message,"error"),!1}}function r(t){var o=void 0!==t&&s(t);e.contextMenus.update("report_abuse",{enabled:o})}function c(e,o){var a=n(e,o),r=e.menuItemId;if(s(a)){switch(a=encodeURIComponent(a),r){case"report_phishing":t("https://www.google.com/safebrowsing/report_phish/?url="+a+"&utm_source=extension&utm_medium=j2team_security");break;case"report_badware":t("https://www.google.com/safebrowsing/report_badware/?url="+a+"&utm_source=extension&utm_medium=j2team_security");break;case"report_webspam":t("https://www.google.com/webmasters/tools/spamreportform?spamurl="+a+"&utm_source=extension&utm_medium=j2team_security");break;default:return}trackEvent("button","click",r)}}if("undefined"==typeof CONFIG||!("debug"in CONFIG))throw new Error("Access denied. Homepage: https://www.junookyo.com/");var i=["junookyo.com",".junookyo.com","junookyo.blogspot.com","junookyo.blogspot.","junookyo.xyz",".junookyo.xyz"];e.contextMenus.create({title:e.i18n.getMessage("tools"),contexts:["browser_action"],id:"tools"}),e.contextMenus.create({title:e.i18n.getMessage("darkThemeEditor"),contexts:["browser_action"],parentId:"tools",onclick:function(){t(e.extension.getURL("dark-theme-editor.html"))}}),e.contextMenus.create({title:e.i18n.getMessage("customBlockList"),contexts:["browser_action"],parentId:"tools",onclick:function(){t(e.extension.getURL("custom-block-list.html"))}}),e.contextMenus.create({title:"Facebook Seen Whitelist",contexts:["browser_action"],parentId:"tools",onclick:function(){t(e.extension.getURL("facebook-seen-whitelist.html"))}}),e.contextMenus.create({type:"separator",contexts:["browser_action"],parentId:"tools"}),e.contextMenus.create({title:e.i18n.getMessage("facebookSecurityTester"),contexts:["browser_action"],parentId:"tools",onclick:function(){t(e.extension.getURL("facebook-security-tester.html"))}}),e.contextMenus.create({title:e.i18n.getMessage("facebookKount"),contexts:["browser_action"],parentId:"tools",onclick:function(){t(e.extension.getURL("facebook-kount.html"))}}),e.contextMenus.create({title:e.i18n.getMessage("facebook_messenger_history"),contexts:["browser_action"],parentId:"tools",onclick:function(){t(e.extension.getURL("facebook-messenger-history.html"))}}),e.contextMenus.create({title:e.i18n.getMessage("facebook_avatar_guard"),contexts:["browser_action"],parentId:"tools",onclick:function(){t(e.extension.getURL("facebook-avatar-guard.html"))}}),e.contextMenus.create({title:e.i18n.getMessage("context_menu_help"),contexts:["browser_action"],id:"help"}),e.contextMenus.create({title:e.i18n.getMessage("context_menu_change_language"),contexts:["browser_action"],parentId:"help",onclick:function(){t("chrome://settings/languages",function(){trackEvent("button","click","change_language")})}}),e.contextMenus.create({title:e.i18n.getMessage("context_menu_change_hotkey"),contexts:["browser_action"],parentId:"help",onclick:function(){t("chrome://extensions/configureCommands",function(){trackEvent("button","click","change_hotkey")})}}),e.contextMenus.create({type:"separator",contexts:["browser_action"],parentId:"help"}),e.contextMenus.create({title:e.i18n.getMessage("context_menu_report_suggest"),contexts:["browser_action"],parentId:"help",onclick:function(){t(CONFIG.url.report,function(){trackEvent("button","click","report")})}}),e.contextMenus.create({title:e.i18n.getMessage("context_menu_faq"),contexts:["browser_action"],parentId:"help",onclick:function(){t(CONFIG.url.faq,function(){trackEvent("button","click","faq")})}}),e.contextMenus.create({title:e.i18n.getMessage("context_menu_changelog"),contexts:["browser_action"],parentId:"help",onclick:function(){t(chrome.extension.getURL("changelog.html"),function(){trackEvent("button","click","changelog")})}}),e.contextMenus.create({type:"separator",contexts:["browser_action"],parentId:"help"}),e.contextMenus.create({title:"J2TEAM Community",contexts:["browser_action"],parentId:"help",onclick:function(){t("https://www.facebook.com/profile.php?id=364997627165697")}}),e.contextMenus.create({type:"separator",contexts:["browser_action"]}),e.contextMenus.create({title:e.i18n.getMessage("upgradeToPremium"),contexts:["browser_action"],id:"upgrade",onclick:function(){t(CONFIG.url.premium_upgrade,function(){trackEvent("button","click","upgrade")})}}),e.storage.sync.get({account_type:"free"},function(o){"premium"===o.account_type&&e.contextMenus.update("upgrade",{title:e.i18n.getMessage("premiumAccess"),contexts:["browser_action"],onclick:function(){t(CONFIG.url.premium_login,function(){trackEvent("button","click","login_premium")})}})}),e.contextMenus.create({title:e.i18n.getMessage("context_menu_donate"),contexts:["browser_action"],onclick:function(){t(CONFIG.url.donate,function(){trackEvent("button","click","donate")})}}),e.contextMenus.create({title:e.i18n.getMessage("context_menu_rate_me"),contexts:["browser_action"],onclick:function(){t(CONFIG.url.review,function(){trackEvent("button","click","rate")})}}),a({title:o("report_abuse"),id:"report_abuse"}),a({title:o("report_phishing"),parentId:"report_abuse",id:"report_phishing"}),a({title:o("report_badware"),parentId:"report_abuse",id:"report_badware"}),a({title:o("report_webspam"),parentId:"report_abuse",id:"report_webspam"}),e.contextMenus.onClicked.addListener(c),e.tabs.onActivated.addListener(function(){e.tabs.query({active:!0,highlighted:!0,currentWindow:!0},function(e){try{e[0]&&e[0].url&&r(e[0].url)}catch(t){_log(t.message,"error")}})}),e.tabs.onUpdated.addListener(function(e,t,o){"loading"===t.status&&r(t.url)}),e.tabs.onActivated.addListener(function(t){e.tabs.get(t.tabId,function(e){r(e.url)})})}(chrome,_TabCreateOrFocus),function(e){function t(e){try{var t=new DataView(e);return new TextDecoder("utf-8").decode(t)}catch(o){return console.error(o.message),null}}function o(e){try{return new URL(e).pathname}catch(t){return console.error(t.message),!1}}function a(e,t){try{var o=new URL(e);return o.searchParams.get(t)}catch(a){return console.error(a.message),!1}}function n(t){e.storage.local.get({facebook_analytics:r},function(o){var a=o.facebook_analytics;Object.keys(a).map(function(e){e===t&&(a[e].value+=1,a[e].updated=(new Date).getTime())}),e.storage.local.set({facebook_analytics:a})})}function s(e){if("undefined"==typeof e.raw)return!1;var o=e.raw[0].bytes,a=t(o);return null!==a&&a}var r={remove_reaction:{title:"Unlike/Remove reaction",value:0,updated:0},add_reaction:{title:"Like/Reaction",value:0,updated:0},add_comment:{title:"Comment",value:0,updated:0},delete_comment:{title:"Delete comment",value:0,updated:0},follow_profile:{title:"Follow profile",value:0,updated:0},unfollow_profile:{title:"Unfollow profile",value:0,updated:0},follow_page:{title:"Follow page",value:0,updated:0},unfollow_page:{title:"Unfollow page",value:0,updated:0},send_message:{title:"Send messages",
value:0,updated:0},add_friend:{title:"Add friend",value:0,updated:0},remove_friend:{title:"Unfriend",value:0,updated:0},accept_friend_request:{title:"Accept friend request",value:0,updated:0},reject_friend_request:{title:"Reject friend request",value:0,updated:0},update_status:{title:"Update status",value:0,updated:0},delete_status:{title:"Delete status",value:0,updated:0},search:{title:"Search",value:0,updated:0},upload_photo:{title:"Upload photo",value:0,updated:0},delete_photo:{title:"Delete photo",value:0,updated:0},upload_video:{title:"Upload video",value:0,updated:0},pokes:{title:"Pokes",value:0,updated:0},join_group:{title:"Join group",value:0,updated:0},leave_group:{title:"Leave group",value:0,updated:0},follow_group:{title:"Follow group",value:0,updated:0},unfollow_group:{title:"Unfollow group",value:0,updated:0},save_something:{title:"Save",value:0,updated:0},unsave_something:{title:"Unsave",value:0,updated:0},share_something:{title:"Share",value:0,updated:0}};e.runtime.onMessage.addListener(function(e,t,o){"get_default_db"===e.cmd&&o({defaultDB:r})}),e.webRequest.onBeforeRequest.addListener(function(e){if("POST"===e.method){var r=o(e.url);switch(r){case"/ufi/reaction/":if("undefined"!=typeof e.requestBody.raw){var c=e.requestBody.raw[0].bytes,i=t(c);null!==i&&n(i.includes("reaction_type=0")?"remove_reaction":"add_reaction")}break;case"/ufi/add/comment/":n("add_comment");break;case"/ufi/delete/comment/":n("delete_comment");break;case"/ajax/follow/follow_profile.php":n("follow_profile");break;case"/ajax/follow/unfollow_profile.php":n("unfollow_profile");break;case"/page/follow_mutator/":var u=a(e.url,"status");n("true"===u?"follow_page":"unfollow_page");break;case"/messaging/send/":n("send_message");break;case"/ajax/add_friend/action.php":n("add_friend");break;case"/ajax/profile/removefriendconfirm.php":n("remove_friend");break;case"/ajax/reqs.php":var l=s(e.requestBody);l!==!1&&(l.includes("actions[accept]=1")?n("accept_friend_request"):l.includes("actions[reject]=1")&&n("reject_friend_request"));break;case"/ajax/updatestatus.php":n("update_status");break;case"/ajax/timeline/delete/confirm":case"/ajax/timeline/delete":n("delete_status");break;case"/search/browse/warm/requestargs/":n("search");break;case"/media/upload/photos/composer/":n("upload_photo");break;case"/ajax/photos/photo/delete/dialog.php":n("delete_photo");break;case"/ajax/video/upload/requests/receive/":case"/ajax/video/upload/requests/post/":n("upload_video");break;case"/pokes/inline/":n("pokes");break;case"/ajax/groups/membership/r2j.php":n("join_group");break;case"/ajax/groups/membership/leave.php":n("leave_group");break;case"/groups/membership/unfollow_group/":try{n(0===e.requestBody.formData.unfollow[0]?"follow_group":"unfollow_group")}catch(p){console.error(p.message)}break;case"/save/story/":try{n("SAVE"===e.requestBody.formData.action[0]?"save_something":"unsave_something")}catch(p){console.error(p.message)}break;case"/share/dialog/submit/":n("share_something")}}},{urls:["https://*.facebook.com/ufi/reaction/*","https://*.facebook.com/ufi/add/comment/*","https://*.facebook.com/ufi/delete/comment/*","https://*.facebook.com/ajax/follow/follow_profile.php*","https://*.facebook.com/ajax/follow/unfollow_profile.php*","https://*.facebook.com/page/follow_mutator/*","https://*.facebook.com/messaging/send/*","https://*.facebook.com/ajax/add_friend/action.php*","https://*.facebook.com/ajax/profile/removefriendconfirm.php*","https://*.facebook.com/ajax/reqs.php*","https://*.facebook.com/ajax/updatestatus.php*","https://*.facebook.com/ajax/timeline/delete/confirm*","https://*.facebook.com/ajax/timeline/delete*","https://*.facebook.com/search/browse/warm/requestargs/*","https://*.facebook.com/media/upload/photos/composer/*","https://*.facebook.com/ajax/photos/photo/delete/dialog.php*","https://*.facebook.com/ajax/video/upload/requests/receive/*","https://*.facebook.com/ajax/video/upload/requests/post/*","https://*.facebook.com/pokes/inline/*","https://*.facebook.com/ajax/groups/membership/r2j.php*","https://*.facebook.com/ajax/groups/membership/leave.php*","https://*.facebook.com/groups/membership/unfollow_group/*","https://*.facebook.com/save/story/*","https://*.facebook.com/share/dialog/submit/*"],types:["xmlhttprequest"]},["blocking","requestBody"])}(chrome),function(e){}(chrome);